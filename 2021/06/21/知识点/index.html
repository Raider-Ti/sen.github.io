<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="三大网络：电信网络 有线电视网络 计算机网络 互连网：指在局部范围互连起来的计算机网互联网：指当今世界上最大的计算机网络。 Internet。 互联网2个重要基本特点：连通性 共享 主机：与网络相连的计算机 网络：把许多计算机连接在一起互连网：把许多网络通过路由器连接在一起 互联网基础结构发展的三个阶段：第一阶段：arpanet第二阶段：建成了三级结构的互联网第三阶段：逐渐形成了多层次 IS">
<meta property="og:type" content="article">
<meta property="og:title" content="计算机网络知识点总结">
<meta property="og:url" content="http://example.com/2021/06/21/%E7%9F%A5%E8%AF%86%E7%82%B9/index.html">
<meta property="og:site_name" content="SenBlog">
<meta property="og:description" content="三大网络：电信网络 有线电视网络 计算机网络 互连网：指在局部范围互连起来的计算机网互联网：指当今世界上最大的计算机网络。 Internet。 互联网2个重要基本特点：连通性 共享 主机：与网络相连的计算机 网络：把许多计算机连接在一起互连网：把许多网络通过路由器连接在一起 互联网基础结构发展的三个阶段：第一阶段：arpanet第二阶段：建成了三级结构的互联网第三阶段：逐渐形成了多层次 IS">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2021/06/21/%E7%9F%A5%E8%AF%86%E7%82%B9/picture/屏幕快照%202021-06-15%20上午11.01.59.png">
<meta property="og:image" content="http://example.com/2021/06/21/%E7%9F%A5%E8%AF%86%E7%82%B9/picture/屏幕快照%202021-06-15%20上午11.48.02.png">
<meta property="og:image" content="http://example.com/2021/06/21/%E7%9F%A5%E8%AF%86%E7%82%B9/picture/屏幕快照%202021-06-15%20下午7.44.48.png">
<meta property="article:published_time" content="2021-06-21T05:19:39.572Z">
<meta property="article:modified_time" content="2021-06-21T05:24:02.598Z">
<meta property="article:author" content="森森">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2021/06/21/%E7%9F%A5%E8%AF%86%E7%82%B9/picture/屏幕快照%202021-06-15%20上午11.01.59.png">

<link rel="canonical" href="http://example.com/2021/06/21/%E7%9F%A5%E8%AF%86%E7%82%B9/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>计算机网络知识点总结 | SenBlog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">SenBlog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/06/21/%E7%9F%A5%E8%AF%86%E7%82%B9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="森森">
      <meta itemprop="description" content="笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SenBlog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          计算机网络知识点总结
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-06-21 13:19:39 / 修改时间：13:24:02" itemprop="dateCreated datePublished" datetime="2021-06-21T13:19:39+08:00">2021-06-21</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 第一章概述>


<p>三大网络：电信网络 有线电视网络 计算机网络</p>
<p>互连网：指在局部范围互连起来的计算机网<br>互联网：指当今世界上最大的计算机网络。 Internet。</p>
<p>互联网2个重要基本特点：连通性 共享</p>
<p>主机：与网络相连的计算机</p>
<p>网络：把许多计算机连接在一起<br>互连网：把许多网络通过路由器连接在一起</p>
<p>互联网基础结构发展的三个阶段：<br>第一阶段：arpanet<br>第二阶段：建成了三级结构的互联网<br>第三阶段：逐渐形成了多层次 ISP 结构的互联网<br>ISP：主干 ISP、地区 ISP 和 本地 ISP。</p>
<p>互联网草案：不是RFC文档<br>建议标准：开始成为RFC文档</p>
<p>从互联网的工作方式上看，可以划分为两大块：边缘部分 核心部分</p>
<p>主机又称为端系统<br>端系统在功能上可能有很大的差别</p>
<p>主机 A 和主机 B 进行通信实际上是指：“运行在主机 A 上的某个程序和运行在主机 B 上的另一个程序进行通信”。</p>
<p>端系统之间的两种通信方式<br>C/S:客户-服务器方式<br>P2P:对等方式<br>客户是服务的请求方，服务器是服务的提供方。</p>
<p>C/S:<br>客户软件的特点:被用户调用后运行<br>服务器软件的特点: 一直不断地运行着，被动地等待<br>客户与服务器的通信关系建立后，通信可以是双向的，客户和服务器都可发送和接收数据。</p>
<p>P2P:<br>平等的、对等连接通信<br>每一个主机既是客户又是服务器</p>
<p>在网络核心部分起特殊作用的是路由器<br>路由器实现：分组交换，转发</p>
<p>每一部电话都直接连接到交换机上，而交换机使用交换的方法，让电话用户彼此之间可以很方便地通信。<br>所采用的交换方式就是电路交换 (circuit switching)。</p>
<p>电路交换特点：面向连接<br>电路交换三个阶段：建立连接，通信，释放连接</p>
<p>分组交换：存储转发技术<br>在发送端，先把较长的报文划分成较短的、固定长度的数据段。<br>在每个数据段前面加上首部构成分组<br>分组交换网以“分组”作为数据传输单元。<br>依次把各分组发送到接收端</p>
<p>首部的重要性：<br>每一个分组的首部都含有地址<br>结点交换机根据收到的地址，把分组转发到下一个结点交换机<br>每个分组在互联网中独立地选择传输路径<br>用这样的存储转发方式，最后分组就能到达最终目的地</p>
<p>互联网的核心部分是由许多网络和把它们互连起来的路由器组成，而主机处在互联网的边缘部分</p>
<p>路由器之间用高速链路相连接，主机连接到路由器之间用相对较低速率链路连接</p>
<p>主机用途：为用户进行信息处理，可以和其他主机通过网络交换信息<br>路由器用途：进行分组交换</p>
<p>在路由器中的输入和输出端口之间没有直接连线。</p>
<p>路由器处理分组的过程是：<br>把收到的分组先放入缓存（暂时存储）；<br>查找转发表，找出到某个目的地址应从哪个端口转发；<br>把分组送到适当的端口转发出去。 </p>
<p>分组交换的优点：<br>高效，动态分配传输带宽<br>灵活，为每一个分组独立地选择最适合的转发路由<br>迅速，以分组作为传送单位，可以不先建立连接就能向其他主机发送分组<br>可靠，可靠的网络协议，分布式多路由分组交换网</p>
<p>分组交换带来的问题：在各结点需要排队，带来一定时延<br>，分组必须携带首部，造成一定的开销</p>
<p>存储转发原理：<br>报文交换，自古的邮政、现在的快递 </p>
<p>三种交换比较</p>
<img src="picture/屏幕快照 2021-06-15 上午11.01.59.png" alt="图片alt" title="图片title">

<p>若要连续传送大量的数据，且其传送时间远大于连接建立时间，则电路交换的传输速率较快。<br>报文交换和分组交换不需要预先分配传输带宽，在传送突发数据时可提高整个网络的信道利用率。<br>由于一个分组的长度往往远小于整个报文的长度，因此分组交换比报文交换的时延小，同时也具有更好的灵活性。</p>
<p>计算机网络定义：计算机网络主要是由一些通用的、可编程的硬件（一定包含有中央处理机 (CPU））互连而成的</p>
<p>按照网络作用范围分类：广域网WAN(Wide Area Network)<br>城域网MAN (Metropolitan Area Network)<br>局域网LAN (Local Area Network)<br>个人区域网 PAN (Personal Area Network) </p>
<p>若中央处理机之间的距离非常近（如仅1米的数量级甚至更小些），则一般就称之为多处理机系统，而不称它为计算机网络。 </p>
<p>按照网络的使用者进行分类：<br>公用网 (public network)<br>专用网 (private network) </p>
<p>用来把用户接入到互联网的网络：<br>接入网 AN (Access Network)<br>接入网是从某个用户端系统到互联网中的第一个路由器（也称为边缘路由器）之间的一种网络。</p>
<p>计算机网络的性能指标<br>速率 带宽 吞吐率 时延 时延带宽积 往返时间RTT 利用率</p>
<p>速率：数据的传送速率 也成数据率，比特率<br>速率的单位是 bit/s，或 kbit/s、Mbit/s、 Gbit/s 等<br>速率往往是指额定速率或标称速率，非实际运行速率</p>
<p>带宽：频带宽度 ，最高数据率即比特每秒<br>在时间轴上信号的宽度随带宽的增大而变窄<br><img src="picture/屏幕快照 2021-06-15 上午11.48.02.png" alt="图片alt" title="图片title"></p>
<p>吞吐量：以便知道实际上到底有多少数据量能够通过网络</p>
<p>时延：（延迟/迟延）发送时延 传播时延 处理时延 排队时延 </p>
<p>发送时延（传送时延）= 数据帧长度（bit）/ 发送速率（bit/s）</p>
<p>发送时延与传播时延有本质上的不同<br>信号发送速率和信号在信道上的传播速率是完全不同的概念<br>传播时延 = 信道长度（米）/ 信号在信道上的传播速率（米/秒）<br>排队时延：排队等待处理<br>排队时延的长短往往取决于网络中当时的通信量</p>
<p>总时延 = 发送时延 + 传播时延 + 处理时延 + 排队时延</p>
<p>对于高速网络链路，我们提高的仅仅是数据的发送速率而不是比特在链路上的传播速率</p>
<p>“在高速链路（或高带宽链路）上，比特会传送得更快些”。（x）</p>
<p>链路的时延带宽积又称为以比特为单位的链路长度。<br>时延带宽积 = 传播时延 x 带宽</p>
<p>往返时间RTT = 表示从发送方发送数据开始，到发送方收到来自接收方的确认，总共经历的时间。（包括各中间结点）</p>
<p>利用率：分为信道利用率和网络利用率<br>信道利用率指出某信道有百分之几的时间是被利用的（有数据通过）。完全空闲的信道的利用率是零。<br>网络利用率则是全网络的信道利用率的加权平均值。<br>信道利用率并非越高越好。当某信道的利用率增大时，该信道引起的时延也就迅速增加。</p>
<p>系统网络体系结构SNA (System Network Architecture)<br>由于网络体系结构的不同，不同公司的设备很难互相连通。</p>
<p>开放系统互连基本参考模型 OSI/RM (Open Systems Interconnection Reference Model)，简称为 OSI。</p>
<p>OSI失败原因<br>OSI 的专家们在完成 OSI 标准时没有商业驱动力；<br>OSI 的协议实现起来过分复杂，且运行效率很低；<br>OSI 标准的制定周期太长，因而使得按 OSI 标准生产的设备无法及时进入市场；<br>OSI 的层次划分也不太合理，有些功能在多个层次中重复出现。  </p>
<p>非国际标准 TCP/IP 却获得了最广泛的应用。TCP/IP 常被称为事实上国际标准</p>
<p>网络协议的三个组成要素：<br>语法，语义，同步</p>
<p>协议的两种形式：文字描述，程序代码<br>都必须能够对网络上信息交换过程做出精确的解释<br>声、光、电、味、温、触觉、震动、量子纠缠、第六感</p>
<p>ARPANET 的研制经验表明，对于复杂的计算机网络协议，结构应该是层次式的</p>
<p>分层的优点：<br>各层之间是独立的。<br>灵活性好。<br>结构上可分割开。<br>易于实现和维护。<br>能促进标准化工作。</p>
<p>缺点：<br>降低效率。<br>有些功能会在不同的层次中重复出现，因而产生了额外开销。</p>
<p>各层完成的主要功能<br>① 差错控制：使相应层次对等方的通信更加可靠。<br>② 流量控制：发送端的发送速率必须使接收端来得及接收，不要太快。<br>③ 分段和重装 ：发送端将要发送的数据块划分为更小的单位，在接收端将其还原。<br>④ 复用和分用：发送端几个高层会话复用一条低层的连接，在接收端再进行分用。<br>⑤ 连接建立和释放：交换数据前先建立一条逻辑连接，数据传送结束后释放连接。<br><br>计算机网络的体系结构 (architecture) 是计算机网络的各层及其协议的集合。 </p>
<img src="picture/屏幕快照 2021-06-15 下午7.44.48.png" alt="图片alt" title="图片title">

<p>五层协议的体系结构:<br>应用层 (application layer)<br>运输层 (transport layer)<br>网络层 (network layer)<br>数据链路层 (data link layer)<br>物理层 (physical layer) </p>
<p>OSI 参考模型把对等层次之间传送的数据单位称为该层的协议数据单元 PDU (Protocol Data Unit)。<br>各层协议实际上就是在各个对等层之间传递数据时的各项规定。</p>
<p>实体 (entity) ：表示任何可发送或接收信息的硬件或软件进程。<br>协议：是控制两个对等实体进行通信的规则的集合。<br>服务访问点 SAP (Service Access Point)：同一系统相邻两层的实体进行交互的地方</p>
<p>在协议的控制下，两个对等实体间的通信使得本层能够向上一层提供服务<br>要实现本层协议，还需要使用下层所提供的服务</p>
<p>协议和服务在概念上是不一样的：<br>协议的实现保证了能够向上一层提供服务。<br>本层的服务用户只能看见服务而无法看见下面的协议。即下面的协议对上面的服务用户是透明的。<br>协议是“水平的”，即协议是控制对等实体之间通信的规则。<br>服务是“垂直的”，即服务是由下层向上层通过层间接口提供的。<br>上层使用服务原语获得下层所提供的服务。</p>
<p>OSI把层与层之间交换的数据的单位称为服务数据单元 SDU (Service Data Unit)</p>
<p>协议必须把所有不利的条件事先都估计到，而不能假定一切都是正常的和非常理想的。<br>看一个计算机网络协议是否正确，不能光看在正常情况下是否正确，还必须非常仔细地检查这个协议能否应付各种异常情况。 </p>
<h1 第二章物理层>


<p>物理层的主要任务：主要任务：确定与传输媒体的接口的一些特性。<br>机械特性 ：指明接口所用接线器的形状和尺寸、引线数目和排列、固定和锁定装置等。<br>电气特性：指明在接口电缆的各条线上出现的电压的范围。<br>功能特性：指明某条线上出现的某一电平的电压表示何种意义。<br>过程特性 ：指明对于不同功能的各种可能事件的出现顺序。 </p>
<p>一个数据通信系统包括三大部分：源系统（或发送端、发送方）、传输系统（或传输网络）和目的系统（或接收端、接收方）。</p>
<p>模拟信号：连续的<br>数字信号：离散的</p>
<p>单工：只能有一个方向的通信，而没有反方向的交互<br>半双工：通信的双发都可以发送信息，但是不能同时发送<br>全双工：通信双方可以同时发送和接受信息</p>
<p>基带信号（即基本频带信号）—— 来自信源的信号。像计算机输出的代表各种文字或图像文件的数据信号都属于基带信号。</p>
<p>基带信号往往包含有较多的低频成分，甚至有直流成分，而许多信道并不能传输这种低频分量或直流分量。因此必须对基带信号进行调制 (modulation)。   </p>
<p>调制分类：<br>基带调制：仅对基带信号的波形进行变换，使它能够与信道特性相适应。变换后的信号仍然是基带信号。把这种过程称为编码 (coding)。<br>带通调制：使用载波 (carrier)进行调制，把基带信号的频率范围搬移到较高的频段，并转换为模拟信号，这样就能够更好地在模拟信道中传输（即仅在一段频率范围内能够通过信道） 。</p>
<p>带通信号 ：经过载波调制后的信号。</p>
<p>常用编码（基带调制）方式：<br>不归零制：正电平代表 1，负电平代表 0。<br>归零制：正脉冲代表 1，负脉冲代表 0。<br>曼彻斯特编码：位周期中心的向上跳变代表 0，位周期中心的向下跳变代表 1。但也可反过来定义。<br>差分曼彻斯特编码：在每一位的中心处始终都有跳变。位开始边界有跳变代表 0，而位开始边界没有跳变代表 1。</p>
<p>最基本的二元制调制方法有以下几种：<br>调幅(AM)：载波的振幅随基带数字信号而变化。<br>调频(FM)：载波的频率随基带数字信号而变化。<br>调相(PM)：载波的初始相位随基带数字信号而变化。</p>
<p>数字信号通过实际的信道<br>有失真，可识别。<br>失真大，无法识别</p>
<p>限制码元在信道上的传输速率的因素：信道能够通过的频率范围 信噪比</p>
<p>信道能够通过的频率范围：奈氏准则 为了避免码间串扰，码元的传输速率的上限值<br>奈氏准则前提条件：信道无噪声<br>    对无噪声的通信信道，H是信道的带宽，则信道可达到的最大信号速率（signaling rate)是2H。</p>
<p>信噪比就是信号的平均功率和噪声的平均功率之比。常记为 S/N，并用分贝 (dB) 作为度量单位。即：<br>        信噪比(dB) = 10 log10(S/N)    (dB)<br>        例如，当 S/N = 10 时，信噪比为 10 dB，而当 S/N = 1000时，信噪比为 30 dB。  </p>
<p>香农公式：带宽受限且有高斯白噪声干扰的信道的极限、无差错的信息传输速率C<br>            C = W log2(1+S/N)    (bit/s)<br>            其中：    W 为信道的带宽（以 Hz 为单位）；<br>                    S 为信道内所传信号的平均功率；<br>                    N 为信道内部的高斯噪声功率。  </p>
<p>物理层下面的传输媒体（传输介质或传输媒介）：引导型传输媒体 非引导性传输媒体</p>
<p>在导引型传输媒体中，电磁波被导引沿着固体媒体（铜线或光纤）传播。<br>非导引型传输媒体就是指自由空间。在非导引型传输媒体中，电磁波的传输常称为无线传输</p>
<p>引导性传输媒体：<br>    双绞线（通信距离一般为几到十几公里）<br>        是由一对相互绝缘的金属导线绞合而成<br>        屏蔽双绞线 STP (Shielded Twisted Pair)<br>            带金属屏蔽层<br>        无屏蔽双绞线 UTP (Unshielded Twisted Pair)<br>    同轴电缆<br>        50欧 同轴电缆 —— LAN / 数字传输常用<br>        75欧 同轴电缆 —— 有线电视 / 模拟传输常用</p>
<pre><code>光缆
    多模光纤
    单模光纤
    &lt;imag src=&quot;picture/屏幕快照 2021-06-15 下午11.16.58.png&quot;&gt;
    光纤优点：
        (1) 通信容量非常大。
        (2) 传输损耗小，中继距离长。
        (2) 抗雷电和电磁干扰性能好。
        (3) 无串音干扰，保密性好。
        (4) 体积小，重量轻。
</code></pre>
<p>非导引型传输媒体：<br>    短波通信：（即高频通信）主要是靠电离层的反射，但短波信道的通信质量较差，传输速率低。<br>    微波在空间主要是直线传播。</p>
<p>对传送数据来说，现在最常用的 UTP 是5类线（Category 5 或 CAT5）</p>
<image src="picture/屏幕快照 2021-06-15 下午11.12.28.png">

<p>信道复用技术：<br>    复用 (multiplexing) 是通信技术中的基本概念。<br>    它允许用户使用一个共享信道进行通信，降低成本，提高利用率。<br>    频分复用 FDM：<br>        所有用户在同样的时间占用不同的带宽资源<br>    时分复用 TDM：<br>        将时间划分为一段段等长的时分复用帧（TDM 帧）。每一个时分复用的用户在每一个 TDM 帧中占用固定序号的时隙。<br>        每一个用户所占用的时隙是周期性地出现（其周期就是 TDM  帧的长度）。<br>        TDM 信号也称为等时(isochronous)信号。<br>        时分复用的所有用户是在不同的时间占用同样的频带宽度。<br>        时分复用可能会造成线路资源的浪费<br>        统计时分复用 STDM：<br>            STDM 帧不是固定分配时隙，而是按需动态地分配时隙。因此统计时分复用可以提高线路的利用率。<br>    波分复用 WDM：<br>    码分复用 CDM：<br>        常用的名词是码分多址 CDMA：<br>            每个站分配的码片序列不仅必须各不相同，并且还必须互相正交 (orthogonal)<br>            在实用的系统中是使用伪随机码序列<br>        码片：每一个比特时间划分为 m 个短的间隔<br>        每个站被指派一个唯一的 m bit 码片序列<br>        两个不同站的码片序列正交，就是向量 S 和T 的规格化内积 (inner product) 等于 0<br>        假定所分配的代码具有两个特点：<br>        每个代码与其他代码相乘，得到0；<br>        每个代码自己相乘，得到4（站的数量）。<br>        每个站用数据d乘以代码，得到d1<em>c1, d2</em>c2,…,信道中的数据是所有这些项的和。</p>
<p>数字传输系统：<br>    与模拟通信相比，数字通信无论是在传输质量上还是经济上都有明显的优势。<br>    脉码调制 PCM 体制最初是为了在电话局之间的中继线上传送多路的电话。<br>        北美的 24 路 PCM（简称为 T1）<br>        欧洲的 30 路 PCM（简称为 E1）<br>            我国采用的是欧洲的 E1 标准。<br>    旧的数字传输系统主要缺点：<br>        速率标准不统一<br>        不是同步传输<br>    同步光纤网 SONET (Synchronous Optical Network)：<br>        对电信信号称为第 1 级同步传送信号 STS-1 (Synchronous Transport Signal)，其传输速率是 51.84 Mbit/s。<br>        对光信号则称为第 1 级光载波 OC-1 (OC 表示Optical Carrier)。<br>    同步数字系列 SDH (Synchronous Digital Hierarchy)：<br>        ITU-T 以美国标准 SONET 为基础，制订出国际标准<br>    一般可认为 SDH 与 SONET 是同义词<br>    SDH SONET的不同点是：SDH 的基本速率为 155.52 Mbit/s，称为第 1 级同步传递模块 (Synchronous Transfer Module)，即 STM-1，相当于 SONET 体系中的 OC-3 速率<br>    SONET / SDH 标准的意义：<br>        第一次真正实现了数字传输体制上的世界性标准。<br>        已成为公认的新一代理想的传输网体制。</p>
<p>宽带接入技术：<br>    初期：利用电话线，最高只能达到 56 kbit/s<br>    宽带：只要双向速率之和超过 200 kbit/s<br>    有线宽带接入：<br>        非对称数字用户线 ADSL(Asymmetric Digital Subscriber Line) ：<br>            把 0~4 kHz 低端频谱留给传统电话使用，而把原来没有被利用的高端频谱留给用户上网使用。<br>            DSL 就是数字用户线 (Digital Subscriber Line) 的缩写。<br>            传输距离取决于数据率和用户线的线径（用户线越细，信号传输时的衰减就越大）<br>            特点：<br>                上行和下行带宽做成不对称的。<br>                    上行指从用户到 ISP，而下行指从 ISP 到用户<br>                在用户线（铜线）的两端各安装一个 ADSL 调制解调器<br>                我国目前采用的方案是离散多音调 DMT (Discrete Multi-Tone)调制技术：<br>                    “多音调”就是“多载波”或“多子信道”的意思。<br>                    采用频分复用方法<br>                    相当于在一对用户线上使用许多小的调制解调器并行地传送数据<br>            ADSL 的数据率：<br>                ADSL 采用自适应调制技术使用户线能够传送尽可能高的数据率<br>                不能保证固定的数据率<br>            第二代 ADSL：<br>                更高的数据率<br>                无缝速率自适应技术 SRA (Seamless Rate Adaptation)<br>        光纤同轴混合网（HFC网）：<br>            CATV 网采用模拟技术的频分复用<br>            HFC 网对 CATV 网进行了改造：<br>                将原 CATV 网中的同轴电缆主干部分改换为光纤，并使用模拟光纤技术<br>                在模拟光纤中采用光的振幅调制 AM，这比使用数字光纤更为经济<br>                模拟光纤从头端连接到光纤结点 (fiber node)，即光分配结点 ODN (Optical Distribution Node)在光纤结点光信号被转换为电信号。在光纤结点以下就是同轴电缆。<br>    用户接口盒 UIB (User Interface Box) 要提供三种连接：<br>        使用同轴电缆连接到机顶盒 (set-top box)，然后再连接到用户的电视机。<br>        使用双绞线连接到用户的电话机。<br>        使用电缆调制解调器连接到用户的计算机。<br>    电缆调制解调器 (Cable Modem)：<br>        是为 HFC 网而使用的调制解调器</p>
<h1 第三章数据链路层>

<p>数据链路层使用的信道主要有以下两种类型：<br>    点对点信道:<br>        这种信道使用一对一的点对点通信方式<br>    广播信道:<br>        这种信道使用一对多的广播通信方式，因此过程比较复杂<br>    链路 (link)（物理链路） :<br>        是一条无源的点到点的物理线路段，中间没有任何其他的交换结点<br>    数据链路 (data link)（逻辑链路）:<br>        把实现协议的硬件和软件加到链路上<br>    通信规程：早期的数据通信协议<br>    三个基本问题：<br>        1. 封装成帧：在一段数据的前后分别添加首部和尾部，进行帧定界（可以使用帧定界符）<br>        2. 透明传输：字节填充 (byte stuffing) 或字符填充 (character stuffing)，插入一个转义字符“ESC”<br>        3. 差错控制 ：比特差错：1 可能会变成 0 而 0 也可能变成 1。<br>            误码率：在一段时间内，传输错误的比特占所传输比特总数的比率<br>    循环冗余检验 CRC 的检错技术：<br>        在数据链路层传送的帧中，广泛使用<br>        冗余码 帧检验序列 FCS (Frame Check Sequence)：<br> <image src="picture\屏幕快照 2021-06-16 下午6.03.28.png"><br>        (1) 若得出的余数 R = 0，则判定这个帧没有差错，就接受 (accept)。<br>        (2) 若余数 R  0，则判定这个帧有差错，就丢弃。<br>        只能做到无差错接受 (accept)<br>        (要做到“可靠传输”（即发送什么就收到什么）就必须再加上确认和重传机制。)<br>        “无比特差错”与“无传输差错”是不同的概念。<br>    点对点协议 PPP (Point-to-Point Protocol):<br>        首要的要求:简单<br>        PPP 是面向字节的，所有的 PPP 帧的长度都是整数字节。<br>        同步传输链路时，协议规定采用硬件来完成比特填充（和 HDLC 的做法一样）：<br>            在使用SONET/SDH链路时，使用同步传输， PPP 协议采用零比特填充方法来实现透明传输<br>        用在异步传输时，就使用一种特殊的字符填充法<br>    广播信道：<br>        静态划分信道：<br>            频分复用<br>            时分复用<br>            波分复用<br>            码分复用<br>        动态媒体接入控制（多点接入）<br>        DIX Ethernet V2 是世界上第一个局域网产品（以太网）的规约<br>        IEEE 802.3 是第一个 IEEE 的以太网标准。<br>        通信适配器 (adapter) / 网络接口卡 NIC (Network Interface Card) / 网卡：网络接口板：<br>            重要功能：<br>                进行串行/并行转换。<br>                对数据进行缓存。<br>                在计算机的操作系统安装设备驱动程序。<br>                实现以太网协议。<br>        CSMA/CD协议：<br>            含义：载波监听 多点接入 / 碰撞检测<br>                “多点接入”    多点共线<br>                “载波监听”    先听后讲<br>                “碰撞检测”    边讲边听<br>            重要特性：<br>                只能半双工通信<br>                碰撞<br>            争用期 / 碰撞窗口：<br>                定义： 时间 2t（两倍的端到端往返时延）就可知道发送的数据帧是否遭受了碰撞<br>                长度：10 Mbit/s 以太网取 51.2 us 为争用期的长度<br>                发生碰撞的站在停止发送数据后，要推迟（退避）一个随机时间才能再发送数据<br>                从整数集合 [0, 1, … , (2k 1)] 中随机地取出一个数，记为 r。重传所需的时延就是 r 倍的基本退避时间<br>                    k = Min[重传次数, 10]<br>                传达 16 次仍不能成功时即丢弃该帧，并向高层报告<br>                强化碰撞：<br>                    (1) 立即停止发送数据；<br>                    (2) 再继续发送32/48比特的人为干扰信号,以便让所有节点都知道现在已经发生了碰撞。<br>            要点：1）准备发送<br>                 2）检测信道<br>                 3）检查碰撞 ：<br>                    两种可能性：发送成功 发送失败<br>            以太网采取了两种重要的措施：<br>                采用较为灵活的无连接的工作方式<br>                以太网发送的数据都使用曼彻斯特<br>        3.3.3集线器：<br>            1990 年，IEEE 制定出星形以太网 10BASE-T 的标准 802.3i<br>            每个站到集线器的距离不超过 100 m<br>            特点：<br>                集线器以太网逻辑上仍是总线网，仍使用 CSMA/CD 协议<br>                集线器工作在物理层，仅简单转发。<br>        3.3.4以太网的信道利用率：<br>                成功发送一个帧需要占用信道的时间是 T0 + T<br>                对以太网参数 α 的要求是：<br>                    当数据率一定时，以太网的连线的长度受到限制，否则 T 的数值会太大。<br>                    以太网的帧长不能太短，否则 T0 的值会太小，使 α 值太大。<br>                信道利用率的最大值 Smax ：<br>                    理想化的情况下<br>        3.3.5以太网的 MAC 层：<br>            硬件地址 / 物理地址 / MAC地址<br>                每个网卡有一个MAC地址<br>            必须保证生产出的适配器没有重复地址<br>            I/G（ Individual / Group）第一字节的最低位：<br>                当 I/G位 = 0 时，地址字段表示一个单站地址<br>                当 I/G位 = 1 时，表示组地址，用来进行多播<br>            G/L（Global / Local）<br>                当 G/L位 = 0 时，是全球管理<br>                当 G/L位 = 1 时，是本地管理<br>            适配器检查 MAC 地址：<br>                如果是发往本站的帧则收下，然后再进行其他的处理。<br>                否则就将此帧丢弃，不再进行其他的处理。<br>                发往本站的帧：<br>                    单播 (unicast) 帧（一对一）<br>                    广播 (broadcast) 帧（一对全体）<br>                    多播 (multicast) 帧（一对多）<br>                所有的适配器都至少能够识别单播地址和广播地址。<br>                只有目的地址才能使用广播地址和多播地址<br>                以混杂方式 (promiscuous mode) 工作的以太网适配器只要“听到”有帧在以太网上传输就都接收下来。<br>            以太网 V2 MAC 帧的格式：<br>                标准：DIX Ethernet V2 标准和IEEE 的 802.3 标准<br>                    最常用的 MAC 帧是以太网 V2 的格式<br>                数据字段的正式名称是 MAC 客户数据字段<br>                当数据字段的长度小于 46 字节时,应在数据字段的后面加入整数字节的填充字段，以保证以太网的 MAC 帧长不小于 64 字节。<br>                无效的 MAC 帧:<br>                    数据字段的长度与长度字段的值不一致<br>            IEEE 802.3 MAC 帧格式:<br>                与V2的区别：第三个字段是“长度 / 类型”<br>            帧间最小间隔：<br>                9.6us,为了使站的接收缓存来得及清理<br>    3.4 拓展的以太网：<br>        3.4.1 在物理层的扩展：<br>            使用光纤扩展<br>            使用集线器扩展：<br>                优点：使原来属于不同碰撞域的以太网上的计算机能够进行跨碰撞域的通信。<br>                      扩大了以太网覆盖的地理范围。<br>                缺点：碰撞域增大了，但总的吞吐量并未提高。<br>                      如果不同的碰撞域使用不同的数据率，那么就不能用集线器将它们互连起来。<br>        3.4.2 在数据链路层扩展：<br>            早期使用网桥，现在使用以太网交换机：<br>                网桥工作：根据 MAC 帧的目的地址对收到的帧进行转发和过滤<br>            交换式集线器淘汰了网桥：<br>                常称为以太网交换机 或二层交换机<br>            以太网交换机：<br>                特点：<br>                    以太网交换机是多接口的网桥<br>                    工作在全双工方式<br>                    具有并行性：<br>                        能同时连通多对接口，使多对主机能同时通信<br>                    相互通信的主机都是独占传输媒体，无碰撞地传输数据<br>                    接口有存储器<br>                    即插即用，地址表自学习<br>                交换方式：<br>                    存储转发方式<br>                        把整个数据帧先缓存后再进行处理<br>                    直通 (cut-through) 方式<br>                        接收同时就立即按数据帧的目的 MAC 地址<br>                        缺点：有可能也将一些无效帧转发给其他的站<br>                自学习功能：<br>                    交换表一开始是空的<br>                    先查找交换表，没有查到应从哪个接口转发这个帧<br>                    把这个帧的源地址 A 和接口 1 写入交换表中，并向除接口1以外的所有的接口广播这个帧<br>                    过滤：C 和 D 将丢弃这个帧，因为目的地址不对。只 B 才收下这个目的地址正确的帧<br>                    在交换表中每个项目都设有一定的有效时间。过期的项目就自动被删除<br>                    交换机自学习和转发帧的步骤归纳：<br>                        先进行自学习，查找表中有无相匹配的源地址的项目：<br>                            如没有，就在交换表中增加一个项目（源地址、进入的接口和有效时间）。<br>                            如有，则把原有的项目进行更新（进入的接口或有效时间）<br>                        转发帧，查找表中有无相匹配的源地址的项目：<br>                            如没有，则向所有其他接口（进入的接口除外）转发。<br>                            如有，则按交换表中给出的接口进行转发。<br>                            若交换表中给出的接口就是该帧进入交换机的接口，则应丢弃这个帧（因为这时不需要经过交换机进行转发）<br>                    增加冗余链路时，自学习的过程就可能导致以太网帧在网络的某个环路中无限制地兜圈子<br>                    交换以太网不使用共享总线<br>                    没有碰撞问题，不使用 CSMA/CD 协议，以全双工方式工作。但仍采用以太网的帧结构。<br>        3.4.3 虚拟局域网<br>            虚拟局域网 VLAN 是一种逻辑划分<br>            同VLAN小组成员收到广播信息，其他VLAN接受不到<br>            有利于防止：广播风暴<br>            VLAN 标记 (tag)：帧格式中插入一个4字节的标识符，用来指明发送该帧的计算机（接口）属于哪一个虚拟局域网<br>            插入 VLAN 标记得出的帧称：802.1Q 帧 或 带标记的以太网帧。<br>        3.5.1 100BASE-T 以太网 / 快速以太网(Fast Ethernet)<br>            代号：IEEE 802.3u<br>            高速以太网：速率达到或超过 100 Mbit/s 的以太网<br>            特点：在全双工方式下工作时，不使用 CSMA/CD 协议<br>                 MAC 帧格式仍然是 802.3 标准规定的<br>                 保持最短帧长不变，但将一个网段的最大电缆长度减小到 100 m<br>                 帧间时间间隔从原来的 9.6 s 改为现在的 0.96 us<br>        3.5.2 吉比特以太网<br>            在半双工方式下使用 CSMA/CD 协议，全双工方式不使用 CSMA/CD 协议<br>            使用两种成熟的技术：一种来自现有的以太网，另一种则是美国国家标准协会 ANSI 制定的光纤通道 FC  (Fiber Channel)<br>            半双工方式工作的吉比特以太网<br>                为保持 64 字节最小帧长度，以及 100 米的网段的最大长度，吉比特以太网增加了两个功能：<br>                    载波延伸 (carrier extension)<br>                        将争用时间增大为 512 字节<br>                    分组突发 (packet bursting)<br>            全双工方式工作的吉比特以太网<br>                不使用载波延伸和分组突发<br>            10 吉比特以太网和更快的以太网<br>                只工作在全双工方式<br>            端到端的以太网传输<br>                实现了端到端的以太网传输的好处：<br>                    技术成熟；<br>                    互操作性很好；<br>                    在广域网中使用以太网时价格便宜；<br>                    采用统一的以太网帧格式，简化了操作和管理<br>        3.5.3 以太网从 10 Mbit/s 到100 Gbit/s 的演进证明：<br>            可扩展的（从 10 Mbit/s 到 100 Gbit/s）；<br>            灵活的（多种传输媒体、全/半双工、共享/交换）；<br>            易于安装；<br>            稳健性好。<br>        3.5.4 使用以太网进行宽带接入<br>            特点：<br>                可以提供双向的宽带通信。<br>                可以根据用户对带宽的需求灵活地进行带宽升级。<br>                可以实现端到端的以太网传输，中间不需要再进行帧格式的转换。这就提高了数据的传输效率且降低了传输的成本。<br>                但是不支持用户身份鉴别。<br>            PPPoE (PPP over Ethernet)<br>                在以太网上运行 PPP，把 PPP 协议与以太网协议结合起来 —— 将 PPP 帧再封装到以太网中来传输</p>
<h1 第四章网络层>
    4.1  网络层提供的两种服务 
        面向连接 无连接 
        争论的实质是：可靠交付是网络负责，还是端系统负责。
        结论： “无连接”赢了
        让网络负责可靠交付：
            使用面向连接的通信方式
            先建立虚电路 (Virtual Circuit)
                虚电路是逻辑连接
                分组按照存储转发方式传送
                电路交换的电话通信是先建立了一条真正的连接
        网络提供数据报服务：
            网络层向上只提供简单灵活的、无连接的、尽最大努力交付的数据报服务
            网络层不提供服务质量的承诺
            尽最大努力交付：
                传输网络不提供端到端的可靠传输服务
                主机中的运输层负责可靠交付（包括差错处理、流量控制等）
    4.2 网际协议 IP
        地址解析协议 ARP(Address Resolution Protocol)
        网际控制报文协议 ICMP(Internet Control Message Protocol)
        网际组管理协议 IGMP(Internet Group Management Protocol)
        4.2.1 虚拟网络互联
            中间设备 / 中间系统 / 中继系统
                物理层中继系统：集线器 (repeater)。
                数据链路层中继系统：网桥 或 交换机。
                网络层中继系统：路由器 (router)。
                网桥和路由器的混合物：桥路器 (brouter)，二三层。
                网络层以上的中继系统：网关 (gateway)。  
            网络互联：
                中继系统是转发器或者网桥时，不称为网络互联，仍然是一个网络
                网络互连都是指用路由器进行网络互连和路由选择
                路由器称为网关
            虚拟网络互联
                虚拟互连网络也就是逻辑互连网络，
                利用 IP 协议就可以使这些性能各异的网络从用户看起来好像是一个统一的网络
                IP网：使用 IP 协议的虚拟互连网络
                好处：当互联网上的主机进行通信时，就好像在一个网络上通信一样，而看不见互连的各具体的网络异构细节。
                如果在这种覆盖全球的 IP 网的上层使用 TCP 协议，那么就是现在的互联网 (Internet)。
        4.2.2 分类的IP地址
            唯一的 32 位的标识符
            IP 地址现在由互联网名字和数字分配机构ICANN 进行分配
            IP地址的编址方法：
                1.分类的IP地址
                    公网 IP 地址在整个互联网范围内是唯一的。
                    私网 IP 地址在整个私网范围内是唯一的。
                    2进制开头 地址的网络号字段 主机号字段 每个网络最大主机数
                        A 0 8 24 2^24-2
                        B 10 16 16 2^16-2
                        C 110 24 8 2^8-2
                        D 1110 多播地址
                        E 1111 保留为今后使用
                    特殊的 IP 地址 全0 / 1
                    重要特点：
                        (1) IP 地址是一种分等级的地址结构
                        (2) 实际上 IP 地址是标志一个主机（或路由器）和一条链路的接口
                            多归属主机:具有两个IP地址，和不通的网络号
                        (3) 用转发器或网桥连接起来的若干个局域网仍为一个网络，因此这些局域网都（？一般）具有同样的网络号 net-id。网络号不同必须使用路由器连接
                        (4) 所有分配到网络号 net-id 的网络，都是平等的


<pre><code>            2.子网的划分
            3.构成超网
    4.2.3 IP 地址与硬件地址
        硬件地址（或物理地址）是数据链路层和物理层使用的地址
        IP 地址是网络层和以上各层使用的地址，是一种逻辑地址
            称 IP 地址是逻辑地址是因为 IP 地址是用软件实现的
        两个路由器的 IP 地址并不出现在 IP 数据报的首部中
    4.2.4 地址解析协议 ARP
        通信时使用了两个地址：IP 地址（网络层地址） MAC 地址（数据链路层地址）
        作用：已知IP地址，求硬件地址
        实际网络传送数据必须使用硬件地址
        每一个主机都设有一个ARP高速缓存，有IP地址到硬件地址的映射表
        当主机 A 欲向本局域网上的某个主机 B 发送 IP 数据报时：
            如有，就可查出其对应的硬件地址，再将此硬件地址写入 MAC 帧，并发送
            如没有， 本局域网广播一个 ARP 请求分组。收到 ARP 响应分组后，将得到的 IP 地址到硬件地址的映射写入 ARP 高速缓存。组MAC帧发送
        要点：
            ARP请求分组：包含发送方硬件地址 / 发送方 IP 地址 / 0 / 目标方 IP 地址。
            本地广播 ARP 请求（路由器不转发ARP请求）。
            ARP 响应分组：发送方硬件地址 / 发送方 IP地址 / 目标方硬件地址 / 目标方 IP 地址。
            ARP 分组封装在物理网络的帧中传输。
            抓包
        ARP 高速缓存的作用
            存放最近获得的 IP 地址到 MAC 地址的绑定，以减少 ARP 广播的数量。
            减少网络上的通信量
            主机 B (所有主机)收到 A 的 ARP 请求分组时，就将主机 A 的这一地址映射写入主机 B 自己的 ARP 高速缓存中。这对主机 B 以后向 A 发送数据报时就更方便了
    4.2.5 IP 数据报的格式
        由首部和数据两部分组成
            首部的前一部分是固定长度，共 20 字节
        IP首部长度占4位，可表示的最大数值是 15 个单位(一个单位为 4 字节)IP 的首部长度的最大值是 60 字节
        区分服务：占8位，实际上一直未被使用，一般情况下都不使用这个字段
        总长度：占16位，数据报最大长度为2^16-1字节
        原始数据报首部被复制为各数据报片的首部，但必须修改有关字段的值
        IP 数据报首部的可变部分
            从 1 个字节到 40 个字节不等
    4.2.6 IP 层转发分组的流程
        路由器分组转发算法 
            (1) 从数据报的首部提取目的主机的 IP 地址 D, 得出目的网络地址为 N。
            (2) 若网络 N 与此路由器直接相连，则把数据报直接交付目的主机 D；否则是间接交付，执行 (3)。
            (3) 若路由表中有目的地址为 D 的特定主机路由，则把数据报传送给路由表中所指明的下一跳路由器；否则，执行 (4)。
            (4) 若路由表中有到达网络 N 的路由，则把数据报传送给路由表指明的下一跳路由器；否则，执行 (5)。
            (5) 若路由表中有一个默认路由，则把数据报传送给路由表中所指明的默认路由器；否则，执行 (6)。
            (6)  报告转发分组出错。 
4.3 划分子网和构造超网
    4.3.1   划分子网
        基本思路
            划分子网纯属一个单位内部的事情
            从主机号借用若干个位作为子网号 subnet-id
        子网的掩码
            从一个 IP 数据报的首部并无法判断是否进行了子网划分
            使用子网掩码 (subnet mask) 可以找出 IP 地址中的子网部分
            规则
                子网掩码长度 ＝ 32 位
                某位 ＝ 1：IP地址中的对应位为网络号和子网号
                某位 ＝ 0：IP地址中的对应位为主机号  
        子网划分方法
            文档规定不能为全 1 或全 0，现在全 1 和全 0 的子网号也可以使用了
            划分子网增加了灵活性，但却减少了能够连接在网络上的主机总数。
</code></pre>
<image src="picture/屏幕快照 2021-06-17 下午7.53.36.png">
                子网数：192=128+64(n=2)
                       2^n-2:子网数
                子网主机数：2^(16-n)-2
        4.3.2  在划分子网情况下路由器转发分组的算法 
            (1) 从收到的分组的首部提取目的 IP 地址 D。
            (2) 先用各网络的子网掩码和 D 逐位相“与”，看是否和相应的网
                络地址匹配。若匹配，则将分组直接交付。否则就是间接交付，
                执行 (3)。
            (3) 若路由表中有目的地址为 D 的特定主机路由，则将分组传送给
                指明的下一跳路由器；否则，执行 (4)。
            (4) 对路由表中的每一行，将子网掩码和 D 逐位相“与”。若结果与该行的目的网络地址匹配，则将分组传送给该行指明的下一跳路由器；否则，执行 (5)。
            (5) 若路由表中有一个默认路由，则将分组传送给路由表中所指明
                的默认路由器；否则，执行 (6)。
            (6) 报告转发分组出错。
            【例4-4】已知互联网和路由器 R1 中的路由表。主机 H1 向 H2 发送分组。试讨论 R1 收到 H1 向 H2 发送的分组后查找路由表的过程。
            ppt 475
        4.3.3  无分类编址 CIDR
            变长子网掩码 VLSM (Variable Length Subnet Mask) / 无分类域间路由选择 CIDR (Classless Inter-Domain Routing)
            特点：
                消除了传统的 A 类、B 类和 C 类地址以及划分子网的概念
                使用各种长度的“网络前缀”(network-prefix)
                斜线记法”(slash notation) / CIDR 记法
            CIDR地址块：
                128.14.32.0/20 表示的地址块共有 2^12（4*8-20） 个地址（因为斜线后面的 20 是网络前缀的位数，所以这个地址的主机号是 12 位）。
                    这个地址块的起始地址是 128.14.32.0。
                    在不需要指出地址块的起始地址时，也可将这样的地址块简称为“/20 地址块”。
                    128.14.32.0/20 地址块的最小地址：128.14.32.0
                    128.14.32.0/20 地址块的最大地址：128.14.47.255
                    全 0 和全 1 的主机号地址一般不使用。
                路由聚合：
                    一个 CIDR 地址块可以表示很多地址
                    有利于减少路由器之间的路由选择信息的交换，从而提高了整个互联网的性能有利于减少路由器之间的路由选择信息的交换，从而提高了整个互联网的性能
                    路由聚合也称为构成超网 (supernetting)
                    仍然使用“掩码”
                    对于 /20  地址块，它的掩码是 20 个连续的 1。 斜线记法中的数字就是掩码中1的个数
                    10.0.0.0/10 可简写为 10/10
                    10.0.0.0 的掩码是 255.192.0.0
                    星号 * ：
                        在星号 * 之前是网络前缀，而星号 * 表示 IP 地址中的主机号，可以是任意值
                    最长前缀匹配 (longest-prefix matching) /最长匹配或最佳匹配
                        选择两个匹配的地址中更具体的一个，即选择最长前缀的地址
    4.4  网际控制报文协议 ICMP
            有效地转发 IP 数据报和提高交付成功
            ICMP 询问报文有两种 
                回送请求和回答报文
                时间戳请求和回答报文
            4.4.2  ICMP 的应用举例
                PING 用来测试两个主机之间的连通性,使用了 ICMP 回送请求与回送回答报文
                Tracerout 用来跟踪一个分组从源点到终点的路径
    4.5  互联网的路由选择协议
        4.5.1  有关路由选择协议的几个基本概念
                内部网关协议 IGP (Interior Gateway Protocol)
                    自治系统内部使用
                外部网关协议 EGP (External Gateway Protocol)    
                    不同的自治系统之间传路由选择信息
        4.5.2  内部网关协议 RIP
            分布式的、基于距离向量的路由选择协议
            要求网络中的每一个路由器都要维护从它自己到其他每一个目的网络的距离记录
            距离 / 跳数 / 最短距离：
                从一个路由器到直接连接的网络的距离定义为 1
                每经过一个路由器，跳数就加 1
                一个好的路由，距离短
                一条路径最多只能包含 15 个路由器，“距离”的最大值为 16 时即相当于不可达
                RIP 不能在两个网络之间同时使用多条路由
            三个特点：
                仅和相邻路由器交换信息
                交换的信息是当前本路由器所知道的全部信息，即自己的路由表
                按固定的时间间隔交换路由信息
            路由表的建立
                刚刚开始工作，路由表是空的
                收敛 (convergence) 过程较快    
                距离向量算法
                    路由器收到相邻路由器（其地址为 X）的一个 RIP 报文：
                    (1) 先修改此 RIP 报文中的所有项目：把“下一跳”字段中的地址都改为 X，并把所有的“距离”字段的值加 1。
                    (2) 对修改后的 RIP 报文中的每一个项目，重复以下步骤：
                        若项目中的目的网络不在路由表中，则把该项目加到路由表中。
                        否则若下一跳字段给出的路由器地址是同样的，则把收到的项目替换原路由表中的项目。
                        否则若收到项目中的距离小于路由表中的距离，则进行更新，否则，什么也不做。
                    (3) 若 3 分钟还没有收到相邻路由器的更新路由表，则把此相邻路由器记为不可达路由器，即将距离置为 16（表示不可达）。
                    (4) 返回。
                    <image src="picture/屏幕快照 2021-06-18 上午11.50.49.png">
            协议特点：好消息传播得快，坏消息传播得慢。
            RIP 存在的一个问题：当网络出现故障时，要经过比较长的时间 (例如数分钟) 才能将此信息传送到所有的路由器。
            优点：实现简单，开销较小。
            缺点：RIP 限制了网络的规模，它能使用的最大距离为 15（16 表示不可达）。
            路由器之间交换的是完整路由表，因而网络规模越大，开销就越大。 
            “坏消息传播得慢”，使更新过程的收敛时间过长。
        4.5.3  内部网关协议 OSPF 开放最短路径优先 OSPF (Open Shortest Path First)
            “开放”表明 OSPF 不受某一厂商控制，而是公开的
            “最短路径优先”是因为使用了 Dijkstra 提出的最短路径算法 SPF
            要点：只有链路状态发生变化，才用IP 数据报和洪泛法发送链路状态（度量） 
            三个要点
                向本自治系统中所有路由器发送信息，洪泛法
                发送的信息就是与本路由器相邻的所有路由器的链路状态，但这只是路由器所知道的部分信息。
                只有当链路状态变化时，路由器才用洪泛法向所有路由器发送此信息
            链路状态数据库 (link-state database) 
                由所有的路由器最终建立
                全网的拓扑结构图，它在全网范围内是一致的
                OSPF 的链路状态数据库能较快地进行更新
            其他特点：
                OSPF 对于不同类型的业务可计算出不同的路由
                多路径间的负载平衡：到同一个目的网络有多条相同代价的路径，那么可以将通信量分配给这几条路径
                所有在 OSPF 路由器之间交换的分组都具有鉴别的功能
                支持可变长度的子网划分和无分类编址 CIDR
        4.5.4  外部网关协议 BGP
            不同自治系统的路由器之间交换路由信息的协议
            只是力求寻找一条能够到达目的网络且比较好的路由（不能兜圈子），而并非要寻找一条最佳路由
            先建立 TCP 连接
            特点：
                自治系统数的量级
                BGP 支持 CIDR
                更新有变化的部分。这样做对节省网络带宽和减少路由器的处理开销都有好处。 
        4.5.5  路由器的构成
            “转发”和“路由选择”的区别 
                转发：路由器根据转发表将用户的 IP 数据报从合适的端口转发出去
                路由选择：按照分布式算法，根据从各相邻路由器得到的关于网络拓扑的变化情况，动态地改变所选择的路由
            分组丢弃：
                路由器中的输入或输出队列产生溢出是造成分组丢失的重要原因
    4.6  IPv6
        4.6.1  IPv6 的基本首部
            主要变化：
                更大的地址空间。从 IPv4 的 32 位 增大到128 位。 
                扩展的地址层次结构。 
                灵活的首部格式。 定义了许多可选的扩展首部。
                改进的选项。 允许数据报包含有选项的控制信息
                允许协议继续扩充。 
                支持即插即用（即自动配置）。不需要 DHCP。
                支持资源的预分配。  支持特定带宽和时延的应用。
                IPv6 首部 8 字节对齐。 IPv4 首部是 4 字节对齐。          
            数据报：
                由基本首部（40个字节）有效载荷（不超过65535）两大部分组成
                对首部的更改：
                    取消了首部长度字段，因为首部长度是固定的 40 字节；
                    取消了服务类型字段；
                    取消了总长度字段，改用有效载荷长度字段；
                    把 TTL 字段改称为跳数限制字段；
                    取消了协议字段，改用下一个首部字段；
                    取消了检验和字段；
                    取消了选项字段，而用扩展首部来实现选项功能。
            拓展首部
                IPv6 把原来 IPv4 首部中选项的功能都放在扩展首部中，大大提高了路由器的处理效率
                六种扩展首部：  
                    (1) 逐跳选项
                    (2) 路由选择
                    (3) 分片
                    (4) 鉴别
                    (5) 封装安全有效载荷
                    (6) 目的站选项 
        4.6.2  IPv6 的地址
            (1) 单播 (unicast)：传统的点对点通信。
            (2) 多播 (multicast)：一点对多点的通信。
            (3) 任播 (anycast)：这是 IPv6 增加的一种类型。任播的目的站是一组计算机，但数据报在交付时只交付其中的一个，通常是距离最近的一个。 
            冒号十六进制记法
                零压缩
                    即一连串连续的零可以为一对冒号所取代
                    注意：在任一地址中只能使用一次零压缩。
                    CIDR 的斜线表示法仍然可用。
                    例如：60 位的前缀 12AB00000000CD3 可记为：
                    12AB:0000:0000:CD30:0000:0000:0000:0000/60
                    或 12AB::CD30:0:0:0:0/60 （零压缩）
                    或 12AB:0:0:CD30::/60 （零压缩）
        4.6.3  从 IPv4 向 IPv6 过渡
                只能采用逐步演进的办法，使新安装的 IPv6 系统能够向后兼容
                两种向 IPv6 过渡的策略：
                    使用双协议栈
                    使用隧道技术
                双协议栈
                    使一部分主机（或路由器）装有两个协议栈，一个 IPv4 和一个 IPv6
                    同时具有两种 IP 地址：一个 IPv6 地址和一个 IPv4 地址
                隧道技术
                    在 IPv6 数据报要进入 IPv4 网络时，把 IPv6 数据报封装成为 IPv4 数据报
        4.6.4  ICMPv6
            IPv6 也不保证数据报的可靠交付（IPv4也不可靠交付）
            地址解析协议 ARP 和网际组管理协议 IGMP 协议的功能都已被合并到 ICMPv6 中           
    4.7  IP 多播
        4.7.1  IP 多播的基本概念
            IP 多播 (multicast，以前曾译为组播)，一对多通信
                在互联网上进行多播就叫做 IP 多播。
                互联网范围的多播要靠路由器来实现。
                多播数据报的目的地址是多播 IP 地址。
                多播IP 地址是 D 类地址。
                多播地址只能用于目的地址，不能用于源地址
            多播数据报
                使用网际组管理协议 IGMP
                多播数据报也是“尽最大努力交付”。
                对多播数据报不产生 ICMP 差错报文。
        4.7.2  在局域网上进行硬件多播 
            IANA 拥有的以太网地址块的高 24 位为 00-00-5E
            TCP/IP 协议使用的以太网多播地址块的范围
                    从   01-00-5E-00-00-00 
                    到   01-00-5E-7F-FF-FF 
            D 类 IP 地址可供分配的有 28 位，前 5 位不能用来构成以太网硬件地址
            由于多播 IP 地址与以太网硬件地址的映射关系不是唯一的，因此收到多播数据报的主机，还要在 IP 层利用软件进行过滤，把不是本主机要接收的数据报丢弃。
        4.7.3  网际组管理协议 IGMP和多播路由选择协议
            IP 多播需要两种协议
                网际组管理协议 IGMP (Internet Group Management Protocol)
                多播路由选择协议
            多播路由选择协议更为复杂
                动态地适应多播组成员的变化
                不能仅仅根据多播数据报中的目的地址，而是还要考虑这个多播数据报从什么地方来和要到什么地方去
                多播数据报可以由没有加入多播组的主机发出
    4.8  虚拟专用网 VPN和网络地址转换 NAT
        4.8.1  虚拟专用网 VPN (Virtual Private Network)
            本地(私网)地址
            全球(公网)地址
            专用地址只能用作本地地址
                在互联网中的所有路由器，对目的地址是专用地址的数据报不转发
            RFC 1918 指明的专用 IP 地址三个专用 IP 地址块：
                (1) 10.0.0.0 到 10.255.255.255
                    A类，或记为10.0.0.0/8，它又称为 24 位块
                (2) 172.16.0.0 到 172.31.255.255
                    B类，或记为172.16.0.0/12，它又称为 20 位块
                (3) 192.168.0.0 到 192.168.255.255
                    C类，或记为192.168.0.0/16，它又称为 16 位块
            利用公网作为本机构各专用网(私网)之间的通信载体，这样的专用网又称为虚拟专用网VPN
                专用网
                    是为本机构的主机用于机构内部的通信，而不是用于和网络外非本机构的主机通信
        4.8.2   网络地址转换 NAT
            使用本地地址的主机在和外界通信时，将其本地地址转换成全球 IP 地址 
            两次地址转换：
                离开专用网时：替换源地址，将内部地址替换为全球地址；
                进入专用网时：替换目的地址，将全球地址替换为内部地址；
            当 NAT 路由器具有 n 个全球 IP 地址时，专用网内最多可以同时有 n 台主机接入到互联网
            通过 NAT 路由器的通信必须由专用网内的主机发起，专用网内部的主机不能充当服务器用
            网络地址与端口号转换 NAPT
                运输层的端口号也利用上，共用一个 NAT 路由器上的全球 IP 地址
                网络地址与端口号转换NAPT (Network Address and Port Translation)，不使用端口号的 NAT 就叫做传统的 NAT
    4.9  多协议标记交换 MPLS
        MPLS 并没有取代 IP，而是一种 IP 增强技术
        为了提高传统路由器IP 分组的转发效率，在 MPLS 域的入口处，给每一个 IP 数据报打上固定长度“标记”，然后对打上标记的 IP 数据报用硬件进行转发
<h1 第 5 章  运输层>
    5.1  运输层协议概述
        5.1.1  进程之间的通信
            网络层：主机之间提供逻辑通信
            运输层：应用进程之间提供端到端的逻辑通信（ IP+端口），复用和分用。
            运输层还要对收到的报文进行差错检测。
            运输层有两种不同的运输协议，即面向连接的 TCP 和无连接的 UDP。   
        5.1.2  运输层的两个主要协议
            (1) 用户数据报协议 UDP (User Datagram Protocol)
            (2) 传输控制协议 TCP (Transmission Control  Protocol)
            UDP：无连接、不可靠、不拆包。单播、多播和广播
            TCP：面向连接、可靠、全双工。只能单播，不能广播或多播。可靠的，开销大。  
        5.1.3  运输层的端口
            UDP和TCP都使用16 位端口号
            网络层的协议类型字段类似于传输层端口号字段
            两类端口 
                (1) 服务器端使用的端口号
                    熟知端口，数值一般为 0~1023。
                    登记端口号，数值为 1024~49151，为没有熟知端口号的应用程序使用的。使用这个范围的端口号必须在 IANA 登记，以防止重复
                (2) 客户端使用的端口号
                    又称为短暂端口号，数值为 49152~65535，留给客户进程选择暂时使用。
            常用的熟知端口
                UDP
                    RPC 111
                    DNS 53
                    TFTP 69
                    SNMP 161
                    SNMP(trap) 162
                TCP
                    SMTP 25
                    FTP 21|20
                    Telent 23
                    HTTP 80
                    HTTPS 443
    5.2  用户数据报协议 UDP
        5.2.1 UDP 的主要特点 
            (1) UDP 是无连接的
            (2) UDP 使用尽最大努力交付
            (3) UDP 是面向报文的
            (4) UDP 没有拥塞控制
            (5) UDP 支持一对一、一对多、多对一和多对多的交互通信。
            (6) UDP 的首部开销小，只有 8 个字节，比 TCP 的 20 个字节的首部要短。
    5.3  传输控制协议 TCP 概述
        5.3.1  TCP 最主要的特点 
            (1) TCP 是面向连接
            (2) TCP 连接只能有两个端点，只能点对点（1对1）
            (3) TCP 是可靠交付
            (4) TCP 全双工通信
            (5) TPC 面向字节流(报文长度进程不可控)
        5.3.2  TCP 的连接 
            把连接作为最基本的抽象
            每一条 TCP 连接有两个端点
            TCP 连接的端点叫做套接字 (socket) 或插口
                端口号拼接到 (contatenated with) IP 地址即构成了套接字
            每一条 TCP 连接唯一地被通信两端的两个端点（即两个套接字）所确定
            TCP 可靠通信的具体实现 
                一个发送窗口和一个接收窗口
                用字节的序号进行控制
                两端的四个窗口经常处于动态变化之中
                使用特定的算法估算较为合理的重传时间
    5.4  可靠传输的工作原理
        5.4.1  停止等待协议
            全双工通信的双方既是发送方也是接收方。
            在发送完一个分组后，必须暂时保留已发送的分组的副本，以备重发
            分组和确认分组都必须进行编号。
            超时计时器的重传时间应当比数据在分组传输的平均往返时间更长一些
            停止等待协议的优点是简单，缺点是信道利用率太低。
        5.4.2  连续ARQ协议
            累积确认
            对按序到达的最后一个分组发送确认
            优点：容易实现，即使确认丢失也不必重传。
            缺点：不能向发送方反映出接收方已经正确收到的所有分组的信息。
            Go-back-N（回退 N） 
                表示需要再退回来重传已发送过的 N 个分组
            当通信线路质量不好时，连续 ARQ 协议会带来负面的影响
    5.5  TCP 报文段的首部格式
        TCP 报文段首部的前 20 个字节是固定的，TCP 首部的最小长度是 20 字节
        若选择较小的 MSS 长度，网络的利用率就降低
        为什么要规定 MSS ？
            只含有 1 字节的数据时
                在 IP 层传输的数据报的开销至少有 40 字节(包括 TCP 报文段的首部和 IP 数据报的首部)。这样，对网络的利用率就不会超过 1/41
            TCP 报文段非常长
                IP 层传输时就有可能要分解成多个短数据报片。在终点要把收到的各个短数据报片装配成原来的 TCP 报文段。当传输出错时还要进行重传也都会使开销增大
            MSS 应尽可能大些，只要在 IP 层传输时不需要再分片就行，最佳的 MSS 是很难确定的
    5.6  TCP 可靠传输的实现
        5.6.1  以字节为单位的滑动窗口
            发送缓存与接收缓存的作用
                发送缓存用来暂时存放：
                    发送应用程序传送给发送方 TCP 准备发送的数据；
                    TCP 已发送出但尚未收到确认的数据。
                接收缓存用来暂时存放：
                    按序到达的、但尚未被接收应用程序读取的数据；
                    不按序到达的数据。 
            1. A 的发送窗口并不总是和 B 的接收窗口一样大（因为有一定的时间滞后）
            2. 第二，TCP 标准没有规定对不按序到达的数据应如何处理。
            3. TCP 要求接收方必须有累积确认的功能
            接收方可以在合适的时候发送确认，也可以在自己有数据要发送时把确认信息顺便捎带上
        5.6.2  超时重传时间的选择
            加权平均往返时间
                保留了 RTT 的一个加权平均往返时间 RTTS（这又称为平滑的往返时间）
                RFC 2988 推荐的 a 值为 1/8，即 0.125
            超时重传时间 RTO
                RTO (Retransmission Time-Out) 应略大于上面得出的加权平均往返时间 RTTS。
                RTTD：是 RTT 的偏差的加权平均值
            Karn 算法
                新的问题：超时重传时间就无法更新
                修正的 Karn 算法
                    报文段每重传一次，就把 RTO 增大一些
                        新的 RTO = y X (旧的 RTO)
                        系数 y 的典型值是 2
        5.6.3  选择确认 SACK
            解决的问题：若收到的报文段无差错，只是未按序号，中间还缺少一些序号的数据，那么能否设法只传送缺少的数据而不重传已经正确到达接收方的数据
                答案是可以的。选择确认 SACK  (Selective ACK) 就是一种可行的处理方法
            每一个字节块都有两个边界：左边界和右边界
    5.7  TCP 的流量控制
        5.7.1  利用滑动窗口实现流量控制
            方法：利用滑动窗口机制
            报文段在传送过程中丢失，发送方和接收方在相互等待，可能会造成互相等待的死锁，因此TCP 为每一个连接设有一个持续计时器 (persistence timer)
                持续计时器：
                    只要 TCP 连接的一方收到对方的零窗口通知，就启动该持续计时器
        5.7.2  必须考虑传输效率
            用不同的机制来控制 TCP 报文段的发送时机
                第一种机制是 TCP 维持一个变量，它等于最大报文段长度 MSS。只要缓存中存放的数据达到 MSS 字节时，就组装成一个 TCP 报文段发送出去
                第二种机制是由发送方的应用进程指明要求发送报文段，即 TCP 支持的推送 (push)操作
                第三种机制是发送方的一个计时器期限到了，这时就把当前已有的缓存数据装入报文段（但长度不能超过 MSS）发送出去    
    5.8  TCP 的拥塞控制
        5.8.1  拥塞控制的一般原理
            出现拥塞的原因：资源需求>可用资源
                拥塞控制是动态的、
                分组的丢失是征兆，不是原因
            开环控制和闭环控制
                开环控制：在设计网络时事先考虑周到
                闭环控制：基于反馈环路：
                    检测何时何地发生
                    传送到可采取行动的地方
                    调整网络系统的运行
        5.8.2  TCP 的拥塞控制方法
            采用基于窗口的方法，TCP发送方维持一个拥塞窗口 CWND (Congestion Window)
            拥塞的判断
                重传定时器超时
                收到三个相同（重复）的 ACK
            TCP拥塞控制算法
                慢开始 (slow-start)
                    思路：由小到大逐渐增大拥塞窗口数值
                    拥塞窗口 cwnd  控制方法：在每收到一个对新的报文段的确认后，可以把拥塞窗口增加最多一个 SMSS 的数值
                    传输轮次 
                        拥塞窗口 cwnd 就加倍
                        所经历的时间就是往返时间 RTT
                    设置慢开始门限状态变量 ssthresh
                        当 cwnd < ssthresh 时，使用慢开始算法。
                        当 cwnd > ssthresh 时，停止使用慢开始算法而改用拥塞避免算法。
                        当 cwnd = ssthresh 时，既可使用慢开始算法，也可使用拥塞避免算法。
                拥塞避免 (congestion avoidance)
                    思路：让拥塞窗口 cwnd 缓慢地增大，使拥塞窗口 cwnd 按线性规律缓慢增长
                        因此在拥塞避免阶段就有“加法增大”
                    当网络出现拥塞时（重传定时器超时）
                        发送方判断网络出现拥塞（重传定时器超时）：
                            ssthresh = max(cwnd/2，2)
                            cwnd = 1
                            执行慢开始算法
                    非指完全能够避免了拥塞，而是使网络比较不容易出现拥塞
                    <image src="picture/拥塞避免.png">
                快重传 (fast retransmit)
                    尽早知道发生了个别报文段的丢失
                    发送方只要一连收到三个重复确认，就知道接收方确实没有收到报文段，因而应当立即进行重传（即“快重传”）
                快恢复 (fast recovery)
                    (1) 慢开始门限ssthresh=当前拥塞窗口cwnd/2 ；
                    (2) 新拥塞窗口 cwnd = 慢开始门限 ssthresh ；
                    (3) 开始执行拥塞避免算法，使拥塞窗口缓慢地线性增大。 
                加法增大,乘法减小(AIMD)
        5.8.3  主动队列管理 AQM
            网络层对TCP拥塞控制影响最大的是路由器的分组丢弃策略
            路由器的队列
                “先进先出”FIFO 
                当队列已满时，尾部丢弃策略
                全局同步 (global syncronization)
                    很多TCP连接中的报文段服用在网络层IP数据报中，这时发生尾部丢弃，使这许多 TCP 连接在同一时间突然都进入到慢开始状态
                主动队列管理AQM
                    应当在队列长度达到某个值得警惕的数值时（即当网络拥塞有了某些拥塞征兆时），就主动丢弃到达的分组
                    随机早期检测 RED (Random Early Detection)
                        若平均队列长度小于最小门限 THmin，则将新到达的分组放入队列进行排队
                        若平均队列长度超过最大门限 THmax，则将新到达的分组丢弃
                        若平均队列长度在最小门限 THmin 和最大门限THmax 之间，则按照某一概率 p 将新到达的分组丢弃
                        RED 的使用效果并不太理想
                        AQM 实际上就是对路由器中的分组排队进行智能管理，而不是简单地把队列的尾部丢弃
    5.9  TCP 的运输连接管理
        TCP运输的三个阶段
            连接建立
            数据传送
            连接释放
        运输连接的管理
            使运输连接的建立和释放都能正常地进行
        TCP连接的建立采用客户服务器方式
            客户：主动发起连接建立的应用进程
            服务器：被动等待连接建立的应用进程
        5.9.1  TCP 的连接建立
            握手:TCP建立连接的过程
                三报文握手：客户和服务器之间交换三个 TCP 报文段
                    主要是为了防止已失效的连接请求报文段突然又传送到了，因而产生错误
        5.9.2  TCP 的连接释放
            四报文握手：TCP 连接释放过程
            TCP 连接处于半关闭状态
            必须等待 2MSL 的时间
                第一，为了保证 A 发送的最后一个 ACK 报文段能够到达 B
                第二，防止 “已失效的连接请求报文段”出现在本连接中。
        5.9.3  TCP 的有限状态机
            粗实线箭头表示对客户进程的正常变迁。
            粗虚线箭头表示对服务器进程的正常变迁。
            细线箭头表示异常变迁。

<p>1.浏览器输入一个网址，每层用到哪些协议，其作用是什么<br>    应用层：HTTP:WWW访问协议，DNS:域名解析服务<br>    传输层：TCP:为HTTP提供可靠的数据传输，UDP：DNS使用UDP传输<br>    网络层：IP:IP包传输和路由选择，ICMP：提供网络传输中的差错检测，ARP：将本机的默认网关IP地址映射城物理MAC地址</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/06/21/hello-world/" rel="prev" title="Hello World">
      <i class="fa fa-chevron-left"></i> Hello World
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">1.</span> <span class="nav-text">


三大网络：电信网络 有线电视网络 计算机网络
互连网：指在局部范围互连起来的计算机网
互联网：指当今世界上最大的计算机网络。 Internet。
互联网2个重要基本特点：连通性 共享
主机：与网络相连的计算机
网络：把许多计算机连接在一起
互连网：把许多网络通过路由器连接在一起
互联网基础结构发展的三个阶段：
第一阶段：arpanet
第二阶段：建成了三级结构的互联网
第三阶段：逐渐形成了多层次 ISP 结构的互联网
ISP：主干 ISP、地区 ISP 和 本地 ISP。
互联网草案：不是RFC文档
建议标准：开始成为RFC文档
从互联网的工作方式上看，可以划分为两大块：边缘部分 核心部分
主机又称为端系统
端系统在功能上可能有很大的差别
主机 A 和主机 B 进行通信实际上是指：“运行在主机 A 上的某个程序和运行在主机 B 上的另一个程序进行通信”。
端系统之间的两种通信方式
C&#x2F;S:客户-服务器方式
P2P:对等方式
客户是服务的请求方，服务器是服务的提供方。
C&#x2F;S:
客户软件的特点:被用户调用后运行
服务器软件的特点: 一直不断地运行着，被动地等待
客户与服务器的通信关系建立后，通信可以是双向的，客户和服务器都可发送和接收数据。
P2P:
平等的、对等连接通信
每一个主机既是客户又是服务器
在网络核心部分起特殊作用的是路由器
路由器实现：分组交换，转发
每一部电话都直接连接到交换机上，而交换机使用交换的方法，让电话用户彼此之间可以很方便地通信。
所采用的交换方式就是电路交换 (circuit switching)。
电路交换特点：面向连接
电路交换三个阶段：建立连接，通信，释放连接
分组交换：存储转发技术
在发送端，先把较长的报文划分成较短的、固定长度的数据段。
在每个数据段前面加上首部构成分组
分组交换网以“分组”作为数据传输单元。
依次把各分组发送到接收端
首部的重要性：
每一个分组的首部都含有地址
结点交换机根据收到的地址，把分组转发到下一个结点交换机
每个分组在互联网中独立地选择传输路径
用这样的存储转发方式，最后分组就能到达最终目的地
互联网的核心部分是由许多网络和把它们互连起来的路由器组成，而主机处在互联网的边缘部分
路由器之间用高速链路相连接，主机连接到路由器之间用相对较低速率链路连接
主机用途：为用户进行信息处理，可以和其他主机通过网络交换信息
路由器用途：进行分组交换
在路由器中的输入和输出端口之间没有直接连线。
路由器处理分组的过程是：
把收到的分组先放入缓存（暂时存储）；
查找转发表，找出到某个目的地址应从哪个端口转发；
把分组送到适当的端口转发出去。 
分组交换的优点：
高效，动态分配传输带宽
灵活，为每一个分组独立地选择最适合的转发路由
迅速，以分组作为传送单位，可以不先建立连接就能向其他主机发送分组
可靠，可靠的网络协议，分布式多路由分组交换网
分组交换带来的问题：在各结点需要排队，带来一定时延
，分组必须携带首部，造成一定的开销
存储转发原理：
报文交换，自古的邮政、现在的快递 
三种交换比较


若要连续传送大量的数据，且其传送时间远大于连接建立时间，则电路交换的传输速率较快。
报文交换和分组交换不需要预先分配传输带宽，在传送突发数据时可提高整个网络的信道利用率。
由于一个分组的长度往往远小于整个报文的长度，因此分组交换比报文交换的时延小，同时也具有更好的灵活性。
计算机网络定义：计算机网络主要是由一些通用的、可编程的硬件（一定包含有中央处理机 (CPU））互连而成的
按照网络作用范围分类：广域网WAN(Wide Area Network)
城域网MAN (Metropolitan Area Network)
局域网LAN (Local Area Network)
个人区域网 PAN (Personal Area Network) 
若中央处理机之间的距离非常近（如仅1米的数量级甚至更小些），则一般就称之为多处理机系统，而不称它为计算机网络。 
按照网络的使用者进行分类：
公用网 (public network)
专用网 (private network) 
用来把用户接入到互联网的网络：
接入网 AN (Access Network)
接入网是从某个用户端系统到互联网中的第一个路由器（也称为边缘路由器）之间的一种网络。
计算机网络的性能指标
速率 带宽 吞吐率 时延 时延带宽积 往返时间RTT 利用率
速率：数据的传送速率 也成数据率，比特率
速率的单位是 bit&#x2F;s，或 kbit&#x2F;s、Mbit&#x2F;s、 Gbit&#x2F;s 等
速率往往是指额定速率或标称速率，非实际运行速率
带宽：频带宽度 ，最高数据率即比特每秒
在时间轴上信号的宽度随带宽的增大而变窄

吞吐量：以便知道实际上到底有多少数据量能够通过网络
时延：（延迟&#x2F;迟延）发送时延 传播时延 处理时延 排队时延 
发送时延（传送时延）&#x3D; 数据帧长度（bit）&#x2F; 发送速率（bit&#x2F;s）
发送时延与传播时延有本质上的不同
信号发送速率和信号在信道上的传播速率是完全不同的概念
传播时延 &#x3D; 信道长度（米）&#x2F; 信号在信道上的传播速率（米&#x2F;秒）
排队时延：排队等待处理
排队时延的长短往往取决于网络中当时的通信量
总时延 &#x3D; 发送时延 + 传播时延 + 处理时延 + 排队时延
对于高速网络链路，我们提高的仅仅是数据的发送速率而不是比特在链路上的传播速率
“在高速链路（或高带宽链路）上，比特会传送得更快些”。（x）
链路的时延带宽积又称为以比特为单位的链路长度。
时延带宽积 &#x3D; 传播时延 x 带宽
往返时间RTT &#x3D; 表示从发送方发送数据开始，到发送方收到来自接收方的确认，总共经历的时间。（包括各中间结点）
利用率：分为信道利用率和网络利用率
信道利用率指出某信道有百分之几的时间是被利用的（有数据通过）。完全空闲的信道的利用率是零。
网络利用率则是全网络的信道利用率的加权平均值。
信道利用率并非越高越好。当某信道的利用率增大时，该信道引起的时延也就迅速增加。
系统网络体系结构SNA (System Network Architecture)
由于网络体系结构的不同，不同公司的设备很难互相连通。
开放系统互连基本参考模型 OSI&#x2F;RM (Open Systems Interconnection Reference Model)，简称为 OSI。
OSI失败原因
OSI 的专家们在完成 OSI 标准时没有商业驱动力；
OSI 的协议实现起来过分复杂，且运行效率很低；
OSI 标准的制定周期太长，因而使得按 OSI 标准生产的设备无法及时进入市场；
OSI 的层次划分也不太合理，有些功能在多个层次中重复出现。  
非国际标准 TCP&#x2F;IP 却获得了最广泛的应用。TCP&#x2F;IP 常被称为事实上国际标准
网络协议的三个组成要素：
语法，语义，同步
协议的两种形式：文字描述，程序代码
都必须能够对网络上信息交换过程做出精确的解释
声、光、电、味、温、触觉、震动、量子纠缠、第六感
ARPANET 的研制经验表明，对于复杂的计算机网络协议，结构应该是层次式的
分层的优点：
各层之间是独立的。
灵活性好。
结构上可分割开。
易于实现和维护。
能促进标准化工作。
缺点：
降低效率。
有些功能会在不同的层次中重复出现，因而产生了额外开销。
各层完成的主要功能
① 差错控制：使相应层次对等方的通信更加可靠。
② 流量控制：发送端的发送速率必须使接收端来得及接收，不要太快。
③ 分段和重装 ：发送端将要发送的数据块划分为更小的单位，在接收端将其还原。
④ 复用和分用：发送端几个高层会话复用一条低层的连接，在接收端再进行分用。
⑤ 连接建立和释放：交换数据前先建立一条逻辑连接，数据传送结束后释放连接。

计算机网络的体系结构 (architecture) 是计算机网络的各层及其协议的集合。 


五层协议的体系结构:
应用层 (application layer)
运输层 (transport layer)
网络层 (network layer)
数据链路层 (data link layer)
物理层 (physical layer) 
OSI 参考模型把对等层次之间传送的数据单位称为该层的协议数据单元 PDU (Protocol Data Unit)。
各层协议实际上就是在各个对等层之间传递数据时的各项规定。
实体 (entity) ：表示任何可发送或接收信息的硬件或软件进程。
协议：是控制两个对等实体进行通信的规则的集合。
服务访问点 SAP (Service Access Point)：同一系统相邻两层的实体进行交互的地方
在协议的控制下，两个对等实体间的通信使得本层能够向上一层提供服务
要实现本层协议，还需要使用下层所提供的服务
协议和服务在概念上是不一样的：
协议的实现保证了能够向上一层提供服务。
本层的服务用户只能看见服务而无法看见下面的协议。即下面的协议对上面的服务用户是透明的。
协议是“水平的”，即协议是控制对等实体之间通信的规则。
服务是“垂直的”，即服务是由下层向上层通过层间接口提供的。
上层使用服务原语获得下层所提供的服务。
OSI把层与层之间交换的数据的单位称为服务数据单元 SDU (Service Data Unit)
协议必须把所有不利的条件事先都估计到，而不能假定一切都是正常的和非常理想的。
看一个计算机网络协议是否正确，不能光看在正常情况下是否正确，还必须非常仔细地检查这个协议能否应付各种异常情况。 



物理层的主要任务：主要任务：确定与传输媒体的接口的一些特性。
机械特性 ：指明接口所用接线器的形状和尺寸、引线数目和排列、固定和锁定装置等。
电气特性：指明在接口电缆的各条线上出现的电压的范围。
功能特性：指明某条线上出现的某一电平的电压表示何种意义。
过程特性 ：指明对于不同功能的各种可能事件的出现顺序。 
一个数据通信系统包括三大部分：源系统（或发送端、发送方）、传输系统（或传输网络）和目的系统（或接收端、接收方）。
模拟信号：连续的
数字信号：离散的
单工：只能有一个方向的通信，而没有反方向的交互
半双工：通信的双发都可以发送信息，但是不能同时发送
全双工：通信双方可以同时发送和接受信息
基带信号（即基本频带信号）—— 来自信源的信号。像计算机输出的代表各种文字或图像文件的数据信号都属于基带信号。
基带信号往往包含有较多的低频成分，甚至有直流成分，而许多信道并不能传输这种低频分量或直流分量。因此必须对基带信号进行调制 (modulation)。   
调制分类：
基带调制：仅对基带信号的波形进行变换，使它能够与信道特性相适应。变换后的信号仍然是基带信号。把这种过程称为编码 (coding)。
带通调制：使用载波 (carrier)进行调制，把基带信号的频率范围搬移到较高的频段，并转换为模拟信号，这样就能够更好地在模拟信道中传输（即仅在一段频率范围内能够通过信道） 。
带通信号 ：经过载波调制后的信号。
常用编码（基带调制）方式：
不归零制：正电平代表 1，负电平代表 0。
归零制：正脉冲代表 1，负脉冲代表 0。
曼彻斯特编码：位周期中心的向上跳变代表 0，位周期中心的向下跳变代表 1。但也可反过来定义。
差分曼彻斯特编码：在每一位的中心处始终都有跳变。位开始边界有跳变代表 0，而位开始边界没有跳变代表 1。
最基本的二元制调制方法有以下几种：
调幅(AM)：载波的振幅随基带数字信号而变化。
调频(FM)：载波的频率随基带数字信号而变化。
调相(PM)：载波的初始相位随基带数字信号而变化。
数字信号通过实际的信道
有失真，可识别。
失真大，无法识别
限制码元在信道上的传输速率的因素：信道能够通过的频率范围 信噪比
信道能够通过的频率范围：奈氏准则 为了避免码间串扰，码元的传输速率的上限值
奈氏准则前提条件：信道无噪声
    对无噪声的通信信道，H是信道的带宽，则信道可达到的最大信号速率（signaling rate)是2H。
信噪比就是信号的平均功率和噪声的平均功率之比。常记为 S&#x2F;N，并用分贝 (dB) 作为度量单位。即：
        信噪比(dB) &#x3D; 10 log10(S&#x2F;N)    (dB)
        例如，当 S&#x2F;N &#x3D; 10 时，信噪比为 10 dB，而当 S&#x2F;N &#x3D; 1000时，信噪比为 30 dB。  
香农公式：带宽受限且有高斯白噪声干扰的信道的极限、无差错的信息传输速率C
            C &#x3D; W log2(1+S&#x2F;N)    (bit&#x2F;s)
            其中：    W 为信道的带宽（以 Hz 为单位）；
                    S 为信道内所传信号的平均功率；
                    N 为信道内部的高斯噪声功率。  
物理层下面的传输媒体（传输介质或传输媒介）：引导型传输媒体 非引导性传输媒体
在导引型传输媒体中，电磁波被导引沿着固体媒体（铜线或光纤）传播。
非导引型传输媒体就是指自由空间。在非导引型传输媒体中，电磁波的传输常称为无线传输
引导性传输媒体：
    双绞线（通信距离一般为几到十几公里）
        是由一对相互绝缘的金属导线绞合而成
        屏蔽双绞线 STP (Shielded Twisted Pair)
            带金属屏蔽层
        无屏蔽双绞线 UTP (Unshielded Twisted Pair)
    同轴电缆
        50欧 同轴电缆 —— LAN &#x2F; 数字传输常用
        75欧 同轴电缆 —— 有线电视 &#x2F; 模拟传输常用
光缆
    多模光纤
    单模光纤
    &lt;imag src&#x3D;&quot;picture&#x2F;屏幕快照 2021-06-15 下午11.16.58.png&quot;&gt;
    光纤优点：
        (1) 通信容量非常大。
        (2) 传输损耗小，中继距离长。
        (2) 抗雷电和电磁干扰性能好。
        (3) 无串音干扰，保密性好。
        (4) 体积小，重量轻。

非导引型传输媒体：
    短波通信：（即高频通信）主要是靠电离层的反射，但短波信道的通信质量较差，传输速率低。
    微波在空间主要是直线传播。
对传送数据来说，现在最常用的 UTP 是5类线（Category 5 或 CAT5）


信道复用技术：
    复用 (multiplexing) 是通信技术中的基本概念。
    它允许用户使用一个共享信道进行通信，降低成本，提高利用率。
    频分复用 FDM：
        所有用户在同样的时间占用不同的带宽资源
    时分复用 TDM：
        将时间划分为一段段等长的时分复用帧（TDM 帧）。每一个时分复用的用户在每一个 TDM 帧中占用固定序号的时隙。
        每一个用户所占用的时隙是周期性地出现（其周期就是 TDM  帧的长度）。
        TDM 信号也称为等时(isochronous)信号。
        时分复用的所有用户是在不同的时间占用同样的频带宽度。
        时分复用可能会造成线路资源的浪费
        统计时分复用 STDM：
            STDM 帧不是固定分配时隙，而是按需动态地分配时隙。因此统计时分复用可以提高线路的利用率。
    波分复用 WDM：
    码分复用 CDM：
        常用的名词是码分多址 CDMA：
            每个站分配的码片序列不仅必须各不相同，并且还必须互相正交 (orthogonal)
            在实用的系统中是使用伪随机码序列
        码片：每一个比特时间划分为 m 个短的间隔
        每个站被指派一个唯一的 m bit 码片序列
        两个不同站的码片序列正交，就是向量 S 和T 的规格化内积 (inner product) 等于 0
        假定所分配的代码具有两个特点：
        每个代码与其他代码相乘，得到0；
        每个代码自己相乘，得到4（站的数量）。
        每个站用数据d乘以代码，得到d1c1, d2c2,…,信道中的数据是所有这些项的和。
数字传输系统：
    与模拟通信相比，数字通信无论是在传输质量上还是经济上都有明显的优势。
    脉码调制 PCM 体制最初是为了在电话局之间的中继线上传送多路的电话。
        北美的 24 路 PCM（简称为 T1）
        欧洲的 30 路 PCM（简称为 E1）
            我国采用的是欧洲的 E1 标准。
    旧的数字传输系统主要缺点：
        速率标准不统一
        不是同步传输
    同步光纤网 SONET (Synchronous Optical Network)：
        对电信信号称为第 1 级同步传送信号 STS-1 (Synchronous Transport Signal)，其传输速率是 51.84 Mbit&#x2F;s。
        对光信号则称为第 1 级光载波 OC-1 (OC 表示Optical Carrier)。
    同步数字系列 SDH (Synchronous Digital Hierarchy)：
        ITU-T 以美国标准 SONET 为基础，制订出国际标准
    一般可认为 SDH 与 SONET 是同义词
    SDH SONET的不同点是：SDH 的基本速率为 155.52 Mbit&#x2F;s，称为第 1 级同步传递模块 (Synchronous Transfer Module)，即 STM-1，相当于 SONET 体系中的 OC-3 速率
    SONET &#x2F; SDH 标准的意义：
        第一次真正实现了数字传输体制上的世界性标准。
        已成为公认的新一代理想的传输网体制。
宽带接入技术：
    初期：利用电话线，最高只能达到 56 kbit&#x2F;s
    宽带：只要双向速率之和超过 200 kbit&#x2F;s
    有线宽带接入：
        非对称数字用户线 ADSL(Asymmetric Digital Subscriber Line) ：
            把 0~4 kHz 低端频谱留给传统电话使用，而把原来没有被利用的高端频谱留给用户上网使用。
            DSL 就是数字用户线 (Digital Subscriber Line) 的缩写。
            传输距离取决于数据率和用户线的线径（用户线越细，信号传输时的衰减就越大）
            特点：
                上行和下行带宽做成不对称的。
                    上行指从用户到 ISP，而下行指从 ISP 到用户
                在用户线（铜线）的两端各安装一个 ADSL 调制解调器
                我国目前采用的方案是离散多音调 DMT (Discrete Multi-Tone)调制技术：
                    “多音调”就是“多载波”或“多子信道”的意思。
                    采用频分复用方法
                    相当于在一对用户线上使用许多小的调制解调器并行地传送数据
            ADSL 的数据率：
                ADSL 采用自适应调制技术使用户线能够传送尽可能高的数据率
                不能保证固定的数据率
            第二代 ADSL：
                更高的数据率
                无缝速率自适应技术 SRA (Seamless Rate Adaptation)
        光纤同轴混合网（HFC网）：
            CATV 网采用模拟技术的频分复用
            HFC 网对 CATV 网进行了改造：
                将原 CATV 网中的同轴电缆主干部分改换为光纤，并使用模拟光纤技术
                在模拟光纤中采用光的振幅调制 AM，这比使用数字光纤更为经济
                模拟光纤从头端连接到光纤结点 (fiber node)，即光分配结点 ODN (Optical Distribution Node)在光纤结点光信号被转换为电信号。在光纤结点以下就是同轴电缆。
    用户接口盒 UIB (User Interface Box) 要提供三种连接：
        使用同轴电缆连接到机顶盒 (set-top box)，然后再连接到用户的电视机。
        使用双绞线连接到用户的电话机。
        使用电缆调制解调器连接到用户的计算机。
    电缆调制解调器 (Cable Modem)：
        是为 HFC 网而使用的调制解调器


数据链路层使用的信道主要有以下两种类型：
    点对点信道:
        这种信道使用一对一的点对点通信方式
    广播信道:
        这种信道使用一对多的广播通信方式，因此过程比较复杂
    链路 (link)（物理链路） :
        是一条无源的点到点的物理线路段，中间没有任何其他的交换结点
    数据链路 (data link)（逻辑链路）:
        把实现协议的硬件和软件加到链路上
    通信规程：早期的数据通信协议
    三个基本问题：
        1. 封装成帧：在一段数据的前后分别添加首部和尾部，进行帧定界（可以使用帧定界符）
        2. 透明传输：字节填充 (byte stuffing) 或字符填充 (character stuffing)，插入一个转义字符“ESC”
        3. 差错控制 ：比特差错：1 可能会变成 0 而 0 也可能变成 1。
            误码率：在一段时间内，传输错误的比特占所传输比特总数的比率
    循环冗余检验 CRC 的检错技术：
        在数据链路层传送的帧中，广泛使用
        冗余码 帧检验序列 FCS (Frame Check Sequence)：
 
        (1) 若得出的余数 R &#x3D; 0，则判定这个帧没有差错，就接受 (accept)。
        (2) 若余数 R  0，则判定这个帧有差错，就丢弃。
        只能做到无差错接受 (accept)
        (要做到“可靠传输”（即发送什么就收到什么）就必须再加上确认和重传机制。)
        “无比特差错”与“无传输差错”是不同的概念。
    点对点协议 PPP (Point-to-Point Protocol):
        首要的要求:简单
        PPP 是面向字节的，所有的 PPP 帧的长度都是整数字节。
        同步传输链路时，协议规定采用硬件来完成比特填充（和 HDLC 的做法一样）：
            在使用SONET&#x2F;SDH链路时，使用同步传输， PPP 协议采用零比特填充方法来实现透明传输
        用在异步传输时，就使用一种特殊的字符填充法
    广播信道：
        静态划分信道：
            频分复用
            时分复用
            波分复用
            码分复用
        动态媒体接入控制（多点接入）
        DIX Ethernet V2 是世界上第一个局域网产品（以太网）的规约
        IEEE 802.3 是第一个 IEEE 的以太网标准。
        通信适配器 (adapter) &#x2F; 网络接口卡 NIC (Network Interface Card) &#x2F; 网卡：网络接口板：
            重要功能：
                进行串行&#x2F;并行转换。
                对数据进行缓存。
                在计算机的操作系统安装设备驱动程序。
                实现以太网协议。
        CSMA&#x2F;CD协议：
            含义：载波监听 多点接入 &#x2F; 碰撞检测
                “多点接入”    多点共线
                “载波监听”    先听后讲
                “碰撞检测”    边讲边听
            重要特性：
                只能半双工通信
                碰撞
            争用期 &#x2F; 碰撞窗口：
                定义： 时间 2t（两倍的端到端往返时延）就可知道发送的数据帧是否遭受了碰撞
                长度：10 Mbit&#x2F;s 以太网取 51.2 us 为争用期的长度
                发生碰撞的站在停止发送数据后，要推迟（退避）一个随机时间才能再发送数据
                从整数集合 [0, 1, … , (2k 1)] 中随机地取出一个数，记为 r。重传所需的时延就是 r 倍的基本退避时间
                    k &#x3D; Min[重传次数, 10]
                传达 16 次仍不能成功时即丢弃该帧，并向高层报告
                强化碰撞：
                    (1) 立即停止发送数据；
                    (2) 再继续发送32&#x2F;48比特的人为干扰信号,以便让所有节点都知道现在已经发生了碰撞。
            要点：1）准备发送
                 2）检测信道
                 3）检查碰撞 ：
                    两种可能性：发送成功 发送失败
            以太网采取了两种重要的措施：
                采用较为灵活的无连接的工作方式
                以太网发送的数据都使用曼彻斯特
        3.3.3集线器：
            1990 年，IEEE 制定出星形以太网 10BASE-T 的标准 802.3i
            每个站到集线器的距离不超过 100 m
            特点：
                集线器以太网逻辑上仍是总线网，仍使用 CSMA&#x2F;CD 协议
                集线器工作在物理层，仅简单转发。
        3.3.4以太网的信道利用率：
                成功发送一个帧需要占用信道的时间是 T0 + T
                对以太网参数 α 的要求是：
                    当数据率一定时，以太网的连线的长度受到限制，否则 T 的数值会太大。
                    以太网的帧长不能太短，否则 T0 的值会太小，使 α 值太大。
                信道利用率的最大值 Smax ：
                    理想化的情况下
        3.3.5以太网的 MAC 层：
            硬件地址 &#x2F; 物理地址 &#x2F; MAC地址
                每个网卡有一个MAC地址
            必须保证生产出的适配器没有重复地址
            I&#x2F;G（ Individual &#x2F; Group）第一字节的最低位：
                当 I&#x2F;G位 &#x3D; 0 时，地址字段表示一个单站地址
                当 I&#x2F;G位 &#x3D; 1 时，表示组地址，用来进行多播
            G&#x2F;L（Global &#x2F; Local）
                当 G&#x2F;L位 &#x3D; 0 时，是全球管理
                当 G&#x2F;L位 &#x3D; 1 时，是本地管理
            适配器检查 MAC 地址：
                如果是发往本站的帧则收下，然后再进行其他的处理。
                否则就将此帧丢弃，不再进行其他的处理。
                发往本站的帧：
                    单播 (unicast) 帧（一对一）
                    广播 (broadcast) 帧（一对全体）
                    多播 (multicast) 帧（一对多）
                所有的适配器都至少能够识别单播地址和广播地址。
                只有目的地址才能使用广播地址和多播地址
                以混杂方式 (promiscuous mode) 工作的以太网适配器只要“听到”有帧在以太网上传输就都接收下来。
            以太网 V2 MAC 帧的格式：
                标准：DIX Ethernet V2 标准和IEEE 的 802.3 标准
                    最常用的 MAC 帧是以太网 V2 的格式
                数据字段的正式名称是 MAC 客户数据字段
                当数据字段的长度小于 46 字节时,应在数据字段的后面加入整数字节的填充字段，以保证以太网的 MAC 帧长不小于 64 字节。
                无效的 MAC 帧:
                    数据字段的长度与长度字段的值不一致
            IEEE 802.3 MAC 帧格式:
                与V2的区别：第三个字段是“长度 &#x2F; 类型”
            帧间最小间隔：
                9.6us,为了使站的接收缓存来得及清理
    3.4 拓展的以太网：
        3.4.1 在物理层的扩展：
            使用光纤扩展
            使用集线器扩展：
                优点：使原来属于不同碰撞域的以太网上的计算机能够进行跨碰撞域的通信。
                      扩大了以太网覆盖的地理范围。
                缺点：碰撞域增大了，但总的吞吐量并未提高。
                      如果不同的碰撞域使用不同的数据率，那么就不能用集线器将它们互连起来。
        3.4.2 在数据链路层扩展：
            早期使用网桥，现在使用以太网交换机：
                网桥工作：根据 MAC 帧的目的地址对收到的帧进行转发和过滤
            交换式集线器淘汰了网桥：
                常称为以太网交换机 或二层交换机
            以太网交换机：
                特点：
                    以太网交换机是多接口的网桥
                    工作在全双工方式
                    具有并行性：
                        能同时连通多对接口，使多对主机能同时通信
                    相互通信的主机都是独占传输媒体，无碰撞地传输数据
                    接口有存储器
                    即插即用，地址表自学习
                交换方式：
                    存储转发方式
                        把整个数据帧先缓存后再进行处理
                    直通 (cut-through) 方式
                        接收同时就立即按数据帧的目的 MAC 地址
                        缺点：有可能也将一些无效帧转发给其他的站
                自学习功能：
                    交换表一开始是空的
                    先查找交换表，没有查到应从哪个接口转发这个帧
                    把这个帧的源地址 A 和接口 1 写入交换表中，并向除接口1以外的所有的接口广播这个帧
                    过滤：C 和 D 将丢弃这个帧，因为目的地址不对。只 B 才收下这个目的地址正确的帧
                    在交换表中每个项目都设有一定的有效时间。过期的项目就自动被删除
                    交换机自学习和转发帧的步骤归纳：
                        先进行自学习，查找表中有无相匹配的源地址的项目：
                            如没有，就在交换表中增加一个项目（源地址、进入的接口和有效时间）。
                            如有，则把原有的项目进行更新（进入的接口或有效时间）
                        转发帧，查找表中有无相匹配的源地址的项目：
                            如没有，则向所有其他接口（进入的接口除外）转发。
                            如有，则按交换表中给出的接口进行转发。
                            若交换表中给出的接口就是该帧进入交换机的接口，则应丢弃这个帧（因为这时不需要经过交换机进行转发）
                    增加冗余链路时，自学习的过程就可能导致以太网帧在网络的某个环路中无限制地兜圈子
                    交换以太网不使用共享总线
                    没有碰撞问题，不使用 CSMA&#x2F;CD 协议，以全双工方式工作。但仍采用以太网的帧结构。
        3.4.3 虚拟局域网
            虚拟局域网 VLAN 是一种逻辑划分
            同VLAN小组成员收到广播信息，其他VLAN接受不到
            有利于防止：广播风暴
            VLAN 标记 (tag)：帧格式中插入一个4字节的标识符，用来指明发送该帧的计算机（接口）属于哪一个虚拟局域网
            插入 VLAN 标记得出的帧称：802.1Q 帧 或 带标记的以太网帧。
        3.5.1 100BASE-T 以太网 &#x2F; 快速以太网(Fast Ethernet)
            代号：IEEE 802.3u
            高速以太网：速率达到或超过 100 Mbit&#x2F;s 的以太网
            特点：在全双工方式下工作时，不使用 CSMA&#x2F;CD 协议
                 MAC 帧格式仍然是 802.3 标准规定的
                 保持最短帧长不变，但将一个网段的最大电缆长度减小到 100 m
                 帧间时间间隔从原来的 9.6 s 改为现在的 0.96 us
        3.5.2 吉比特以太网
            在半双工方式下使用 CSMA&#x2F;CD 协议，全双工方式不使用 CSMA&#x2F;CD 协议
            使用两种成熟的技术：一种来自现有的以太网，另一种则是美国国家标准协会 ANSI 制定的光纤通道 FC  (Fiber Channel)
            半双工方式工作的吉比特以太网
                为保持 64 字节最小帧长度，以及 100 米的网段的最大长度，吉比特以太网增加了两个功能：
                    载波延伸 (carrier extension)
                        将争用时间增大为 512 字节
                    分组突发 (packet bursting)
            全双工方式工作的吉比特以太网
                不使用载波延伸和分组突发
            10 吉比特以太网和更快的以太网
                只工作在全双工方式
            端到端的以太网传输
                实现了端到端的以太网传输的好处：
                    技术成熟；
                    互操作性很好；
                    在广域网中使用以太网时价格便宜；
                    采用统一的以太网帧格式，简化了操作和管理
        3.5.3 以太网从 10 Mbit&#x2F;s 到100 Gbit&#x2F;s 的演进证明：
            可扩展的（从 10 Mbit&#x2F;s 到 100 Gbit&#x2F;s）；
            灵活的（多种传输媒体、全&#x2F;半双工、共享&#x2F;交换）；
            易于安装；
            稳健性好。
        3.5.4 使用以太网进行宽带接入
            特点：
                可以提供双向的宽带通信。
                可以根据用户对带宽的需求灵活地进行带宽升级。
                可以实现端到端的以太网传输，中间不需要再进行帧格式的转换。这就提高了数据的传输效率且降低了传输的成本。
                但是不支持用户身份鉴别。
            PPPoE (PPP over Ethernet)
                在以太网上运行 PPP，把 PPP 协议与以太网协议结合起来 —— 将 PPP 帧再封装到以太网中来传输

    4.1  网络层提供的两种服务 
        面向连接 无连接 
        争论的实质是：可靠交付是网络负责，还是端系统负责。
        结论： “无连接”赢了
        让网络负责可靠交付：
            使用面向连接的通信方式
            先建立虚电路 (Virtual Circuit)
                虚电路是逻辑连接
                分组按照存储转发方式传送
                电路交换的电话通信是先建立了一条真正的连接
        网络提供数据报服务：
            网络层向上只提供简单灵活的、无连接的、尽最大努力交付的数据报服务
            网络层不提供服务质量的承诺
            尽最大努力交付：
                传输网络不提供端到端的可靠传输服务
                主机中的运输层负责可靠交付（包括差错处理、流量控制等）
    4.2 网际协议 IP
        地址解析协议 ARP(Address Resolution Protocol)
        网际控制报文协议 ICMP(Internet Control Message Protocol)
        网际组管理协议 IGMP(Internet Group Management Protocol)
        4.2.1 虚拟网络互联
            中间设备 &#x2F; 中间系统 &#x2F; 中继系统
                物理层中继系统：集线器 (repeater)。
                数据链路层中继系统：网桥 或 交换机。
                网络层中继系统：路由器 (router)。
                网桥和路由器的混合物：桥路器 (brouter)，二三层。
                网络层以上的中继系统：网关 (gateway)。  
            网络互联：
                中继系统是转发器或者网桥时，不称为网络互联，仍然是一个网络
                网络互连都是指用路由器进行网络互连和路由选择
                路由器称为网关
            虚拟网络互联
                虚拟互连网络也就是逻辑互连网络，
                利用 IP 协议就可以使这些性能各异的网络从用户看起来好像是一个统一的网络
                IP网：使用 IP 协议的虚拟互连网络
                好处：当互联网上的主机进行通信时，就好像在一个网络上通信一样，而看不见互连的各具体的网络异构细节。
                如果在这种覆盖全球的 IP 网的上层使用 TCP 协议，那么就是现在的互联网 (Internet)。
        4.2.2 分类的IP地址
            唯一的 32 位的标识符
            IP 地址现在由互联网名字和数字分配机构ICANN 进行分配
            IP地址的编址方法：
                1.分类的IP地址
                    公网 IP 地址在整个互联网范围内是唯一的。
                    私网 IP 地址在整个私网范围内是唯一的。
                    2进制开头 地址的网络号字段 主机号字段 每个网络最大主机数
                        A 0 8 24 2^24-2
                        B 10 16 16 2^16-2
                        C 110 24 8 2^8-2
                        D 1110 多播地址
                        E 1111 保留为今后使用
                    特殊的 IP 地址 全0 &#x2F; 1
                    重要特点：
                        (1) IP 地址是一种分等级的地址结构
                        (2) 实际上 IP 地址是标志一个主机（或路由器）和一条链路的接口
                            多归属主机:具有两个IP地址，和不通的网络号
                        (3) 用转发器或网桥连接起来的若干个局域网仍为一个网络，因此这些局域网都（？一般）具有同样的网络号 net-id。网络号不同必须使用路由器连接
                        (4) 所有分配到网络号 net-id 的网络，都是平等的


            2.子网的划分
            3.构成超网
    4.2.3 IP 地址与硬件地址
        硬件地址（或物理地址）是数据链路层和物理层使用的地址
        IP 地址是网络层和以上各层使用的地址，是一种逻辑地址
            称 IP 地址是逻辑地址是因为 IP 地址是用软件实现的
        两个路由器的 IP 地址并不出现在 IP 数据报的首部中
    4.2.4 地址解析协议 ARP
        通信时使用了两个地址：IP 地址（网络层地址） MAC 地址（数据链路层地址）
        作用：已知IP地址，求硬件地址
        实际网络传送数据必须使用硬件地址
        每一个主机都设有一个ARP高速缓存，有IP地址到硬件地址的映射表
        当主机 A 欲向本局域网上的某个主机 B 发送 IP 数据报时：
            如有，就可查出其对应的硬件地址，再将此硬件地址写入 MAC 帧，并发送
            如没有， 本局域网广播一个 ARP 请求分组。收到 ARP 响应分组后，将得到的 IP 地址到硬件地址的映射写入 ARP 高速缓存。组MAC帧发送
        要点：
            ARP请求分组：包含发送方硬件地址 &#x2F; 发送方 IP 地址 &#x2F; 0 &#x2F; 目标方 IP 地址。
            本地广播 ARP 请求（路由器不转发ARP请求）。
            ARP 响应分组：发送方硬件地址 &#x2F; 发送方 IP地址 &#x2F; 目标方硬件地址 &#x2F; 目标方 IP 地址。
            ARP 分组封装在物理网络的帧中传输。
            抓包
        ARP 高速缓存的作用
            存放最近获得的 IP 地址到 MAC 地址的绑定，以减少 ARP 广播的数量。
            减少网络上的通信量
            主机 B (所有主机)收到 A 的 ARP 请求分组时，就将主机 A 的这一地址映射写入主机 B 自己的 ARP 高速缓存中。这对主机 B 以后向 A 发送数据报时就更方便了
    4.2.5 IP 数据报的格式
        由首部和数据两部分组成
            首部的前一部分是固定长度，共 20 字节
        IP首部长度占4位，可表示的最大数值是 15 个单位(一个单位为 4 字节)IP 的首部长度的最大值是 60 字节
        区分服务：占8位，实际上一直未被使用，一般情况下都不使用这个字段
        总长度：占16位，数据报最大长度为2^16-1字节
        原始数据报首部被复制为各数据报片的首部，但必须修改有关字段的值
        IP 数据报首部的可变部分
            从 1 个字节到 40 个字节不等
    4.2.6 IP 层转发分组的流程
        路由器分组转发算法 
            (1) 从数据报的首部提取目的主机的 IP 地址 D, 得出目的网络地址为 N。
            (2) 若网络 N 与此路由器直接相连，则把数据报直接交付目的主机 D；否则是间接交付，执行 (3)。
            (3) 若路由表中有目的地址为 D 的特定主机路由，则把数据报传送给路由表中所指明的下一跳路由器；否则，执行 (4)。
            (4) 若路由表中有到达网络 N 的路由，则把数据报传送给路由表指明的下一跳路由器；否则，执行 (5)。
            (5) 若路由表中有一个默认路由，则把数据报传送给路由表中所指明的默认路由器；否则，执行 (6)。
            (6)  报告转发分组出错。 
4.3 划分子网和构造超网
    4.3.1   划分子网
        基本思路
            划分子网纯属一个单位内部的事情
            从主机号借用若干个位作为子网号 subnet-id
        子网的掩码
            从一个 IP 数据报的首部并无法判断是否进行了子网划分
            使用子网掩码 (subnet mask) 可以找出 IP 地址中的子网部分
            规则
                子网掩码长度 ＝ 32 位
                某位 ＝ 1：IP地址中的对应位为网络号和子网号
                某位 ＝ 0：IP地址中的对应位为主机号  
        子网划分方法
            文档规定不能为全 1 或全 0，现在全 1 和全 0 的子网号也可以使用了
            划分子网增加了灵活性，但却减少了能够连接在网络上的主机总数。


                子网数：192&#x3D;128+64(n&#x3D;2)
                       2^n-2:子网数
                子网主机数：2^(16-n)-2
        4.3.2  在划分子网情况下路由器转发分组的算法 
            (1) 从收到的分组的首部提取目的 IP 地址 D。
            (2) 先用各网络的子网掩码和 D 逐位相“与”，看是否和相应的网
                络地址匹配。若匹配，则将分组直接交付。否则就是间接交付，
                执行 (3)。
            (3) 若路由表中有目的地址为 D 的特定主机路由，则将分组传送给
                指明的下一跳路由器；否则，执行 (4)。
            (4) 对路由表中的每一行，将子网掩码和 D 逐位相“与”。若结果与该行的目的网络地址匹配，则将分组传送给该行指明的下一跳路由器；否则，执行 (5)。
            (5) 若路由表中有一个默认路由，则将分组传送给路由表中所指明
                的默认路由器；否则，执行 (6)。
            (6) 报告转发分组出错。
            【例4-4】已知互联网和路由器 R1 中的路由表。主机 H1 向 H2 发送分组。试讨论 R1 收到 H1 向 H2 发送的分组后查找路由表的过程。
            ppt 475
        4.3.3  无分类编址 CIDR
            变长子网掩码 VLSM (Variable Length Subnet Mask) &#x2F; 无分类域间路由选择 CIDR (Classless Inter-Domain Routing)
            特点：
                消除了传统的 A 类、B 类和 C 类地址以及划分子网的概念
                使用各种长度的“网络前缀”(network-prefix)
                斜线记法”(slash notation) &#x2F; CIDR 记法
            CIDR地址块：
                128.14.32.0&#x2F;20 表示的地址块共有 2^12（4*8-20） 个地址（因为斜线后面的 20 是网络前缀的位数，所以这个地址的主机号是 12 位）。
                    这个地址块的起始地址是 128.14.32.0。
                    在不需要指出地址块的起始地址时，也可将这样的地址块简称为“&#x2F;20 地址块”。
                    128.14.32.0&#x2F;20 地址块的最小地址：128.14.32.0
                    128.14.32.0&#x2F;20 地址块的最大地址：128.14.47.255
                    全 0 和全 1 的主机号地址一般不使用。
                路由聚合：
                    一个 CIDR 地址块可以表示很多地址
                    有利于减少路由器之间的路由选择信息的交换，从而提高了整个互联网的性能有利于减少路由器之间的路由选择信息的交换，从而提高了整个互联网的性能
                    路由聚合也称为构成超网 (supernetting)
                    仍然使用“掩码”
                    对于 &#x2F;20  地址块，它的掩码是 20 个连续的 1。 斜线记法中的数字就是掩码中1的个数
                    10.0.0.0&#x2F;10 可简写为 10&#x2F;10
                    10.0.0.0 的掩码是 255.192.0.0
                    星号 * ：
                        在星号 * 之前是网络前缀，而星号 * 表示 IP 地址中的主机号，可以是任意值
                    最长前缀匹配 (longest-prefix matching) &#x2F;最长匹配或最佳匹配
                        选择两个匹配的地址中更具体的一个，即选择最长前缀的地址
    4.4  网际控制报文协议 ICMP
            有效地转发 IP 数据报和提高交付成功
            ICMP 询问报文有两种 
                回送请求和回答报文
                时间戳请求和回答报文
            4.4.2  ICMP 的应用举例
                PING 用来测试两个主机之间的连通性,使用了 ICMP 回送请求与回送回答报文
                Tracerout 用来跟踪一个分组从源点到终点的路径
    4.5  互联网的路由选择协议
        4.5.1  有关路由选择协议的几个基本概念
                内部网关协议 IGP (Interior Gateway Protocol)
                    自治系统内部使用
                外部网关协议 EGP (External Gateway Protocol)    
                    不同的自治系统之间传路由选择信息
        4.5.2  内部网关协议 RIP
            分布式的、基于距离向量的路由选择协议
            要求网络中的每一个路由器都要维护从它自己到其他每一个目的网络的距离记录
            距离 &#x2F; 跳数 &#x2F; 最短距离：
                从一个路由器到直接连接的网络的距离定义为 1
                每经过一个路由器，跳数就加 1
                一个好的路由，距离短
                一条路径最多只能包含 15 个路由器，“距离”的最大值为 16 时即相当于不可达
                RIP 不能在两个网络之间同时使用多条路由
            三个特点：
                仅和相邻路由器交换信息
                交换的信息是当前本路由器所知道的全部信息，即自己的路由表
                按固定的时间间隔交换路由信息
            路由表的建立
                刚刚开始工作，路由表是空的
                收敛 (convergence) 过程较快    
                距离向量算法
                    路由器收到相邻路由器（其地址为 X）的一个 RIP 报文：
                    (1) 先修改此 RIP 报文中的所有项目：把“下一跳”字段中的地址都改为 X，并把所有的“距离”字段的值加 1。
                    (2) 对修改后的 RIP 报文中的每一个项目，重复以下步骤：
                        若项目中的目的网络不在路由表中，则把该项目加到路由表中。
                        否则若下一跳字段给出的路由器地址是同样的，则把收到的项目替换原路由表中的项目。
                        否则若收到项目中的距离小于路由表中的距离，则进行更新，否则，什么也不做。
                    (3) 若 3 分钟还没有收到相邻路由器的更新路由表，则把此相邻路由器记为不可达路由器，即将距离置为 16（表示不可达）。
                    (4) 返回。
                    
            协议特点：好消息传播得快，坏消息传播得慢。
            RIP 存在的一个问题：当网络出现故障时，要经过比较长的时间 (例如数分钟) 才能将此信息传送到所有的路由器。
            优点：实现简单，开销较小。
            缺点：RIP 限制了网络的规模，它能使用的最大距离为 15（16 表示不可达）。
            路由器之间交换的是完整路由表，因而网络规模越大，开销就越大。 
            “坏消息传播得慢”，使更新过程的收敛时间过长。
        4.5.3  内部网关协议 OSPF 开放最短路径优先 OSPF (Open Shortest Path First)
            “开放”表明 OSPF 不受某一厂商控制，而是公开的
            “最短路径优先”是因为使用了 Dijkstra 提出的最短路径算法 SPF
            要点：只有链路状态发生变化，才用IP 数据报和洪泛法发送链路状态（度量） 
            三个要点
                向本自治系统中所有路由器发送信息，洪泛法
                发送的信息就是与本路由器相邻的所有路由器的链路状态，但这只是路由器所知道的部分信息。
                只有当链路状态变化时，路由器才用洪泛法向所有路由器发送此信息
            链路状态数据库 (link-state database) 
                由所有的路由器最终建立
                全网的拓扑结构图，它在全网范围内是一致的
                OSPF 的链路状态数据库能较快地进行更新
            其他特点：
                OSPF 对于不同类型的业务可计算出不同的路由
                多路径间的负载平衡：到同一个目的网络有多条相同代价的路径，那么可以将通信量分配给这几条路径
                所有在 OSPF 路由器之间交换的分组都具有鉴别的功能
                支持可变长度的子网划分和无分类编址 CIDR
        4.5.4  外部网关协议 BGP
            不同自治系统的路由器之间交换路由信息的协议
            只是力求寻找一条能够到达目的网络且比较好的路由（不能兜圈子），而并非要寻找一条最佳路由
            先建立 TCP 连接
            特点：
                自治系统数的量级
                BGP 支持 CIDR
                更新有变化的部分。这样做对节省网络带宽和减少路由器的处理开销都有好处。 
        4.5.5  路由器的构成
            “转发”和“路由选择”的区别 
                转发：路由器根据转发表将用户的 IP 数据报从合适的端口转发出去
                路由选择：按照分布式算法，根据从各相邻路由器得到的关于网络拓扑的变化情况，动态地改变所选择的路由
            分组丢弃：
                路由器中的输入或输出队列产生溢出是造成分组丢失的重要原因
    4.6  IPv6
        4.6.1  IPv6 的基本首部
            主要变化：
                更大的地址空间。从 IPv4 的 32 位 增大到128 位。 
                扩展的地址层次结构。 
                灵活的首部格式。 定义了许多可选的扩展首部。
                改进的选项。 允许数据报包含有选项的控制信息
                允许协议继续扩充。 
                支持即插即用（即自动配置）。不需要 DHCP。
                支持资源的预分配。  支持特定带宽和时延的应用。
                IPv6 首部 8 字节对齐。 IPv4 首部是 4 字节对齐。          
            数据报：
                由基本首部（40个字节）有效载荷（不超过65535）两大部分组成
                对首部的更改：
                    取消了首部长度字段，因为首部长度是固定的 40 字节；
                    取消了服务类型字段；
                    取消了总长度字段，改用有效载荷长度字段；
                    把 TTL 字段改称为跳数限制字段；
                    取消了协议字段，改用下一个首部字段；
                    取消了检验和字段；
                    取消了选项字段，而用扩展首部来实现选项功能。
            拓展首部
                IPv6 把原来 IPv4 首部中选项的功能都放在扩展首部中，大大提高了路由器的处理效率
                六种扩展首部：  
                    (1) 逐跳选项
                    (2) 路由选择
                    (3) 分片
                    (4) 鉴别
                    (5) 封装安全有效载荷
                    (6) 目的站选项 
        4.6.2  IPv6 的地址
            (1) 单播 (unicast)：传统的点对点通信。
            (2) 多播 (multicast)：一点对多点的通信。
            (3) 任播 (anycast)：这是 IPv6 增加的一种类型。任播的目的站是一组计算机，但数据报在交付时只交付其中的一个，通常是距离最近的一个。 
            冒号十六进制记法
                零压缩
                    即一连串连续的零可以为一对冒号所取代
                    注意：在任一地址中只能使用一次零压缩。
                    CIDR 的斜线表示法仍然可用。
                    例如：60 位的前缀 12AB00000000CD3 可记为：
                    12AB:0000:0000:CD30:0000:0000:0000:0000&#x2F;60
                    或 12AB::CD30:0:0:0:0&#x2F;60 （零压缩）
                    或 12AB:0:0:CD30::&#x2F;60 （零压缩）
        4.6.3  从 IPv4 向 IPv6 过渡
                只能采用逐步演进的办法，使新安装的 IPv6 系统能够向后兼容
                两种向 IPv6 过渡的策略：
                    使用双协议栈
                    使用隧道技术
                双协议栈
                    使一部分主机（或路由器）装有两个协议栈，一个 IPv4 和一个 IPv6
                    同时具有两种 IP 地址：一个 IPv6 地址和一个 IPv4 地址
                隧道技术
                    在 IPv6 数据报要进入 IPv4 网络时，把 IPv6 数据报封装成为 IPv4 数据报
        4.6.4  ICMPv6
            IPv6 也不保证数据报的可靠交付（IPv4也不可靠交付）
            地址解析协议 ARP 和网际组管理协议 IGMP 协议的功能都已被合并到 ICMPv6 中           
    4.7  IP 多播
        4.7.1  IP 多播的基本概念
            IP 多播 (multicast，以前曾译为组播)，一对多通信
                在互联网上进行多播就叫做 IP 多播。
                互联网范围的多播要靠路由器来实现。
                多播数据报的目的地址是多播 IP 地址。
                多播IP 地址是 D 类地址。
                多播地址只能用于目的地址，不能用于源地址
            多播数据报
                使用网际组管理协议 IGMP
                多播数据报也是“尽最大努力交付”。
                对多播数据报不产生 ICMP 差错报文。
        4.7.2  在局域网上进行硬件多播 
            IANA 拥有的以太网地址块的高 24 位为 00-00-5E
            TCP&#x2F;IP 协议使用的以太网多播地址块的范围
                    从   01-00-5E-00-00-00 
                    到   01-00-5E-7F-FF-FF 
            D 类 IP 地址可供分配的有 28 位，前 5 位不能用来构成以太网硬件地址
            由于多播 IP 地址与以太网硬件地址的映射关系不是唯一的，因此收到多播数据报的主机，还要在 IP 层利用软件进行过滤，把不是本主机要接收的数据报丢弃。
        4.7.3  网际组管理协议 IGMP和多播路由选择协议
            IP 多播需要两种协议
                网际组管理协议 IGMP (Internet Group Management Protocol)
                多播路由选择协议
            多播路由选择协议更为复杂
                动态地适应多播组成员的变化
                不能仅仅根据多播数据报中的目的地址，而是还要考虑这个多播数据报从什么地方来和要到什么地方去
                多播数据报可以由没有加入多播组的主机发出
    4.8  虚拟专用网 VPN和网络地址转换 NAT
        4.8.1  虚拟专用网 VPN (Virtual Private Network)
            本地(私网)地址
            全球(公网)地址
            专用地址只能用作本地地址
                在互联网中的所有路由器，对目的地址是专用地址的数据报不转发
            RFC 1918 指明的专用 IP 地址三个专用 IP 地址块：
                (1) 10.0.0.0 到 10.255.255.255
                    A类，或记为10.0.0.0&#x2F;8，它又称为 24 位块
                (2) 172.16.0.0 到 172.31.255.255
                    B类，或记为172.16.0.0&#x2F;12，它又称为 20 位块
                (3) 192.168.0.0 到 192.168.255.255
                    C类，或记为192.168.0.0&#x2F;16，它又称为 16 位块
            利用公网作为本机构各专用网(私网)之间的通信载体，这样的专用网又称为虚拟专用网VPN
                专用网
                    是为本机构的主机用于机构内部的通信，而不是用于和网络外非本机构的主机通信
        4.8.2   网络地址转换 NAT
            使用本地地址的主机在和外界通信时，将其本地地址转换成全球 IP 地址 
            两次地址转换：
                离开专用网时：替换源地址，将内部地址替换为全球地址；
                进入专用网时：替换目的地址，将全球地址替换为内部地址；
            当 NAT 路由器具有 n 个全球 IP 地址时，专用网内最多可以同时有 n 台主机接入到互联网
            通过 NAT 路由器的通信必须由专用网内的主机发起，专用网内部的主机不能充当服务器用
            网络地址与端口号转换 NAPT
                运输层的端口号也利用上，共用一个 NAT 路由器上的全球 IP 地址
                网络地址与端口号转换NAPT (Network Address and Port Translation)，不使用端口号的 NAT 就叫做传统的 NAT
    4.9  多协议标记交换 MPLS
        MPLS 并没有取代 IP，而是一种 IP 增强技术
        为了提高传统路由器IP 分组的转发效率，在 MPLS 域的入口处，给每一个 IP 数据报打上固定长度“标记”，然后对打上标记的 IP 数据报用硬件进行转发

    5.1  运输层协议概述
        5.1.1  进程之间的通信
            网络层：主机之间提供逻辑通信
            运输层：应用进程之间提供端到端的逻辑通信（ IP+端口），复用和分用。
            运输层还要对收到的报文进行差错检测。
            运输层有两种不同的运输协议，即面向连接的 TCP 和无连接的 UDP。   
        5.1.2  运输层的两个主要协议
            (1) 用户数据报协议 UDP (User Datagram Protocol)
            (2) 传输控制协议 TCP (Transmission Control  Protocol)
            UDP：无连接、不可靠、不拆包。单播、多播和广播
            TCP：面向连接、可靠、全双工。只能单播，不能广播或多播。可靠的，开销大。  
        5.1.3  运输层的端口
            UDP和TCP都使用16 位端口号
            网络层的协议类型字段类似于传输层端口号字段
            两类端口 
                (1) 服务器端使用的端口号
                    熟知端口，数值一般为 0~1023。
                    登记端口号，数值为 1024~49151，为没有熟知端口号的应用程序使用的。使用这个范围的端口号必须在 IANA 登记，以防止重复
                (2) 客户端使用的端口号
                    又称为短暂端口号，数值为 49152~65535，留给客户进程选择暂时使用。
            常用的熟知端口
                UDP
                    RPC 111
                    DNS 53
                    TFTP 69
                    SNMP 161
                    SNMP(trap) 162
                TCP
                    SMTP 25
                    FTP 21|20
                    Telent 23
                    HTTP 80
                    HTTPS 443
    5.2  用户数据报协议 UDP
        5.2.1 UDP 的主要特点 
            (1) UDP 是无连接的
            (2) UDP 使用尽最大努力交付
            (3) UDP 是面向报文的
            (4) UDP 没有拥塞控制
            (5) UDP 支持一对一、一对多、多对一和多对多的交互通信。
            (6) UDP 的首部开销小，只有 8 个字节，比 TCP 的 20 个字节的首部要短。
    5.3  传输控制协议 TCP 概述
        5.3.1  TCP 最主要的特点 
            (1) TCP 是面向连接
            (2) TCP 连接只能有两个端点，只能点对点（1对1）
            (3) TCP 是可靠交付
            (4) TCP 全双工通信
            (5) TPC 面向字节流(报文长度进程不可控)
        5.3.2  TCP 的连接 
            把连接作为最基本的抽象
            每一条 TCP 连接有两个端点
            TCP 连接的端点叫做套接字 (socket) 或插口
                端口号拼接到 (contatenated with) IP 地址即构成了套接字
            每一条 TCP 连接唯一地被通信两端的两个端点（即两个套接字）所确定
            TCP 可靠通信的具体实现 
                一个发送窗口和一个接收窗口
                用字节的序号进行控制
                两端的四个窗口经常处于动态变化之中
                使用特定的算法估算较为合理的重传时间
    5.4  可靠传输的工作原理
        5.4.1  停止等待协议
            全双工通信的双方既是发送方也是接收方。
            在发送完一个分组后，必须暂时保留已发送的分组的副本，以备重发
            分组和确认分组都必须进行编号。
            超时计时器的重传时间应当比数据在分组传输的平均往返时间更长一些
            停止等待协议的优点是简单，缺点是信道利用率太低。
        5.4.2  连续ARQ协议
            累积确认
            对按序到达的最后一个分组发送确认
            优点：容易实现，即使确认丢失也不必重传。
            缺点：不能向发送方反映出接收方已经正确收到的所有分组的信息。
            Go-back-N（回退 N） 
                表示需要再退回来重传已发送过的 N 个分组
            当通信线路质量不好时，连续 ARQ 协议会带来负面的影响
    5.5  TCP 报文段的首部格式
        TCP 报文段首部的前 20 个字节是固定的，TCP 首部的最小长度是 20 字节
        若选择较小的 MSS 长度，网络的利用率就降低
        为什么要规定 MSS ？
            只含有 1 字节的数据时
                在 IP 层传输的数据报的开销至少有 40 字节(包括 TCP 报文段的首部和 IP 数据报的首部)。这样，对网络的利用率就不会超过 1&#x2F;41
            TCP 报文段非常长
                IP 层传输时就有可能要分解成多个短数据报片。在终点要把收到的各个短数据报片装配成原来的 TCP 报文段。当传输出错时还要进行重传也都会使开销增大
            MSS 应尽可能大些，只要在 IP 层传输时不需要再分片就行，最佳的 MSS 是很难确定的
    5.6  TCP 可靠传输的实现
        5.6.1  以字节为单位的滑动窗口
            发送缓存与接收缓存的作用
                发送缓存用来暂时存放：
                    发送应用程序传送给发送方 TCP 准备发送的数据；
                    TCP 已发送出但尚未收到确认的数据。
                接收缓存用来暂时存放：
                    按序到达的、但尚未被接收应用程序读取的数据；
                    不按序到达的数据。 
            1. A 的发送窗口并不总是和 B 的接收窗口一样大（因为有一定的时间滞后）
            2. 第二，TCP 标准没有规定对不按序到达的数据应如何处理。
            3. TCP 要求接收方必须有累积确认的功能
            接收方可以在合适的时候发送确认，也可以在自己有数据要发送时把确认信息顺便捎带上
        5.6.2  超时重传时间的选择
            加权平均往返时间
                保留了 RTT 的一个加权平均往返时间 RTTS（这又称为平滑的往返时间）
                RFC 2988 推荐的 a 值为 1&#x2F;8，即 0.125
            超时重传时间 RTO
                RTO (Retransmission Time-Out) 应略大于上面得出的加权平均往返时间 RTTS。
                RTTD：是 RTT 的偏差的加权平均值
            Karn 算法
                新的问题：超时重传时间就无法更新
                修正的 Karn 算法
                    报文段每重传一次，就把 RTO 增大一些
                        新的 RTO &#x3D; y X (旧的 RTO)
                        系数 y 的典型值是 2
        5.6.3  选择确认 SACK
            解决的问题：若收到的报文段无差错，只是未按序号，中间还缺少一些序号的数据，那么能否设法只传送缺少的数据而不重传已经正确到达接收方的数据
                答案是可以的。选择确认 SACK  (Selective ACK) 就是一种可行的处理方法
            每一个字节块都有两个边界：左边界和右边界
    5.7  TCP 的流量控制
        5.7.1  利用滑动窗口实现流量控制
            方法：利用滑动窗口机制
            报文段在传送过程中丢失，发送方和接收方在相互等待，可能会造成互相等待的死锁，因此TCP 为每一个连接设有一个持续计时器 (persistence timer)
                持续计时器：
                    只要 TCP 连接的一方收到对方的零窗口通知，就启动该持续计时器
        5.7.2  必须考虑传输效率
            用不同的机制来控制 TCP 报文段的发送时机
                第一种机制是 TCP 维持一个变量，它等于最大报文段长度 MSS。只要缓存中存放的数据达到 MSS 字节时，就组装成一个 TCP 报文段发送出去
                第二种机制是由发送方的应用进程指明要求发送报文段，即 TCP 支持的推送 (push)操作
                第三种机制是发送方的一个计时器期限到了，这时就把当前已有的缓存数据装入报文段（但长度不能超过 MSS）发送出去    
    5.8  TCP 的拥塞控制
        5.8.1  拥塞控制的一般原理
            出现拥塞的原因：资源需求&gt;可用资源
                拥塞控制是动态的、
                分组的丢失是征兆，不是原因
            开环控制和闭环控制
                开环控制：在设计网络时事先考虑周到
                闭环控制：基于反馈环路：
                    检测何时何地发生
                    传送到可采取行动的地方
                    调整网络系统的运行
        5.8.2  TCP 的拥塞控制方法
            采用基于窗口的方法，TCP发送方维持一个拥塞窗口 CWND (Congestion Window)
            拥塞的判断
                重传定时器超时
                收到三个相同（重复）的 ACK
            TCP拥塞控制算法
                慢开始 (slow-start)
                    思路：由小到大逐渐增大拥塞窗口数值
                    拥塞窗口 cwnd  控制方法：在每收到一个对新的报文段的确认后，可以把拥塞窗口增加最多一个 SMSS 的数值
                    传输轮次 
                        拥塞窗口 cwnd 就加倍
                        所经历的时间就是往返时间 RTT
                    设置慢开始门限状态变量 ssthresh
                        当 cwnd &lt; ssthresh 时，使用慢开始算法。
                        当 cwnd &gt; ssthresh 时，停止使用慢开始算法而改用拥塞避免算法。
                        当 cwnd &#x3D; ssthresh 时，既可使用慢开始算法，也可使用拥塞避免算法。
                拥塞避免 (congestion avoidance)
                    思路：让拥塞窗口 cwnd 缓慢地增大，使拥塞窗口 cwnd 按线性规律缓慢增长
                        因此在拥塞避免阶段就有“加法增大”
                    当网络出现拥塞时（重传定时器超时）
                        发送方判断网络出现拥塞（重传定时器超时）：
                            ssthresh &#x3D; max(cwnd&#x2F;2，2)
                            cwnd &#x3D; 1
                            执行慢开始算法
                    非指完全能够避免了拥塞，而是使网络比较不容易出现拥塞
                    
                快重传 (fast retransmit)
                    尽早知道发生了个别报文段的丢失
                    发送方只要一连收到三个重复确认，就知道接收方确实没有收到报文段，因而应当立即进行重传（即“快重传”）
                快恢复 (fast recovery)
                    (1) 慢开始门限ssthresh&#x3D;当前拥塞窗口cwnd&#x2F;2 ；
                    (2) 新拥塞窗口 cwnd &#x3D; 慢开始门限 ssthresh ；
                    (3) 开始执行拥塞避免算法，使拥塞窗口缓慢地线性增大。 
                加法增大,乘法减小(AIMD)
        5.8.3  主动队列管理 AQM
            网络层对TCP拥塞控制影响最大的是路由器的分组丢弃策略
            路由器的队列
                “先进先出”FIFO 
                当队列已满时，尾部丢弃策略
                全局同步 (global syncronization)
                    很多TCP连接中的报文段服用在网络层IP数据报中，这时发生尾部丢弃，使这许多 TCP 连接在同一时间突然都进入到慢开始状态
                主动队列管理AQM
                    应当在队列长度达到某个值得警惕的数值时（即当网络拥塞有了某些拥塞征兆时），就主动丢弃到达的分组
                    随机早期检测 RED (Random Early Detection)
                        若平均队列长度小于最小门限 THmin，则将新到达的分组放入队列进行排队
                        若平均队列长度超过最大门限 THmax，则将新到达的分组丢弃
                        若平均队列长度在最小门限 THmin 和最大门限THmax 之间，则按照某一概率 p 将新到达的分组丢弃
                        RED 的使用效果并不太理想
                        AQM 实际上就是对路由器中的分组排队进行智能管理，而不是简单地把队列的尾部丢弃
    5.9  TCP 的运输连接管理
        TCP运输的三个阶段
            连接建立
            数据传送
            连接释放
        运输连接的管理
            使运输连接的建立和释放都能正常地进行
        TCP连接的建立采用客户服务器方式
            客户：主动发起连接建立的应用进程
            服务器：被动等待连接建立的应用进程
        5.9.1  TCP 的连接建立
            握手:TCP建立连接的过程
                三报文握手：客户和服务器之间交换三个 TCP 报文段
                    主要是为了防止已失效的连接请求报文段突然又传送到了，因而产生错误
        5.9.2  TCP 的连接释放
            四报文握手：TCP 连接释放过程
            TCP 连接处于半关闭状态
            必须等待 2MSL 的时间
                第一，为了保证 A 发送的最后一个 ACK 报文段能够到达 B
                第二，防止 “已失效的连接请求报文段”出现在本连接中。
        5.9.3  TCP 的有限状态机
            粗实线箭头表示对客户进程的正常变迁。
            粗虚线箭头表示对服务器进程的正常变迁。
            细线箭头表示异常变迁。

1.浏览器输入一个网址，每层用到哪些协议，其作用是什么
    应用层：HTTP:WWW访问协议，DNS:域名解析服务
    传输层：TCP:为HTTP提供可靠的数据传输，UDP：DNS使用UDP传输
    网络层：IP:IP包传输和路由选择，ICMP：提供网络传输中的差错检测，ARP：将本机的默认网关IP地址映射城物理MAC地址
</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">2.</span> <span class="nav-text">


物理层的主要任务：主要任务：确定与传输媒体的接口的一些特性。
机械特性 ：指明接口所用接线器的形状和尺寸、引线数目和排列、固定和锁定装置等。
电气特性：指明在接口电缆的各条线上出现的电压的范围。
功能特性：指明某条线上出现的某一电平的电压表示何种意义。
过程特性 ：指明对于不同功能的各种可能事件的出现顺序。 
一个数据通信系统包括三大部分：源系统（或发送端、发送方）、传输系统（或传输网络）和目的系统（或接收端、接收方）。
模拟信号：连续的
数字信号：离散的
单工：只能有一个方向的通信，而没有反方向的交互
半双工：通信的双发都可以发送信息，但是不能同时发送
全双工：通信双方可以同时发送和接受信息
基带信号（即基本频带信号）—— 来自信源的信号。像计算机输出的代表各种文字或图像文件的数据信号都属于基带信号。
基带信号往往包含有较多的低频成分，甚至有直流成分，而许多信道并不能传输这种低频分量或直流分量。因此必须对基带信号进行调制 (modulation)。   
调制分类：
基带调制：仅对基带信号的波形进行变换，使它能够与信道特性相适应。变换后的信号仍然是基带信号。把这种过程称为编码 (coding)。
带通调制：使用载波 (carrier)进行调制，把基带信号的频率范围搬移到较高的频段，并转换为模拟信号，这样就能够更好地在模拟信道中传输（即仅在一段频率范围内能够通过信道） 。
带通信号 ：经过载波调制后的信号。
常用编码（基带调制）方式：
不归零制：正电平代表 1，负电平代表 0。
归零制：正脉冲代表 1，负脉冲代表 0。
曼彻斯特编码：位周期中心的向上跳变代表 0，位周期中心的向下跳变代表 1。但也可反过来定义。
差分曼彻斯特编码：在每一位的中心处始终都有跳变。位开始边界有跳变代表 0，而位开始边界没有跳变代表 1。
最基本的二元制调制方法有以下几种：
调幅(AM)：载波的振幅随基带数字信号而变化。
调频(FM)：载波的频率随基带数字信号而变化。
调相(PM)：载波的初始相位随基带数字信号而变化。
数字信号通过实际的信道
有失真，可识别。
失真大，无法识别
限制码元在信道上的传输速率的因素：信道能够通过的频率范围 信噪比
信道能够通过的频率范围：奈氏准则 为了避免码间串扰，码元的传输速率的上限值
奈氏准则前提条件：信道无噪声
    对无噪声的通信信道，H是信道的带宽，则信道可达到的最大信号速率（signaling rate)是2H。
信噪比就是信号的平均功率和噪声的平均功率之比。常记为 S&#x2F;N，并用分贝 (dB) 作为度量单位。即：
        信噪比(dB) &#x3D; 10 log10(S&#x2F;N)    (dB)
        例如，当 S&#x2F;N &#x3D; 10 时，信噪比为 10 dB，而当 S&#x2F;N &#x3D; 1000时，信噪比为 30 dB。  
香农公式：带宽受限且有高斯白噪声干扰的信道的极限、无差错的信息传输速率C
            C &#x3D; W log2(1+S&#x2F;N)    (bit&#x2F;s)
            其中：    W 为信道的带宽（以 Hz 为单位）；
                    S 为信道内所传信号的平均功率；
                    N 为信道内部的高斯噪声功率。  
物理层下面的传输媒体（传输介质或传输媒介）：引导型传输媒体 非引导性传输媒体
在导引型传输媒体中，电磁波被导引沿着固体媒体（铜线或光纤）传播。
非导引型传输媒体就是指自由空间。在非导引型传输媒体中，电磁波的传输常称为无线传输
引导性传输媒体：
    双绞线（通信距离一般为几到十几公里）
        是由一对相互绝缘的金属导线绞合而成
        屏蔽双绞线 STP (Shielded Twisted Pair)
            带金属屏蔽层
        无屏蔽双绞线 UTP (Unshielded Twisted Pair)
    同轴电缆
        50欧 同轴电缆 —— LAN &#x2F; 数字传输常用
        75欧 同轴电缆 —— 有线电视 &#x2F; 模拟传输常用
光缆
    多模光纤
    单模光纤
    &lt;imag src&#x3D;&quot;picture&#x2F;屏幕快照 2021-06-15 下午11.16.58.png&quot;&gt;
    光纤优点：
        (1) 通信容量非常大。
        (2) 传输损耗小，中继距离长。
        (2) 抗雷电和电磁干扰性能好。
        (3) 无串音干扰，保密性好。
        (4) 体积小，重量轻。

非导引型传输媒体：
    短波通信：（即高频通信）主要是靠电离层的反射，但短波信道的通信质量较差，传输速率低。
    微波在空间主要是直线传播。
对传送数据来说，现在最常用的 UTP 是5类线（Category 5 或 CAT5）


信道复用技术：
    复用 (multiplexing) 是通信技术中的基本概念。
    它允许用户使用一个共享信道进行通信，降低成本，提高利用率。
    频分复用 FDM：
        所有用户在同样的时间占用不同的带宽资源
    时分复用 TDM：
        将时间划分为一段段等长的时分复用帧（TDM 帧）。每一个时分复用的用户在每一个 TDM 帧中占用固定序号的时隙。
        每一个用户所占用的时隙是周期性地出现（其周期就是 TDM  帧的长度）。
        TDM 信号也称为等时(isochronous)信号。
        时分复用的所有用户是在不同的时间占用同样的频带宽度。
        时分复用可能会造成线路资源的浪费
        统计时分复用 STDM：
            STDM 帧不是固定分配时隙，而是按需动态地分配时隙。因此统计时分复用可以提高线路的利用率。
    波分复用 WDM：
    码分复用 CDM：
        常用的名词是码分多址 CDMA：
            每个站分配的码片序列不仅必须各不相同，并且还必须互相正交 (orthogonal)
            在实用的系统中是使用伪随机码序列
        码片：每一个比特时间划分为 m 个短的间隔
        每个站被指派一个唯一的 m bit 码片序列
        两个不同站的码片序列正交，就是向量 S 和T 的规格化内积 (inner product) 等于 0
        假定所分配的代码具有两个特点：
        每个代码与其他代码相乘，得到0；
        每个代码自己相乘，得到4（站的数量）。
        每个站用数据d乘以代码，得到d1c1, d2c2,…,信道中的数据是所有这些项的和。
数字传输系统：
    与模拟通信相比，数字通信无论是在传输质量上还是经济上都有明显的优势。
    脉码调制 PCM 体制最初是为了在电话局之间的中继线上传送多路的电话。
        北美的 24 路 PCM（简称为 T1）
        欧洲的 30 路 PCM（简称为 E1）
            我国采用的是欧洲的 E1 标准。
    旧的数字传输系统主要缺点：
        速率标准不统一
        不是同步传输
    同步光纤网 SONET (Synchronous Optical Network)：
        对电信信号称为第 1 级同步传送信号 STS-1 (Synchronous Transport Signal)，其传输速率是 51.84 Mbit&#x2F;s。
        对光信号则称为第 1 级光载波 OC-1 (OC 表示Optical Carrier)。
    同步数字系列 SDH (Synchronous Digital Hierarchy)：
        ITU-T 以美国标准 SONET 为基础，制订出国际标准
    一般可认为 SDH 与 SONET 是同义词
    SDH SONET的不同点是：SDH 的基本速率为 155.52 Mbit&#x2F;s，称为第 1 级同步传递模块 (Synchronous Transfer Module)，即 STM-1，相当于 SONET 体系中的 OC-3 速率
    SONET &#x2F; SDH 标准的意义：
        第一次真正实现了数字传输体制上的世界性标准。
        已成为公认的新一代理想的传输网体制。
宽带接入技术：
    初期：利用电话线，最高只能达到 56 kbit&#x2F;s
    宽带：只要双向速率之和超过 200 kbit&#x2F;s
    有线宽带接入：
        非对称数字用户线 ADSL(Asymmetric Digital Subscriber Line) ：
            把 0~4 kHz 低端频谱留给传统电话使用，而把原来没有被利用的高端频谱留给用户上网使用。
            DSL 就是数字用户线 (Digital Subscriber Line) 的缩写。
            传输距离取决于数据率和用户线的线径（用户线越细，信号传输时的衰减就越大）
            特点：
                上行和下行带宽做成不对称的。
                    上行指从用户到 ISP，而下行指从 ISP 到用户
                在用户线（铜线）的两端各安装一个 ADSL 调制解调器
                我国目前采用的方案是离散多音调 DMT (Discrete Multi-Tone)调制技术：
                    “多音调”就是“多载波”或“多子信道”的意思。
                    采用频分复用方法
                    相当于在一对用户线上使用许多小的调制解调器并行地传送数据
            ADSL 的数据率：
                ADSL 采用自适应调制技术使用户线能够传送尽可能高的数据率
                不能保证固定的数据率
            第二代 ADSL：
                更高的数据率
                无缝速率自适应技术 SRA (Seamless Rate Adaptation)
        光纤同轴混合网（HFC网）：
            CATV 网采用模拟技术的频分复用
            HFC 网对 CATV 网进行了改造：
                将原 CATV 网中的同轴电缆主干部分改换为光纤，并使用模拟光纤技术
                在模拟光纤中采用光的振幅调制 AM，这比使用数字光纤更为经济
                模拟光纤从头端连接到光纤结点 (fiber node)，即光分配结点 ODN (Optical Distribution Node)在光纤结点光信号被转换为电信号。在光纤结点以下就是同轴电缆。
    用户接口盒 UIB (User Interface Box) 要提供三种连接：
        使用同轴电缆连接到机顶盒 (set-top box)，然后再连接到用户的电视机。
        使用双绞线连接到用户的电话机。
        使用电缆调制解调器连接到用户的计算机。
    电缆调制解调器 (Cable Modem)：
        是为 HFC 网而使用的调制解调器


数据链路层使用的信道主要有以下两种类型：
    点对点信道:
        这种信道使用一对一的点对点通信方式
    广播信道:
        这种信道使用一对多的广播通信方式，因此过程比较复杂
    链路 (link)（物理链路） :
        是一条无源的点到点的物理线路段，中间没有任何其他的交换结点
    数据链路 (data link)（逻辑链路）:
        把实现协议的硬件和软件加到链路上
    通信规程：早期的数据通信协议
    三个基本问题：
        1. 封装成帧：在一段数据的前后分别添加首部和尾部，进行帧定界（可以使用帧定界符）
        2. 透明传输：字节填充 (byte stuffing) 或字符填充 (character stuffing)，插入一个转义字符“ESC”
        3. 差错控制 ：比特差错：1 可能会变成 0 而 0 也可能变成 1。
            误码率：在一段时间内，传输错误的比特占所传输比特总数的比率
    循环冗余检验 CRC 的检错技术：
        在数据链路层传送的帧中，广泛使用
        冗余码 帧检验序列 FCS (Frame Check Sequence)：
 
        (1) 若得出的余数 R &#x3D; 0，则判定这个帧没有差错，就接受 (accept)。
        (2) 若余数 R  0，则判定这个帧有差错，就丢弃。
        只能做到无差错接受 (accept)
        (要做到“可靠传输”（即发送什么就收到什么）就必须再加上确认和重传机制。)
        “无比特差错”与“无传输差错”是不同的概念。
    点对点协议 PPP (Point-to-Point Protocol):
        首要的要求:简单
        PPP 是面向字节的，所有的 PPP 帧的长度都是整数字节。
        同步传输链路时，协议规定采用硬件来完成比特填充（和 HDLC 的做法一样）：
            在使用SONET&#x2F;SDH链路时，使用同步传输， PPP 协议采用零比特填充方法来实现透明传输
        用在异步传输时，就使用一种特殊的字符填充法
    广播信道：
        静态划分信道：
            频分复用
            时分复用
            波分复用
            码分复用
        动态媒体接入控制（多点接入）
        DIX Ethernet V2 是世界上第一个局域网产品（以太网）的规约
        IEEE 802.3 是第一个 IEEE 的以太网标准。
        通信适配器 (adapter) &#x2F; 网络接口卡 NIC (Network Interface Card) &#x2F; 网卡：网络接口板：
            重要功能：
                进行串行&#x2F;并行转换。
                对数据进行缓存。
                在计算机的操作系统安装设备驱动程序。
                实现以太网协议。
        CSMA&#x2F;CD协议：
            含义：载波监听 多点接入 &#x2F; 碰撞检测
                “多点接入”    多点共线
                “载波监听”    先听后讲
                “碰撞检测”    边讲边听
            重要特性：
                只能半双工通信
                碰撞
            争用期 &#x2F; 碰撞窗口：
                定义： 时间 2t（两倍的端到端往返时延）就可知道发送的数据帧是否遭受了碰撞
                长度：10 Mbit&#x2F;s 以太网取 51.2 us 为争用期的长度
                发生碰撞的站在停止发送数据后，要推迟（退避）一个随机时间才能再发送数据
                从整数集合 [0, 1, … , (2k 1)] 中随机地取出一个数，记为 r。重传所需的时延就是 r 倍的基本退避时间
                    k &#x3D; Min[重传次数, 10]
                传达 16 次仍不能成功时即丢弃该帧，并向高层报告
                强化碰撞：
                    (1) 立即停止发送数据；
                    (2) 再继续发送32&#x2F;48比特的人为干扰信号,以便让所有节点都知道现在已经发生了碰撞。
            要点：1）准备发送
                 2）检测信道
                 3）检查碰撞 ：
                    两种可能性：发送成功 发送失败
            以太网采取了两种重要的措施：
                采用较为灵活的无连接的工作方式
                以太网发送的数据都使用曼彻斯特
        3.3.3集线器：
            1990 年，IEEE 制定出星形以太网 10BASE-T 的标准 802.3i
            每个站到集线器的距离不超过 100 m
            特点：
                集线器以太网逻辑上仍是总线网，仍使用 CSMA&#x2F;CD 协议
                集线器工作在物理层，仅简单转发。
        3.3.4以太网的信道利用率：
                成功发送一个帧需要占用信道的时间是 T0 + T
                对以太网参数 α 的要求是：
                    当数据率一定时，以太网的连线的长度受到限制，否则 T 的数值会太大。
                    以太网的帧长不能太短，否则 T0 的值会太小，使 α 值太大。
                信道利用率的最大值 Smax ：
                    理想化的情况下
        3.3.5以太网的 MAC 层：
            硬件地址 &#x2F; 物理地址 &#x2F; MAC地址
                每个网卡有一个MAC地址
            必须保证生产出的适配器没有重复地址
            I&#x2F;G（ Individual &#x2F; Group）第一字节的最低位：
                当 I&#x2F;G位 &#x3D; 0 时，地址字段表示一个单站地址
                当 I&#x2F;G位 &#x3D; 1 时，表示组地址，用来进行多播
            G&#x2F;L（Global &#x2F; Local）
                当 G&#x2F;L位 &#x3D; 0 时，是全球管理
                当 G&#x2F;L位 &#x3D; 1 时，是本地管理
            适配器检查 MAC 地址：
                如果是发往本站的帧则收下，然后再进行其他的处理。
                否则就将此帧丢弃，不再进行其他的处理。
                发往本站的帧：
                    单播 (unicast) 帧（一对一）
                    广播 (broadcast) 帧（一对全体）
                    多播 (multicast) 帧（一对多）
                所有的适配器都至少能够识别单播地址和广播地址。
                只有目的地址才能使用广播地址和多播地址
                以混杂方式 (promiscuous mode) 工作的以太网适配器只要“听到”有帧在以太网上传输就都接收下来。
            以太网 V2 MAC 帧的格式：
                标准：DIX Ethernet V2 标准和IEEE 的 802.3 标准
                    最常用的 MAC 帧是以太网 V2 的格式
                数据字段的正式名称是 MAC 客户数据字段
                当数据字段的长度小于 46 字节时,应在数据字段的后面加入整数字节的填充字段，以保证以太网的 MAC 帧长不小于 64 字节。
                无效的 MAC 帧:
                    数据字段的长度与长度字段的值不一致
            IEEE 802.3 MAC 帧格式:
                与V2的区别：第三个字段是“长度 &#x2F; 类型”
            帧间最小间隔：
                9.6us,为了使站的接收缓存来得及清理
    3.4 拓展的以太网：
        3.4.1 在物理层的扩展：
            使用光纤扩展
            使用集线器扩展：
                优点：使原来属于不同碰撞域的以太网上的计算机能够进行跨碰撞域的通信。
                      扩大了以太网覆盖的地理范围。
                缺点：碰撞域增大了，但总的吞吐量并未提高。
                      如果不同的碰撞域使用不同的数据率，那么就不能用集线器将它们互连起来。
        3.4.2 在数据链路层扩展：
            早期使用网桥，现在使用以太网交换机：
                网桥工作：根据 MAC 帧的目的地址对收到的帧进行转发和过滤
            交换式集线器淘汰了网桥：
                常称为以太网交换机 或二层交换机
            以太网交换机：
                特点：
                    以太网交换机是多接口的网桥
                    工作在全双工方式
                    具有并行性：
                        能同时连通多对接口，使多对主机能同时通信
                    相互通信的主机都是独占传输媒体，无碰撞地传输数据
                    接口有存储器
                    即插即用，地址表自学习
                交换方式：
                    存储转发方式
                        把整个数据帧先缓存后再进行处理
                    直通 (cut-through) 方式
                        接收同时就立即按数据帧的目的 MAC 地址
                        缺点：有可能也将一些无效帧转发给其他的站
                自学习功能：
                    交换表一开始是空的
                    先查找交换表，没有查到应从哪个接口转发这个帧
                    把这个帧的源地址 A 和接口 1 写入交换表中，并向除接口1以外的所有的接口广播这个帧
                    过滤：C 和 D 将丢弃这个帧，因为目的地址不对。只 B 才收下这个目的地址正确的帧
                    在交换表中每个项目都设有一定的有效时间。过期的项目就自动被删除
                    交换机自学习和转发帧的步骤归纳：
                        先进行自学习，查找表中有无相匹配的源地址的项目：
                            如没有，就在交换表中增加一个项目（源地址、进入的接口和有效时间）。
                            如有，则把原有的项目进行更新（进入的接口或有效时间）
                        转发帧，查找表中有无相匹配的源地址的项目：
                            如没有，则向所有其他接口（进入的接口除外）转发。
                            如有，则按交换表中给出的接口进行转发。
                            若交换表中给出的接口就是该帧进入交换机的接口，则应丢弃这个帧（因为这时不需要经过交换机进行转发）
                    增加冗余链路时，自学习的过程就可能导致以太网帧在网络的某个环路中无限制地兜圈子
                    交换以太网不使用共享总线
                    没有碰撞问题，不使用 CSMA&#x2F;CD 协议，以全双工方式工作。但仍采用以太网的帧结构。
        3.4.3 虚拟局域网
            虚拟局域网 VLAN 是一种逻辑划分
            同VLAN小组成员收到广播信息，其他VLAN接受不到
            有利于防止：广播风暴
            VLAN 标记 (tag)：帧格式中插入一个4字节的标识符，用来指明发送该帧的计算机（接口）属于哪一个虚拟局域网
            插入 VLAN 标记得出的帧称：802.1Q 帧 或 带标记的以太网帧。
        3.5.1 100BASE-T 以太网 &#x2F; 快速以太网(Fast Ethernet)
            代号：IEEE 802.3u
            高速以太网：速率达到或超过 100 Mbit&#x2F;s 的以太网
            特点：在全双工方式下工作时，不使用 CSMA&#x2F;CD 协议
                 MAC 帧格式仍然是 802.3 标准规定的
                 保持最短帧长不变，但将一个网段的最大电缆长度减小到 100 m
                 帧间时间间隔从原来的 9.6 s 改为现在的 0.96 us
        3.5.2 吉比特以太网
            在半双工方式下使用 CSMA&#x2F;CD 协议，全双工方式不使用 CSMA&#x2F;CD 协议
            使用两种成熟的技术：一种来自现有的以太网，另一种则是美国国家标准协会 ANSI 制定的光纤通道 FC  (Fiber Channel)
            半双工方式工作的吉比特以太网
                为保持 64 字节最小帧长度，以及 100 米的网段的最大长度，吉比特以太网增加了两个功能：
                    载波延伸 (carrier extension)
                        将争用时间增大为 512 字节
                    分组突发 (packet bursting)
            全双工方式工作的吉比特以太网
                不使用载波延伸和分组突发
            10 吉比特以太网和更快的以太网
                只工作在全双工方式
            端到端的以太网传输
                实现了端到端的以太网传输的好处：
                    技术成熟；
                    互操作性很好；
                    在广域网中使用以太网时价格便宜；
                    采用统一的以太网帧格式，简化了操作和管理
        3.5.3 以太网从 10 Mbit&#x2F;s 到100 Gbit&#x2F;s 的演进证明：
            可扩展的（从 10 Mbit&#x2F;s 到 100 Gbit&#x2F;s）；
            灵活的（多种传输媒体、全&#x2F;半双工、共享&#x2F;交换）；
            易于安装；
            稳健性好。
        3.5.4 使用以太网进行宽带接入
            特点：
                可以提供双向的宽带通信。
                可以根据用户对带宽的需求灵活地进行带宽升级。
                可以实现端到端的以太网传输，中间不需要再进行帧格式的转换。这就提高了数据的传输效率且降低了传输的成本。
                但是不支持用户身份鉴别。
            PPPoE (PPP over Ethernet)
                在以太网上运行 PPP，把 PPP 协议与以太网协议结合起来 —— 将 PPP 帧再封装到以太网中来传输

    4.1  网络层提供的两种服务 
        面向连接 无连接 
        争论的实质是：可靠交付是网络负责，还是端系统负责。
        结论： “无连接”赢了
        让网络负责可靠交付：
            使用面向连接的通信方式
            先建立虚电路 (Virtual Circuit)
                虚电路是逻辑连接
                分组按照存储转发方式传送
                电路交换的电话通信是先建立了一条真正的连接
        网络提供数据报服务：
            网络层向上只提供简单灵活的、无连接的、尽最大努力交付的数据报服务
            网络层不提供服务质量的承诺
            尽最大努力交付：
                传输网络不提供端到端的可靠传输服务
                主机中的运输层负责可靠交付（包括差错处理、流量控制等）
    4.2 网际协议 IP
        地址解析协议 ARP(Address Resolution Protocol)
        网际控制报文协议 ICMP(Internet Control Message Protocol)
        网际组管理协议 IGMP(Internet Group Management Protocol)
        4.2.1 虚拟网络互联
            中间设备 &#x2F; 中间系统 &#x2F; 中继系统
                物理层中继系统：集线器 (repeater)。
                数据链路层中继系统：网桥 或 交换机。
                网络层中继系统：路由器 (router)。
                网桥和路由器的混合物：桥路器 (brouter)，二三层。
                网络层以上的中继系统：网关 (gateway)。  
            网络互联：
                中继系统是转发器或者网桥时，不称为网络互联，仍然是一个网络
                网络互连都是指用路由器进行网络互连和路由选择
                路由器称为网关
            虚拟网络互联
                虚拟互连网络也就是逻辑互连网络，
                利用 IP 协议就可以使这些性能各异的网络从用户看起来好像是一个统一的网络
                IP网：使用 IP 协议的虚拟互连网络
                好处：当互联网上的主机进行通信时，就好像在一个网络上通信一样，而看不见互连的各具体的网络异构细节。
                如果在这种覆盖全球的 IP 网的上层使用 TCP 协议，那么就是现在的互联网 (Internet)。
        4.2.2 分类的IP地址
            唯一的 32 位的标识符
            IP 地址现在由互联网名字和数字分配机构ICANN 进行分配
            IP地址的编址方法：
                1.分类的IP地址
                    公网 IP 地址在整个互联网范围内是唯一的。
                    私网 IP 地址在整个私网范围内是唯一的。
                    2进制开头 地址的网络号字段 主机号字段 每个网络最大主机数
                        A 0 8 24 2^24-2
                        B 10 16 16 2^16-2
                        C 110 24 8 2^8-2
                        D 1110 多播地址
                        E 1111 保留为今后使用
                    特殊的 IP 地址 全0 &#x2F; 1
                    重要特点：
                        (1) IP 地址是一种分等级的地址结构
                        (2) 实际上 IP 地址是标志一个主机（或路由器）和一条链路的接口
                            多归属主机:具有两个IP地址，和不通的网络号
                        (3) 用转发器或网桥连接起来的若干个局域网仍为一个网络，因此这些局域网都（？一般）具有同样的网络号 net-id。网络号不同必须使用路由器连接
                        (4) 所有分配到网络号 net-id 的网络，都是平等的


            2.子网的划分
            3.构成超网
    4.2.3 IP 地址与硬件地址
        硬件地址（或物理地址）是数据链路层和物理层使用的地址
        IP 地址是网络层和以上各层使用的地址，是一种逻辑地址
            称 IP 地址是逻辑地址是因为 IP 地址是用软件实现的
        两个路由器的 IP 地址并不出现在 IP 数据报的首部中
    4.2.4 地址解析协议 ARP
        通信时使用了两个地址：IP 地址（网络层地址） MAC 地址（数据链路层地址）
        作用：已知IP地址，求硬件地址
        实际网络传送数据必须使用硬件地址
        每一个主机都设有一个ARP高速缓存，有IP地址到硬件地址的映射表
        当主机 A 欲向本局域网上的某个主机 B 发送 IP 数据报时：
            如有，就可查出其对应的硬件地址，再将此硬件地址写入 MAC 帧，并发送
            如没有， 本局域网广播一个 ARP 请求分组。收到 ARP 响应分组后，将得到的 IP 地址到硬件地址的映射写入 ARP 高速缓存。组MAC帧发送
        要点：
            ARP请求分组：包含发送方硬件地址 &#x2F; 发送方 IP 地址 &#x2F; 0 &#x2F; 目标方 IP 地址。
            本地广播 ARP 请求（路由器不转发ARP请求）。
            ARP 响应分组：发送方硬件地址 &#x2F; 发送方 IP地址 &#x2F; 目标方硬件地址 &#x2F; 目标方 IP 地址。
            ARP 分组封装在物理网络的帧中传输。
            抓包
        ARP 高速缓存的作用
            存放最近获得的 IP 地址到 MAC 地址的绑定，以减少 ARP 广播的数量。
            减少网络上的通信量
            主机 B (所有主机)收到 A 的 ARP 请求分组时，就将主机 A 的这一地址映射写入主机 B 自己的 ARP 高速缓存中。这对主机 B 以后向 A 发送数据报时就更方便了
    4.2.5 IP 数据报的格式
        由首部和数据两部分组成
            首部的前一部分是固定长度，共 20 字节
        IP首部长度占4位，可表示的最大数值是 15 个单位(一个单位为 4 字节)IP 的首部长度的最大值是 60 字节
        区分服务：占8位，实际上一直未被使用，一般情况下都不使用这个字段
        总长度：占16位，数据报最大长度为2^16-1字节
        原始数据报首部被复制为各数据报片的首部，但必须修改有关字段的值
        IP 数据报首部的可变部分
            从 1 个字节到 40 个字节不等
    4.2.6 IP 层转发分组的流程
        路由器分组转发算法 
            (1) 从数据报的首部提取目的主机的 IP 地址 D, 得出目的网络地址为 N。
            (2) 若网络 N 与此路由器直接相连，则把数据报直接交付目的主机 D；否则是间接交付，执行 (3)。
            (3) 若路由表中有目的地址为 D 的特定主机路由，则把数据报传送给路由表中所指明的下一跳路由器；否则，执行 (4)。
            (4) 若路由表中有到达网络 N 的路由，则把数据报传送给路由表指明的下一跳路由器；否则，执行 (5)。
            (5) 若路由表中有一个默认路由，则把数据报传送给路由表中所指明的默认路由器；否则，执行 (6)。
            (6)  报告转发分组出错。 
4.3 划分子网和构造超网
    4.3.1   划分子网
        基本思路
            划分子网纯属一个单位内部的事情
            从主机号借用若干个位作为子网号 subnet-id
        子网的掩码
            从一个 IP 数据报的首部并无法判断是否进行了子网划分
            使用子网掩码 (subnet mask) 可以找出 IP 地址中的子网部分
            规则
                子网掩码长度 ＝ 32 位
                某位 ＝ 1：IP地址中的对应位为网络号和子网号
                某位 ＝ 0：IP地址中的对应位为主机号  
        子网划分方法
            文档规定不能为全 1 或全 0，现在全 1 和全 0 的子网号也可以使用了
            划分子网增加了灵活性，但却减少了能够连接在网络上的主机总数。


                子网数：192&#x3D;128+64(n&#x3D;2)
                       2^n-2:子网数
                子网主机数：2^(16-n)-2
        4.3.2  在划分子网情况下路由器转发分组的算法 
            (1) 从收到的分组的首部提取目的 IP 地址 D。
            (2) 先用各网络的子网掩码和 D 逐位相“与”，看是否和相应的网
                络地址匹配。若匹配，则将分组直接交付。否则就是间接交付，
                执行 (3)。
            (3) 若路由表中有目的地址为 D 的特定主机路由，则将分组传送给
                指明的下一跳路由器；否则，执行 (4)。
            (4) 对路由表中的每一行，将子网掩码和 D 逐位相“与”。若结果与该行的目的网络地址匹配，则将分组传送给该行指明的下一跳路由器；否则，执行 (5)。
            (5) 若路由表中有一个默认路由，则将分组传送给路由表中所指明
                的默认路由器；否则，执行 (6)。
            (6) 报告转发分组出错。
            【例4-4】已知互联网和路由器 R1 中的路由表。主机 H1 向 H2 发送分组。试讨论 R1 收到 H1 向 H2 发送的分组后查找路由表的过程。
            ppt 475
        4.3.3  无分类编址 CIDR
            变长子网掩码 VLSM (Variable Length Subnet Mask) &#x2F; 无分类域间路由选择 CIDR (Classless Inter-Domain Routing)
            特点：
                消除了传统的 A 类、B 类和 C 类地址以及划分子网的概念
                使用各种长度的“网络前缀”(network-prefix)
                斜线记法”(slash notation) &#x2F; CIDR 记法
            CIDR地址块：
                128.14.32.0&#x2F;20 表示的地址块共有 2^12（4*8-20） 个地址（因为斜线后面的 20 是网络前缀的位数，所以这个地址的主机号是 12 位）。
                    这个地址块的起始地址是 128.14.32.0。
                    在不需要指出地址块的起始地址时，也可将这样的地址块简称为“&#x2F;20 地址块”。
                    128.14.32.0&#x2F;20 地址块的最小地址：128.14.32.0
                    128.14.32.0&#x2F;20 地址块的最大地址：128.14.47.255
                    全 0 和全 1 的主机号地址一般不使用。
                路由聚合：
                    一个 CIDR 地址块可以表示很多地址
                    有利于减少路由器之间的路由选择信息的交换，从而提高了整个互联网的性能有利于减少路由器之间的路由选择信息的交换，从而提高了整个互联网的性能
                    路由聚合也称为构成超网 (supernetting)
                    仍然使用“掩码”
                    对于 &#x2F;20  地址块，它的掩码是 20 个连续的 1。 斜线记法中的数字就是掩码中1的个数
                    10.0.0.0&#x2F;10 可简写为 10&#x2F;10
                    10.0.0.0 的掩码是 255.192.0.0
                    星号 * ：
                        在星号 * 之前是网络前缀，而星号 * 表示 IP 地址中的主机号，可以是任意值
                    最长前缀匹配 (longest-prefix matching) &#x2F;最长匹配或最佳匹配
                        选择两个匹配的地址中更具体的一个，即选择最长前缀的地址
    4.4  网际控制报文协议 ICMP
            有效地转发 IP 数据报和提高交付成功
            ICMP 询问报文有两种 
                回送请求和回答报文
                时间戳请求和回答报文
            4.4.2  ICMP 的应用举例
                PING 用来测试两个主机之间的连通性,使用了 ICMP 回送请求与回送回答报文
                Tracerout 用来跟踪一个分组从源点到终点的路径
    4.5  互联网的路由选择协议
        4.5.1  有关路由选择协议的几个基本概念
                内部网关协议 IGP (Interior Gateway Protocol)
                    自治系统内部使用
                外部网关协议 EGP (External Gateway Protocol)    
                    不同的自治系统之间传路由选择信息
        4.5.2  内部网关协议 RIP
            分布式的、基于距离向量的路由选择协议
            要求网络中的每一个路由器都要维护从它自己到其他每一个目的网络的距离记录
            距离 &#x2F; 跳数 &#x2F; 最短距离：
                从一个路由器到直接连接的网络的距离定义为 1
                每经过一个路由器，跳数就加 1
                一个好的路由，距离短
                一条路径最多只能包含 15 个路由器，“距离”的最大值为 16 时即相当于不可达
                RIP 不能在两个网络之间同时使用多条路由
            三个特点：
                仅和相邻路由器交换信息
                交换的信息是当前本路由器所知道的全部信息，即自己的路由表
                按固定的时间间隔交换路由信息
            路由表的建立
                刚刚开始工作，路由表是空的
                收敛 (convergence) 过程较快    
                距离向量算法
                    路由器收到相邻路由器（其地址为 X）的一个 RIP 报文：
                    (1) 先修改此 RIP 报文中的所有项目：把“下一跳”字段中的地址都改为 X，并把所有的“距离”字段的值加 1。
                    (2) 对修改后的 RIP 报文中的每一个项目，重复以下步骤：
                        若项目中的目的网络不在路由表中，则把该项目加到路由表中。
                        否则若下一跳字段给出的路由器地址是同样的，则把收到的项目替换原路由表中的项目。
                        否则若收到项目中的距离小于路由表中的距离，则进行更新，否则，什么也不做。
                    (3) 若 3 分钟还没有收到相邻路由器的更新路由表，则把此相邻路由器记为不可达路由器，即将距离置为 16（表示不可达）。
                    (4) 返回。
                    
            协议特点：好消息传播得快，坏消息传播得慢。
            RIP 存在的一个问题：当网络出现故障时，要经过比较长的时间 (例如数分钟) 才能将此信息传送到所有的路由器。
            优点：实现简单，开销较小。
            缺点：RIP 限制了网络的规模，它能使用的最大距离为 15（16 表示不可达）。
            路由器之间交换的是完整路由表，因而网络规模越大，开销就越大。 
            “坏消息传播得慢”，使更新过程的收敛时间过长。
        4.5.3  内部网关协议 OSPF 开放最短路径优先 OSPF (Open Shortest Path First)
            “开放”表明 OSPF 不受某一厂商控制，而是公开的
            “最短路径优先”是因为使用了 Dijkstra 提出的最短路径算法 SPF
            要点：只有链路状态发生变化，才用IP 数据报和洪泛法发送链路状态（度量） 
            三个要点
                向本自治系统中所有路由器发送信息，洪泛法
                发送的信息就是与本路由器相邻的所有路由器的链路状态，但这只是路由器所知道的部分信息。
                只有当链路状态变化时，路由器才用洪泛法向所有路由器发送此信息
            链路状态数据库 (link-state database) 
                由所有的路由器最终建立
                全网的拓扑结构图，它在全网范围内是一致的
                OSPF 的链路状态数据库能较快地进行更新
            其他特点：
                OSPF 对于不同类型的业务可计算出不同的路由
                多路径间的负载平衡：到同一个目的网络有多条相同代价的路径，那么可以将通信量分配给这几条路径
                所有在 OSPF 路由器之间交换的分组都具有鉴别的功能
                支持可变长度的子网划分和无分类编址 CIDR
        4.5.4  外部网关协议 BGP
            不同自治系统的路由器之间交换路由信息的协议
            只是力求寻找一条能够到达目的网络且比较好的路由（不能兜圈子），而并非要寻找一条最佳路由
            先建立 TCP 连接
            特点：
                自治系统数的量级
                BGP 支持 CIDR
                更新有变化的部分。这样做对节省网络带宽和减少路由器的处理开销都有好处。 
        4.5.5  路由器的构成
            “转发”和“路由选择”的区别 
                转发：路由器根据转发表将用户的 IP 数据报从合适的端口转发出去
                路由选择：按照分布式算法，根据从各相邻路由器得到的关于网络拓扑的变化情况，动态地改变所选择的路由
            分组丢弃：
                路由器中的输入或输出队列产生溢出是造成分组丢失的重要原因
    4.6  IPv6
        4.6.1  IPv6 的基本首部
            主要变化：
                更大的地址空间。从 IPv4 的 32 位 增大到128 位。 
                扩展的地址层次结构。 
                灵活的首部格式。 定义了许多可选的扩展首部。
                改进的选项。 允许数据报包含有选项的控制信息
                允许协议继续扩充。 
                支持即插即用（即自动配置）。不需要 DHCP。
                支持资源的预分配。  支持特定带宽和时延的应用。
                IPv6 首部 8 字节对齐。 IPv4 首部是 4 字节对齐。          
            数据报：
                由基本首部（40个字节）有效载荷（不超过65535）两大部分组成
                对首部的更改：
                    取消了首部长度字段，因为首部长度是固定的 40 字节；
                    取消了服务类型字段；
                    取消了总长度字段，改用有效载荷长度字段；
                    把 TTL 字段改称为跳数限制字段；
                    取消了协议字段，改用下一个首部字段；
                    取消了检验和字段；
                    取消了选项字段，而用扩展首部来实现选项功能。
            拓展首部
                IPv6 把原来 IPv4 首部中选项的功能都放在扩展首部中，大大提高了路由器的处理效率
                六种扩展首部：  
                    (1) 逐跳选项
                    (2) 路由选择
                    (3) 分片
                    (4) 鉴别
                    (5) 封装安全有效载荷
                    (6) 目的站选项 
        4.6.2  IPv6 的地址
            (1) 单播 (unicast)：传统的点对点通信。
            (2) 多播 (multicast)：一点对多点的通信。
            (3) 任播 (anycast)：这是 IPv6 增加的一种类型。任播的目的站是一组计算机，但数据报在交付时只交付其中的一个，通常是距离最近的一个。 
            冒号十六进制记法
                零压缩
                    即一连串连续的零可以为一对冒号所取代
                    注意：在任一地址中只能使用一次零压缩。
                    CIDR 的斜线表示法仍然可用。
                    例如：60 位的前缀 12AB00000000CD3 可记为：
                    12AB:0000:0000:CD30:0000:0000:0000:0000&#x2F;60
                    或 12AB::CD30:0:0:0:0&#x2F;60 （零压缩）
                    或 12AB:0:0:CD30::&#x2F;60 （零压缩）
        4.6.3  从 IPv4 向 IPv6 过渡
                只能采用逐步演进的办法，使新安装的 IPv6 系统能够向后兼容
                两种向 IPv6 过渡的策略：
                    使用双协议栈
                    使用隧道技术
                双协议栈
                    使一部分主机（或路由器）装有两个协议栈，一个 IPv4 和一个 IPv6
                    同时具有两种 IP 地址：一个 IPv6 地址和一个 IPv4 地址
                隧道技术
                    在 IPv6 数据报要进入 IPv4 网络时，把 IPv6 数据报封装成为 IPv4 数据报
        4.6.4  ICMPv6
            IPv6 也不保证数据报的可靠交付（IPv4也不可靠交付）
            地址解析协议 ARP 和网际组管理协议 IGMP 协议的功能都已被合并到 ICMPv6 中           
    4.7  IP 多播
        4.7.1  IP 多播的基本概念
            IP 多播 (multicast，以前曾译为组播)，一对多通信
                在互联网上进行多播就叫做 IP 多播。
                互联网范围的多播要靠路由器来实现。
                多播数据报的目的地址是多播 IP 地址。
                多播IP 地址是 D 类地址。
                多播地址只能用于目的地址，不能用于源地址
            多播数据报
                使用网际组管理协议 IGMP
                多播数据报也是“尽最大努力交付”。
                对多播数据报不产生 ICMP 差错报文。
        4.7.2  在局域网上进行硬件多播 
            IANA 拥有的以太网地址块的高 24 位为 00-00-5E
            TCP&#x2F;IP 协议使用的以太网多播地址块的范围
                    从   01-00-5E-00-00-00 
                    到   01-00-5E-7F-FF-FF 
            D 类 IP 地址可供分配的有 28 位，前 5 位不能用来构成以太网硬件地址
            由于多播 IP 地址与以太网硬件地址的映射关系不是唯一的，因此收到多播数据报的主机，还要在 IP 层利用软件进行过滤，把不是本主机要接收的数据报丢弃。
        4.7.3  网际组管理协议 IGMP和多播路由选择协议
            IP 多播需要两种协议
                网际组管理协议 IGMP (Internet Group Management Protocol)
                多播路由选择协议
            多播路由选择协议更为复杂
                动态地适应多播组成员的变化
                不能仅仅根据多播数据报中的目的地址，而是还要考虑这个多播数据报从什么地方来和要到什么地方去
                多播数据报可以由没有加入多播组的主机发出
    4.8  虚拟专用网 VPN和网络地址转换 NAT
        4.8.1  虚拟专用网 VPN (Virtual Private Network)
            本地(私网)地址
            全球(公网)地址
            专用地址只能用作本地地址
                在互联网中的所有路由器，对目的地址是专用地址的数据报不转发
            RFC 1918 指明的专用 IP 地址三个专用 IP 地址块：
                (1) 10.0.0.0 到 10.255.255.255
                    A类，或记为10.0.0.0&#x2F;8，它又称为 24 位块
                (2) 172.16.0.0 到 172.31.255.255
                    B类，或记为172.16.0.0&#x2F;12，它又称为 20 位块
                (3) 192.168.0.0 到 192.168.255.255
                    C类，或记为192.168.0.0&#x2F;16，它又称为 16 位块
            利用公网作为本机构各专用网(私网)之间的通信载体，这样的专用网又称为虚拟专用网VPN
                专用网
                    是为本机构的主机用于机构内部的通信，而不是用于和网络外非本机构的主机通信
        4.8.2   网络地址转换 NAT
            使用本地地址的主机在和外界通信时，将其本地地址转换成全球 IP 地址 
            两次地址转换：
                离开专用网时：替换源地址，将内部地址替换为全球地址；
                进入专用网时：替换目的地址，将全球地址替换为内部地址；
            当 NAT 路由器具有 n 个全球 IP 地址时，专用网内最多可以同时有 n 台主机接入到互联网
            通过 NAT 路由器的通信必须由专用网内的主机发起，专用网内部的主机不能充当服务器用
            网络地址与端口号转换 NAPT
                运输层的端口号也利用上，共用一个 NAT 路由器上的全球 IP 地址
                网络地址与端口号转换NAPT (Network Address and Port Translation)，不使用端口号的 NAT 就叫做传统的 NAT
    4.9  多协议标记交换 MPLS
        MPLS 并没有取代 IP，而是一种 IP 增强技术
        为了提高传统路由器IP 分组的转发效率，在 MPLS 域的入口处，给每一个 IP 数据报打上固定长度“标记”，然后对打上标记的 IP 数据报用硬件进行转发

    5.1  运输层协议概述
        5.1.1  进程之间的通信
            网络层：主机之间提供逻辑通信
            运输层：应用进程之间提供端到端的逻辑通信（ IP+端口），复用和分用。
            运输层还要对收到的报文进行差错检测。
            运输层有两种不同的运输协议，即面向连接的 TCP 和无连接的 UDP。   
        5.1.2  运输层的两个主要协议
            (1) 用户数据报协议 UDP (User Datagram Protocol)
            (2) 传输控制协议 TCP (Transmission Control  Protocol)
            UDP：无连接、不可靠、不拆包。单播、多播和广播
            TCP：面向连接、可靠、全双工。只能单播，不能广播或多播。可靠的，开销大。  
        5.1.3  运输层的端口
            UDP和TCP都使用16 位端口号
            网络层的协议类型字段类似于传输层端口号字段
            两类端口 
                (1) 服务器端使用的端口号
                    熟知端口，数值一般为 0~1023。
                    登记端口号，数值为 1024~49151，为没有熟知端口号的应用程序使用的。使用这个范围的端口号必须在 IANA 登记，以防止重复
                (2) 客户端使用的端口号
                    又称为短暂端口号，数值为 49152~65535，留给客户进程选择暂时使用。
            常用的熟知端口
                UDP
                    RPC 111
                    DNS 53
                    TFTP 69
                    SNMP 161
                    SNMP(trap) 162
                TCP
                    SMTP 25
                    FTP 21|20
                    Telent 23
                    HTTP 80
                    HTTPS 443
    5.2  用户数据报协议 UDP
        5.2.1 UDP 的主要特点 
            (1) UDP 是无连接的
            (2) UDP 使用尽最大努力交付
            (3) UDP 是面向报文的
            (4) UDP 没有拥塞控制
            (5) UDP 支持一对一、一对多、多对一和多对多的交互通信。
            (6) UDP 的首部开销小，只有 8 个字节，比 TCP 的 20 个字节的首部要短。
    5.3  传输控制协议 TCP 概述
        5.3.1  TCP 最主要的特点 
            (1) TCP 是面向连接
            (2) TCP 连接只能有两个端点，只能点对点（1对1）
            (3) TCP 是可靠交付
            (4) TCP 全双工通信
            (5) TPC 面向字节流(报文长度进程不可控)
        5.3.2  TCP 的连接 
            把连接作为最基本的抽象
            每一条 TCP 连接有两个端点
            TCP 连接的端点叫做套接字 (socket) 或插口
                端口号拼接到 (contatenated with) IP 地址即构成了套接字
            每一条 TCP 连接唯一地被通信两端的两个端点（即两个套接字）所确定
            TCP 可靠通信的具体实现 
                一个发送窗口和一个接收窗口
                用字节的序号进行控制
                两端的四个窗口经常处于动态变化之中
                使用特定的算法估算较为合理的重传时间
    5.4  可靠传输的工作原理
        5.4.1  停止等待协议
            全双工通信的双方既是发送方也是接收方。
            在发送完一个分组后，必须暂时保留已发送的分组的副本，以备重发
            分组和确认分组都必须进行编号。
            超时计时器的重传时间应当比数据在分组传输的平均往返时间更长一些
            停止等待协议的优点是简单，缺点是信道利用率太低。
        5.4.2  连续ARQ协议
            累积确认
            对按序到达的最后一个分组发送确认
            优点：容易实现，即使确认丢失也不必重传。
            缺点：不能向发送方反映出接收方已经正确收到的所有分组的信息。
            Go-back-N（回退 N） 
                表示需要再退回来重传已发送过的 N 个分组
            当通信线路质量不好时，连续 ARQ 协议会带来负面的影响
    5.5  TCP 报文段的首部格式
        TCP 报文段首部的前 20 个字节是固定的，TCP 首部的最小长度是 20 字节
        若选择较小的 MSS 长度，网络的利用率就降低
        为什么要规定 MSS ？
            只含有 1 字节的数据时
                在 IP 层传输的数据报的开销至少有 40 字节(包括 TCP 报文段的首部和 IP 数据报的首部)。这样，对网络的利用率就不会超过 1&#x2F;41
            TCP 报文段非常长
                IP 层传输时就有可能要分解成多个短数据报片。在终点要把收到的各个短数据报片装配成原来的 TCP 报文段。当传输出错时还要进行重传也都会使开销增大
            MSS 应尽可能大些，只要在 IP 层传输时不需要再分片就行，最佳的 MSS 是很难确定的
    5.6  TCP 可靠传输的实现
        5.6.1  以字节为单位的滑动窗口
            发送缓存与接收缓存的作用
                发送缓存用来暂时存放：
                    发送应用程序传送给发送方 TCP 准备发送的数据；
                    TCP 已发送出但尚未收到确认的数据。
                接收缓存用来暂时存放：
                    按序到达的、但尚未被接收应用程序读取的数据；
                    不按序到达的数据。 
            1. A 的发送窗口并不总是和 B 的接收窗口一样大（因为有一定的时间滞后）
            2. 第二，TCP 标准没有规定对不按序到达的数据应如何处理。
            3. TCP 要求接收方必须有累积确认的功能
            接收方可以在合适的时候发送确认，也可以在自己有数据要发送时把确认信息顺便捎带上
        5.6.2  超时重传时间的选择
            加权平均往返时间
                保留了 RTT 的一个加权平均往返时间 RTTS（这又称为平滑的往返时间）
                RFC 2988 推荐的 a 值为 1&#x2F;8，即 0.125
            超时重传时间 RTO
                RTO (Retransmission Time-Out) 应略大于上面得出的加权平均往返时间 RTTS。
                RTTD：是 RTT 的偏差的加权平均值
            Karn 算法
                新的问题：超时重传时间就无法更新
                修正的 Karn 算法
                    报文段每重传一次，就把 RTO 增大一些
                        新的 RTO &#x3D; y X (旧的 RTO)
                        系数 y 的典型值是 2
        5.6.3  选择确认 SACK
            解决的问题：若收到的报文段无差错，只是未按序号，中间还缺少一些序号的数据，那么能否设法只传送缺少的数据而不重传已经正确到达接收方的数据
                答案是可以的。选择确认 SACK  (Selective ACK) 就是一种可行的处理方法
            每一个字节块都有两个边界：左边界和右边界
    5.7  TCP 的流量控制
        5.7.1  利用滑动窗口实现流量控制
            方法：利用滑动窗口机制
            报文段在传送过程中丢失，发送方和接收方在相互等待，可能会造成互相等待的死锁，因此TCP 为每一个连接设有一个持续计时器 (persistence timer)
                持续计时器：
                    只要 TCP 连接的一方收到对方的零窗口通知，就启动该持续计时器
        5.7.2  必须考虑传输效率
            用不同的机制来控制 TCP 报文段的发送时机
                第一种机制是 TCP 维持一个变量，它等于最大报文段长度 MSS。只要缓存中存放的数据达到 MSS 字节时，就组装成一个 TCP 报文段发送出去
                第二种机制是由发送方的应用进程指明要求发送报文段，即 TCP 支持的推送 (push)操作
                第三种机制是发送方的一个计时器期限到了，这时就把当前已有的缓存数据装入报文段（但长度不能超过 MSS）发送出去    
    5.8  TCP 的拥塞控制
        5.8.1  拥塞控制的一般原理
            出现拥塞的原因：资源需求&gt;可用资源
                拥塞控制是动态的、
                分组的丢失是征兆，不是原因
            开环控制和闭环控制
                开环控制：在设计网络时事先考虑周到
                闭环控制：基于反馈环路：
                    检测何时何地发生
                    传送到可采取行动的地方
                    调整网络系统的运行
        5.8.2  TCP 的拥塞控制方法
            采用基于窗口的方法，TCP发送方维持一个拥塞窗口 CWND (Congestion Window)
            拥塞的判断
                重传定时器超时
                收到三个相同（重复）的 ACK
            TCP拥塞控制算法
                慢开始 (slow-start)
                    思路：由小到大逐渐增大拥塞窗口数值
                    拥塞窗口 cwnd  控制方法：在每收到一个对新的报文段的确认后，可以把拥塞窗口增加最多一个 SMSS 的数值
                    传输轮次 
                        拥塞窗口 cwnd 就加倍
                        所经历的时间就是往返时间 RTT
                    设置慢开始门限状态变量 ssthresh
                        当 cwnd &lt; ssthresh 时，使用慢开始算法。
                        当 cwnd &gt; ssthresh 时，停止使用慢开始算法而改用拥塞避免算法。
                        当 cwnd &#x3D; ssthresh 时，既可使用慢开始算法，也可使用拥塞避免算法。
                拥塞避免 (congestion avoidance)
                    思路：让拥塞窗口 cwnd 缓慢地增大，使拥塞窗口 cwnd 按线性规律缓慢增长
                        因此在拥塞避免阶段就有“加法增大”
                    当网络出现拥塞时（重传定时器超时）
                        发送方判断网络出现拥塞（重传定时器超时）：
                            ssthresh &#x3D; max(cwnd&#x2F;2，2)
                            cwnd &#x3D; 1
                            执行慢开始算法
                    非指完全能够避免了拥塞，而是使网络比较不容易出现拥塞
                    
                快重传 (fast retransmit)
                    尽早知道发生了个别报文段的丢失
                    发送方只要一连收到三个重复确认，就知道接收方确实没有收到报文段，因而应当立即进行重传（即“快重传”）
                快恢复 (fast recovery)
                    (1) 慢开始门限ssthresh&#x3D;当前拥塞窗口cwnd&#x2F;2 ；
                    (2) 新拥塞窗口 cwnd &#x3D; 慢开始门限 ssthresh ；
                    (3) 开始执行拥塞避免算法，使拥塞窗口缓慢地线性增大。 
                加法增大,乘法减小(AIMD)
        5.8.3  主动队列管理 AQM
            网络层对TCP拥塞控制影响最大的是路由器的分组丢弃策略
            路由器的队列
                “先进先出”FIFO 
                当队列已满时，尾部丢弃策略
                全局同步 (global syncronization)
                    很多TCP连接中的报文段服用在网络层IP数据报中，这时发生尾部丢弃，使这许多 TCP 连接在同一时间突然都进入到慢开始状态
                主动队列管理AQM
                    应当在队列长度达到某个值得警惕的数值时（即当网络拥塞有了某些拥塞征兆时），就主动丢弃到达的分组
                    随机早期检测 RED (Random Early Detection)
                        若平均队列长度小于最小门限 THmin，则将新到达的分组放入队列进行排队
                        若平均队列长度超过最大门限 THmax，则将新到达的分组丢弃
                        若平均队列长度在最小门限 THmin 和最大门限THmax 之间，则按照某一概率 p 将新到达的分组丢弃
                        RED 的使用效果并不太理想
                        AQM 实际上就是对路由器中的分组排队进行智能管理，而不是简单地把队列的尾部丢弃
    5.9  TCP 的运输连接管理
        TCP运输的三个阶段
            连接建立
            数据传送
            连接释放
        运输连接的管理
            使运输连接的建立和释放都能正常地进行
        TCP连接的建立采用客户服务器方式
            客户：主动发起连接建立的应用进程
            服务器：被动等待连接建立的应用进程
        5.9.1  TCP 的连接建立
            握手:TCP建立连接的过程
                三报文握手：客户和服务器之间交换三个 TCP 报文段
                    主要是为了防止已失效的连接请求报文段突然又传送到了，因而产生错误
        5.9.2  TCP 的连接释放
            四报文握手：TCP 连接释放过程
            TCP 连接处于半关闭状态
            必须等待 2MSL 的时间
                第一，为了保证 A 发送的最后一个 ACK 报文段能够到达 B
                第二，防止 “已失效的连接请求报文段”出现在本连接中。
        5.9.3  TCP 的有限状态机
            粗实线箭头表示对客户进程的正常变迁。
            粗虚线箭头表示对服务器进程的正常变迁。
            细线箭头表示异常变迁。

1.浏览器输入一个网址，每层用到哪些协议，其作用是什么
    应用层：HTTP:WWW访问协议，DNS:域名解析服务
    传输层：TCP:为HTTP提供可靠的数据传输，UDP：DNS使用UDP传输
    网络层：IP:IP包传输和路由选择，ICMP：提供网络传输中的差错检测，ARP：将本机的默认网关IP地址映射城物理MAC地址
</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">3.</span> <span class="nav-text">

数据链路层使用的信道主要有以下两种类型：
    点对点信道:
        这种信道使用一对一的点对点通信方式
    广播信道:
        这种信道使用一对多的广播通信方式，因此过程比较复杂
    链路 (link)（物理链路） :
        是一条无源的点到点的物理线路段，中间没有任何其他的交换结点
    数据链路 (data link)（逻辑链路）:
        把实现协议的硬件和软件加到链路上
    通信规程：早期的数据通信协议
    三个基本问题：
        1. 封装成帧：在一段数据的前后分别添加首部和尾部，进行帧定界（可以使用帧定界符）
        2. 透明传输：字节填充 (byte stuffing) 或字符填充 (character stuffing)，插入一个转义字符“ESC”
        3. 差错控制 ：比特差错：1 可能会变成 0 而 0 也可能变成 1。
            误码率：在一段时间内，传输错误的比特占所传输比特总数的比率
    循环冗余检验 CRC 的检错技术：
        在数据链路层传送的帧中，广泛使用
        冗余码 帧检验序列 FCS (Frame Check Sequence)：
 
        (1) 若得出的余数 R &#x3D; 0，则判定这个帧没有差错，就接受 (accept)。
        (2) 若余数 R  0，则判定这个帧有差错，就丢弃。
        只能做到无差错接受 (accept)
        (要做到“可靠传输”（即发送什么就收到什么）就必须再加上确认和重传机制。)
        “无比特差错”与“无传输差错”是不同的概念。
    点对点协议 PPP (Point-to-Point Protocol):
        首要的要求:简单
        PPP 是面向字节的，所有的 PPP 帧的长度都是整数字节。
        同步传输链路时，协议规定采用硬件来完成比特填充（和 HDLC 的做法一样）：
            在使用SONET&#x2F;SDH链路时，使用同步传输， PPP 协议采用零比特填充方法来实现透明传输
        用在异步传输时，就使用一种特殊的字符填充法
    广播信道：
        静态划分信道：
            频分复用
            时分复用
            波分复用
            码分复用
        动态媒体接入控制（多点接入）
        DIX Ethernet V2 是世界上第一个局域网产品（以太网）的规约
        IEEE 802.3 是第一个 IEEE 的以太网标准。
        通信适配器 (adapter) &#x2F; 网络接口卡 NIC (Network Interface Card) &#x2F; 网卡：网络接口板：
            重要功能：
                进行串行&#x2F;并行转换。
                对数据进行缓存。
                在计算机的操作系统安装设备驱动程序。
                实现以太网协议。
        CSMA&#x2F;CD协议：
            含义：载波监听 多点接入 &#x2F; 碰撞检测
                “多点接入”    多点共线
                “载波监听”    先听后讲
                “碰撞检测”    边讲边听
            重要特性：
                只能半双工通信
                碰撞
            争用期 &#x2F; 碰撞窗口：
                定义： 时间 2t（两倍的端到端往返时延）就可知道发送的数据帧是否遭受了碰撞
                长度：10 Mbit&#x2F;s 以太网取 51.2 us 为争用期的长度
                发生碰撞的站在停止发送数据后，要推迟（退避）一个随机时间才能再发送数据
                从整数集合 [0, 1, … , (2k 1)] 中随机地取出一个数，记为 r。重传所需的时延就是 r 倍的基本退避时间
                    k &#x3D; Min[重传次数, 10]
                传达 16 次仍不能成功时即丢弃该帧，并向高层报告
                强化碰撞：
                    (1) 立即停止发送数据；
                    (2) 再继续发送32&#x2F;48比特的人为干扰信号,以便让所有节点都知道现在已经发生了碰撞。
            要点：1）准备发送
                 2）检测信道
                 3）检查碰撞 ：
                    两种可能性：发送成功 发送失败
            以太网采取了两种重要的措施：
                采用较为灵活的无连接的工作方式
                以太网发送的数据都使用曼彻斯特
        3.3.3集线器：
            1990 年，IEEE 制定出星形以太网 10BASE-T 的标准 802.3i
            每个站到集线器的距离不超过 100 m
            特点：
                集线器以太网逻辑上仍是总线网，仍使用 CSMA&#x2F;CD 协议
                集线器工作在物理层，仅简单转发。
        3.3.4以太网的信道利用率：
                成功发送一个帧需要占用信道的时间是 T0 + T
                对以太网参数 α 的要求是：
                    当数据率一定时，以太网的连线的长度受到限制，否则 T 的数值会太大。
                    以太网的帧长不能太短，否则 T0 的值会太小，使 α 值太大。
                信道利用率的最大值 Smax ：
                    理想化的情况下
        3.3.5以太网的 MAC 层：
            硬件地址 &#x2F; 物理地址 &#x2F; MAC地址
                每个网卡有一个MAC地址
            必须保证生产出的适配器没有重复地址
            I&#x2F;G（ Individual &#x2F; Group）第一字节的最低位：
                当 I&#x2F;G位 &#x3D; 0 时，地址字段表示一个单站地址
                当 I&#x2F;G位 &#x3D; 1 时，表示组地址，用来进行多播
            G&#x2F;L（Global &#x2F; Local）
                当 G&#x2F;L位 &#x3D; 0 时，是全球管理
                当 G&#x2F;L位 &#x3D; 1 时，是本地管理
            适配器检查 MAC 地址：
                如果是发往本站的帧则收下，然后再进行其他的处理。
                否则就将此帧丢弃，不再进行其他的处理。
                发往本站的帧：
                    单播 (unicast) 帧（一对一）
                    广播 (broadcast) 帧（一对全体）
                    多播 (multicast) 帧（一对多）
                所有的适配器都至少能够识别单播地址和广播地址。
                只有目的地址才能使用广播地址和多播地址
                以混杂方式 (promiscuous mode) 工作的以太网适配器只要“听到”有帧在以太网上传输就都接收下来。
            以太网 V2 MAC 帧的格式：
                标准：DIX Ethernet V2 标准和IEEE 的 802.3 标准
                    最常用的 MAC 帧是以太网 V2 的格式
                数据字段的正式名称是 MAC 客户数据字段
                当数据字段的长度小于 46 字节时,应在数据字段的后面加入整数字节的填充字段，以保证以太网的 MAC 帧长不小于 64 字节。
                无效的 MAC 帧:
                    数据字段的长度与长度字段的值不一致
            IEEE 802.3 MAC 帧格式:
                与V2的区别：第三个字段是“长度 &#x2F; 类型”
            帧间最小间隔：
                9.6us,为了使站的接收缓存来得及清理
    3.4 拓展的以太网：
        3.4.1 在物理层的扩展：
            使用光纤扩展
            使用集线器扩展：
                优点：使原来属于不同碰撞域的以太网上的计算机能够进行跨碰撞域的通信。
                      扩大了以太网覆盖的地理范围。
                缺点：碰撞域增大了，但总的吞吐量并未提高。
                      如果不同的碰撞域使用不同的数据率，那么就不能用集线器将它们互连起来。
        3.4.2 在数据链路层扩展：
            早期使用网桥，现在使用以太网交换机：
                网桥工作：根据 MAC 帧的目的地址对收到的帧进行转发和过滤
            交换式集线器淘汰了网桥：
                常称为以太网交换机 或二层交换机
            以太网交换机：
                特点：
                    以太网交换机是多接口的网桥
                    工作在全双工方式
                    具有并行性：
                        能同时连通多对接口，使多对主机能同时通信
                    相互通信的主机都是独占传输媒体，无碰撞地传输数据
                    接口有存储器
                    即插即用，地址表自学习
                交换方式：
                    存储转发方式
                        把整个数据帧先缓存后再进行处理
                    直通 (cut-through) 方式
                        接收同时就立即按数据帧的目的 MAC 地址
                        缺点：有可能也将一些无效帧转发给其他的站
                自学习功能：
                    交换表一开始是空的
                    先查找交换表，没有查到应从哪个接口转发这个帧
                    把这个帧的源地址 A 和接口 1 写入交换表中，并向除接口1以外的所有的接口广播这个帧
                    过滤：C 和 D 将丢弃这个帧，因为目的地址不对。只 B 才收下这个目的地址正确的帧
                    在交换表中每个项目都设有一定的有效时间。过期的项目就自动被删除
                    交换机自学习和转发帧的步骤归纳：
                        先进行自学习，查找表中有无相匹配的源地址的项目：
                            如没有，就在交换表中增加一个项目（源地址、进入的接口和有效时间）。
                            如有，则把原有的项目进行更新（进入的接口或有效时间）
                        转发帧，查找表中有无相匹配的源地址的项目：
                            如没有，则向所有其他接口（进入的接口除外）转发。
                            如有，则按交换表中给出的接口进行转发。
                            若交换表中给出的接口就是该帧进入交换机的接口，则应丢弃这个帧（因为这时不需要经过交换机进行转发）
                    增加冗余链路时，自学习的过程就可能导致以太网帧在网络的某个环路中无限制地兜圈子
                    交换以太网不使用共享总线
                    没有碰撞问题，不使用 CSMA&#x2F;CD 协议，以全双工方式工作。但仍采用以太网的帧结构。
        3.4.3 虚拟局域网
            虚拟局域网 VLAN 是一种逻辑划分
            同VLAN小组成员收到广播信息，其他VLAN接受不到
            有利于防止：广播风暴
            VLAN 标记 (tag)：帧格式中插入一个4字节的标识符，用来指明发送该帧的计算机（接口）属于哪一个虚拟局域网
            插入 VLAN 标记得出的帧称：802.1Q 帧 或 带标记的以太网帧。
        3.5.1 100BASE-T 以太网 &#x2F; 快速以太网(Fast Ethernet)
            代号：IEEE 802.3u
            高速以太网：速率达到或超过 100 Mbit&#x2F;s 的以太网
            特点：在全双工方式下工作时，不使用 CSMA&#x2F;CD 协议
                 MAC 帧格式仍然是 802.3 标准规定的
                 保持最短帧长不变，但将一个网段的最大电缆长度减小到 100 m
                 帧间时间间隔从原来的 9.6 s 改为现在的 0.96 us
        3.5.2 吉比特以太网
            在半双工方式下使用 CSMA&#x2F;CD 协议，全双工方式不使用 CSMA&#x2F;CD 协议
            使用两种成熟的技术：一种来自现有的以太网，另一种则是美国国家标准协会 ANSI 制定的光纤通道 FC  (Fiber Channel)
            半双工方式工作的吉比特以太网
                为保持 64 字节最小帧长度，以及 100 米的网段的最大长度，吉比特以太网增加了两个功能：
                    载波延伸 (carrier extension)
                        将争用时间增大为 512 字节
                    分组突发 (packet bursting)
            全双工方式工作的吉比特以太网
                不使用载波延伸和分组突发
            10 吉比特以太网和更快的以太网
                只工作在全双工方式
            端到端的以太网传输
                实现了端到端的以太网传输的好处：
                    技术成熟；
                    互操作性很好；
                    在广域网中使用以太网时价格便宜；
                    采用统一的以太网帧格式，简化了操作和管理
        3.5.3 以太网从 10 Mbit&#x2F;s 到100 Gbit&#x2F;s 的演进证明：
            可扩展的（从 10 Mbit&#x2F;s 到 100 Gbit&#x2F;s）；
            灵活的（多种传输媒体、全&#x2F;半双工、共享&#x2F;交换）；
            易于安装；
            稳健性好。
        3.5.4 使用以太网进行宽带接入
            特点：
                可以提供双向的宽带通信。
                可以根据用户对带宽的需求灵活地进行带宽升级。
                可以实现端到端的以太网传输，中间不需要再进行帧格式的转换。这就提高了数据的传输效率且降低了传输的成本。
                但是不支持用户身份鉴别。
            PPPoE (PPP over Ethernet)
                在以太网上运行 PPP，把 PPP 协议与以太网协议结合起来 —— 将 PPP 帧再封装到以太网中来传输

    4.1  网络层提供的两种服务 
        面向连接 无连接 
        争论的实质是：可靠交付是网络负责，还是端系统负责。
        结论： “无连接”赢了
        让网络负责可靠交付：
            使用面向连接的通信方式
            先建立虚电路 (Virtual Circuit)
                虚电路是逻辑连接
                分组按照存储转发方式传送
                电路交换的电话通信是先建立了一条真正的连接
        网络提供数据报服务：
            网络层向上只提供简单灵活的、无连接的、尽最大努力交付的数据报服务
            网络层不提供服务质量的承诺
            尽最大努力交付：
                传输网络不提供端到端的可靠传输服务
                主机中的运输层负责可靠交付（包括差错处理、流量控制等）
    4.2 网际协议 IP
        地址解析协议 ARP(Address Resolution Protocol)
        网际控制报文协议 ICMP(Internet Control Message Protocol)
        网际组管理协议 IGMP(Internet Group Management Protocol)
        4.2.1 虚拟网络互联
            中间设备 &#x2F; 中间系统 &#x2F; 中继系统
                物理层中继系统：集线器 (repeater)。
                数据链路层中继系统：网桥 或 交换机。
                网络层中继系统：路由器 (router)。
                网桥和路由器的混合物：桥路器 (brouter)，二三层。
                网络层以上的中继系统：网关 (gateway)。  
            网络互联：
                中继系统是转发器或者网桥时，不称为网络互联，仍然是一个网络
                网络互连都是指用路由器进行网络互连和路由选择
                路由器称为网关
            虚拟网络互联
                虚拟互连网络也就是逻辑互连网络，
                利用 IP 协议就可以使这些性能各异的网络从用户看起来好像是一个统一的网络
                IP网：使用 IP 协议的虚拟互连网络
                好处：当互联网上的主机进行通信时，就好像在一个网络上通信一样，而看不见互连的各具体的网络异构细节。
                如果在这种覆盖全球的 IP 网的上层使用 TCP 协议，那么就是现在的互联网 (Internet)。
        4.2.2 分类的IP地址
            唯一的 32 位的标识符
            IP 地址现在由互联网名字和数字分配机构ICANN 进行分配
            IP地址的编址方法：
                1.分类的IP地址
                    公网 IP 地址在整个互联网范围内是唯一的。
                    私网 IP 地址在整个私网范围内是唯一的。
                    2进制开头 地址的网络号字段 主机号字段 每个网络最大主机数
                        A 0 8 24 2^24-2
                        B 10 16 16 2^16-2
                        C 110 24 8 2^8-2
                        D 1110 多播地址
                        E 1111 保留为今后使用
                    特殊的 IP 地址 全0 &#x2F; 1
                    重要特点：
                        (1) IP 地址是一种分等级的地址结构
                        (2) 实际上 IP 地址是标志一个主机（或路由器）和一条链路的接口
                            多归属主机:具有两个IP地址，和不通的网络号
                        (3) 用转发器或网桥连接起来的若干个局域网仍为一个网络，因此这些局域网都（？一般）具有同样的网络号 net-id。网络号不同必须使用路由器连接
                        (4) 所有分配到网络号 net-id 的网络，都是平等的


            2.子网的划分
            3.构成超网
    4.2.3 IP 地址与硬件地址
        硬件地址（或物理地址）是数据链路层和物理层使用的地址
        IP 地址是网络层和以上各层使用的地址，是一种逻辑地址
            称 IP 地址是逻辑地址是因为 IP 地址是用软件实现的
        两个路由器的 IP 地址并不出现在 IP 数据报的首部中
    4.2.4 地址解析协议 ARP
        通信时使用了两个地址：IP 地址（网络层地址） MAC 地址（数据链路层地址）
        作用：已知IP地址，求硬件地址
        实际网络传送数据必须使用硬件地址
        每一个主机都设有一个ARP高速缓存，有IP地址到硬件地址的映射表
        当主机 A 欲向本局域网上的某个主机 B 发送 IP 数据报时：
            如有，就可查出其对应的硬件地址，再将此硬件地址写入 MAC 帧，并发送
            如没有， 本局域网广播一个 ARP 请求分组。收到 ARP 响应分组后，将得到的 IP 地址到硬件地址的映射写入 ARP 高速缓存。组MAC帧发送
        要点：
            ARP请求分组：包含发送方硬件地址 &#x2F; 发送方 IP 地址 &#x2F; 0 &#x2F; 目标方 IP 地址。
            本地广播 ARP 请求（路由器不转发ARP请求）。
            ARP 响应分组：发送方硬件地址 &#x2F; 发送方 IP地址 &#x2F; 目标方硬件地址 &#x2F; 目标方 IP 地址。
            ARP 分组封装在物理网络的帧中传输。
            抓包
        ARP 高速缓存的作用
            存放最近获得的 IP 地址到 MAC 地址的绑定，以减少 ARP 广播的数量。
            减少网络上的通信量
            主机 B (所有主机)收到 A 的 ARP 请求分组时，就将主机 A 的这一地址映射写入主机 B 自己的 ARP 高速缓存中。这对主机 B 以后向 A 发送数据报时就更方便了
    4.2.5 IP 数据报的格式
        由首部和数据两部分组成
            首部的前一部分是固定长度，共 20 字节
        IP首部长度占4位，可表示的最大数值是 15 个单位(一个单位为 4 字节)IP 的首部长度的最大值是 60 字节
        区分服务：占8位，实际上一直未被使用，一般情况下都不使用这个字段
        总长度：占16位，数据报最大长度为2^16-1字节
        原始数据报首部被复制为各数据报片的首部，但必须修改有关字段的值
        IP 数据报首部的可变部分
            从 1 个字节到 40 个字节不等
    4.2.6 IP 层转发分组的流程
        路由器分组转发算法 
            (1) 从数据报的首部提取目的主机的 IP 地址 D, 得出目的网络地址为 N。
            (2) 若网络 N 与此路由器直接相连，则把数据报直接交付目的主机 D；否则是间接交付，执行 (3)。
            (3) 若路由表中有目的地址为 D 的特定主机路由，则把数据报传送给路由表中所指明的下一跳路由器；否则，执行 (4)。
            (4) 若路由表中有到达网络 N 的路由，则把数据报传送给路由表指明的下一跳路由器；否则，执行 (5)。
            (5) 若路由表中有一个默认路由，则把数据报传送给路由表中所指明的默认路由器；否则，执行 (6)。
            (6)  报告转发分组出错。 
4.3 划分子网和构造超网
    4.3.1   划分子网
        基本思路
            划分子网纯属一个单位内部的事情
            从主机号借用若干个位作为子网号 subnet-id
        子网的掩码
            从一个 IP 数据报的首部并无法判断是否进行了子网划分
            使用子网掩码 (subnet mask) 可以找出 IP 地址中的子网部分
            规则
                子网掩码长度 ＝ 32 位
                某位 ＝ 1：IP地址中的对应位为网络号和子网号
                某位 ＝ 0：IP地址中的对应位为主机号  
        子网划分方法
            文档规定不能为全 1 或全 0，现在全 1 和全 0 的子网号也可以使用了
            划分子网增加了灵活性，但却减少了能够连接在网络上的主机总数。


                子网数：192&#x3D;128+64(n&#x3D;2)
                       2^n-2:子网数
                子网主机数：2^(16-n)-2
        4.3.2  在划分子网情况下路由器转发分组的算法 
            (1) 从收到的分组的首部提取目的 IP 地址 D。
            (2) 先用各网络的子网掩码和 D 逐位相“与”，看是否和相应的网
                络地址匹配。若匹配，则将分组直接交付。否则就是间接交付，
                执行 (3)。
            (3) 若路由表中有目的地址为 D 的特定主机路由，则将分组传送给
                指明的下一跳路由器；否则，执行 (4)。
            (4) 对路由表中的每一行，将子网掩码和 D 逐位相“与”。若结果与该行的目的网络地址匹配，则将分组传送给该行指明的下一跳路由器；否则，执行 (5)。
            (5) 若路由表中有一个默认路由，则将分组传送给路由表中所指明
                的默认路由器；否则，执行 (6)。
            (6) 报告转发分组出错。
            【例4-4】已知互联网和路由器 R1 中的路由表。主机 H1 向 H2 发送分组。试讨论 R1 收到 H1 向 H2 发送的分组后查找路由表的过程。
            ppt 475
        4.3.3  无分类编址 CIDR
            变长子网掩码 VLSM (Variable Length Subnet Mask) &#x2F; 无分类域间路由选择 CIDR (Classless Inter-Domain Routing)
            特点：
                消除了传统的 A 类、B 类和 C 类地址以及划分子网的概念
                使用各种长度的“网络前缀”(network-prefix)
                斜线记法”(slash notation) &#x2F; CIDR 记法
            CIDR地址块：
                128.14.32.0&#x2F;20 表示的地址块共有 2^12（4*8-20） 个地址（因为斜线后面的 20 是网络前缀的位数，所以这个地址的主机号是 12 位）。
                    这个地址块的起始地址是 128.14.32.0。
                    在不需要指出地址块的起始地址时，也可将这样的地址块简称为“&#x2F;20 地址块”。
                    128.14.32.0&#x2F;20 地址块的最小地址：128.14.32.0
                    128.14.32.0&#x2F;20 地址块的最大地址：128.14.47.255
                    全 0 和全 1 的主机号地址一般不使用。
                路由聚合：
                    一个 CIDR 地址块可以表示很多地址
                    有利于减少路由器之间的路由选择信息的交换，从而提高了整个互联网的性能有利于减少路由器之间的路由选择信息的交换，从而提高了整个互联网的性能
                    路由聚合也称为构成超网 (supernetting)
                    仍然使用“掩码”
                    对于 &#x2F;20  地址块，它的掩码是 20 个连续的 1。 斜线记法中的数字就是掩码中1的个数
                    10.0.0.0&#x2F;10 可简写为 10&#x2F;10
                    10.0.0.0 的掩码是 255.192.0.0
                    星号 * ：
                        在星号 * 之前是网络前缀，而星号 * 表示 IP 地址中的主机号，可以是任意值
                    最长前缀匹配 (longest-prefix matching) &#x2F;最长匹配或最佳匹配
                        选择两个匹配的地址中更具体的一个，即选择最长前缀的地址
    4.4  网际控制报文协议 ICMP
            有效地转发 IP 数据报和提高交付成功
            ICMP 询问报文有两种 
                回送请求和回答报文
                时间戳请求和回答报文
            4.4.2  ICMP 的应用举例
                PING 用来测试两个主机之间的连通性,使用了 ICMP 回送请求与回送回答报文
                Tracerout 用来跟踪一个分组从源点到终点的路径
    4.5  互联网的路由选择协议
        4.5.1  有关路由选择协议的几个基本概念
                内部网关协议 IGP (Interior Gateway Protocol)
                    自治系统内部使用
                外部网关协议 EGP (External Gateway Protocol)    
                    不同的自治系统之间传路由选择信息
        4.5.2  内部网关协议 RIP
            分布式的、基于距离向量的路由选择协议
            要求网络中的每一个路由器都要维护从它自己到其他每一个目的网络的距离记录
            距离 &#x2F; 跳数 &#x2F; 最短距离：
                从一个路由器到直接连接的网络的距离定义为 1
                每经过一个路由器，跳数就加 1
                一个好的路由，距离短
                一条路径最多只能包含 15 个路由器，“距离”的最大值为 16 时即相当于不可达
                RIP 不能在两个网络之间同时使用多条路由
            三个特点：
                仅和相邻路由器交换信息
                交换的信息是当前本路由器所知道的全部信息，即自己的路由表
                按固定的时间间隔交换路由信息
            路由表的建立
                刚刚开始工作，路由表是空的
                收敛 (convergence) 过程较快    
                距离向量算法
                    路由器收到相邻路由器（其地址为 X）的一个 RIP 报文：
                    (1) 先修改此 RIP 报文中的所有项目：把“下一跳”字段中的地址都改为 X，并把所有的“距离”字段的值加 1。
                    (2) 对修改后的 RIP 报文中的每一个项目，重复以下步骤：
                        若项目中的目的网络不在路由表中，则把该项目加到路由表中。
                        否则若下一跳字段给出的路由器地址是同样的，则把收到的项目替换原路由表中的项目。
                        否则若收到项目中的距离小于路由表中的距离，则进行更新，否则，什么也不做。
                    (3) 若 3 分钟还没有收到相邻路由器的更新路由表，则把此相邻路由器记为不可达路由器，即将距离置为 16（表示不可达）。
                    (4) 返回。
                    
            协议特点：好消息传播得快，坏消息传播得慢。
            RIP 存在的一个问题：当网络出现故障时，要经过比较长的时间 (例如数分钟) 才能将此信息传送到所有的路由器。
            优点：实现简单，开销较小。
            缺点：RIP 限制了网络的规模，它能使用的最大距离为 15（16 表示不可达）。
            路由器之间交换的是完整路由表，因而网络规模越大，开销就越大。 
            “坏消息传播得慢”，使更新过程的收敛时间过长。
        4.5.3  内部网关协议 OSPF 开放最短路径优先 OSPF (Open Shortest Path First)
            “开放”表明 OSPF 不受某一厂商控制，而是公开的
            “最短路径优先”是因为使用了 Dijkstra 提出的最短路径算法 SPF
            要点：只有链路状态发生变化，才用IP 数据报和洪泛法发送链路状态（度量） 
            三个要点
                向本自治系统中所有路由器发送信息，洪泛法
                发送的信息就是与本路由器相邻的所有路由器的链路状态，但这只是路由器所知道的部分信息。
                只有当链路状态变化时，路由器才用洪泛法向所有路由器发送此信息
            链路状态数据库 (link-state database) 
                由所有的路由器最终建立
                全网的拓扑结构图，它在全网范围内是一致的
                OSPF 的链路状态数据库能较快地进行更新
            其他特点：
                OSPF 对于不同类型的业务可计算出不同的路由
                多路径间的负载平衡：到同一个目的网络有多条相同代价的路径，那么可以将通信量分配给这几条路径
                所有在 OSPF 路由器之间交换的分组都具有鉴别的功能
                支持可变长度的子网划分和无分类编址 CIDR
        4.5.4  外部网关协议 BGP
            不同自治系统的路由器之间交换路由信息的协议
            只是力求寻找一条能够到达目的网络且比较好的路由（不能兜圈子），而并非要寻找一条最佳路由
            先建立 TCP 连接
            特点：
                自治系统数的量级
                BGP 支持 CIDR
                更新有变化的部分。这样做对节省网络带宽和减少路由器的处理开销都有好处。 
        4.5.5  路由器的构成
            “转发”和“路由选择”的区别 
                转发：路由器根据转发表将用户的 IP 数据报从合适的端口转发出去
                路由选择：按照分布式算法，根据从各相邻路由器得到的关于网络拓扑的变化情况，动态地改变所选择的路由
            分组丢弃：
                路由器中的输入或输出队列产生溢出是造成分组丢失的重要原因
    4.6  IPv6
        4.6.1  IPv6 的基本首部
            主要变化：
                更大的地址空间。从 IPv4 的 32 位 增大到128 位。 
                扩展的地址层次结构。 
                灵活的首部格式。 定义了许多可选的扩展首部。
                改进的选项。 允许数据报包含有选项的控制信息
                允许协议继续扩充。 
                支持即插即用（即自动配置）。不需要 DHCP。
                支持资源的预分配。  支持特定带宽和时延的应用。
                IPv6 首部 8 字节对齐。 IPv4 首部是 4 字节对齐。          
            数据报：
                由基本首部（40个字节）有效载荷（不超过65535）两大部分组成
                对首部的更改：
                    取消了首部长度字段，因为首部长度是固定的 40 字节；
                    取消了服务类型字段；
                    取消了总长度字段，改用有效载荷长度字段；
                    把 TTL 字段改称为跳数限制字段；
                    取消了协议字段，改用下一个首部字段；
                    取消了检验和字段；
                    取消了选项字段，而用扩展首部来实现选项功能。
            拓展首部
                IPv6 把原来 IPv4 首部中选项的功能都放在扩展首部中，大大提高了路由器的处理效率
                六种扩展首部：  
                    (1) 逐跳选项
                    (2) 路由选择
                    (3) 分片
                    (4) 鉴别
                    (5) 封装安全有效载荷
                    (6) 目的站选项 
        4.6.2  IPv6 的地址
            (1) 单播 (unicast)：传统的点对点通信。
            (2) 多播 (multicast)：一点对多点的通信。
            (3) 任播 (anycast)：这是 IPv6 增加的一种类型。任播的目的站是一组计算机，但数据报在交付时只交付其中的一个，通常是距离最近的一个。 
            冒号十六进制记法
                零压缩
                    即一连串连续的零可以为一对冒号所取代
                    注意：在任一地址中只能使用一次零压缩。
                    CIDR 的斜线表示法仍然可用。
                    例如：60 位的前缀 12AB00000000CD3 可记为：
                    12AB:0000:0000:CD30:0000:0000:0000:0000&#x2F;60
                    或 12AB::CD30:0:0:0:0&#x2F;60 （零压缩）
                    或 12AB:0:0:CD30::&#x2F;60 （零压缩）
        4.6.3  从 IPv4 向 IPv6 过渡
                只能采用逐步演进的办法，使新安装的 IPv6 系统能够向后兼容
                两种向 IPv6 过渡的策略：
                    使用双协议栈
                    使用隧道技术
                双协议栈
                    使一部分主机（或路由器）装有两个协议栈，一个 IPv4 和一个 IPv6
                    同时具有两种 IP 地址：一个 IPv6 地址和一个 IPv4 地址
                隧道技术
                    在 IPv6 数据报要进入 IPv4 网络时，把 IPv6 数据报封装成为 IPv4 数据报
        4.6.4  ICMPv6
            IPv6 也不保证数据报的可靠交付（IPv4也不可靠交付）
            地址解析协议 ARP 和网际组管理协议 IGMP 协议的功能都已被合并到 ICMPv6 中           
    4.7  IP 多播
        4.7.1  IP 多播的基本概念
            IP 多播 (multicast，以前曾译为组播)，一对多通信
                在互联网上进行多播就叫做 IP 多播。
                互联网范围的多播要靠路由器来实现。
                多播数据报的目的地址是多播 IP 地址。
                多播IP 地址是 D 类地址。
                多播地址只能用于目的地址，不能用于源地址
            多播数据报
                使用网际组管理协议 IGMP
                多播数据报也是“尽最大努力交付”。
                对多播数据报不产生 ICMP 差错报文。
        4.7.2  在局域网上进行硬件多播 
            IANA 拥有的以太网地址块的高 24 位为 00-00-5E
            TCP&#x2F;IP 协议使用的以太网多播地址块的范围
                    从   01-00-5E-00-00-00 
                    到   01-00-5E-7F-FF-FF 
            D 类 IP 地址可供分配的有 28 位，前 5 位不能用来构成以太网硬件地址
            由于多播 IP 地址与以太网硬件地址的映射关系不是唯一的，因此收到多播数据报的主机，还要在 IP 层利用软件进行过滤，把不是本主机要接收的数据报丢弃。
        4.7.3  网际组管理协议 IGMP和多播路由选择协议
            IP 多播需要两种协议
                网际组管理协议 IGMP (Internet Group Management Protocol)
                多播路由选择协议
            多播路由选择协议更为复杂
                动态地适应多播组成员的变化
                不能仅仅根据多播数据报中的目的地址，而是还要考虑这个多播数据报从什么地方来和要到什么地方去
                多播数据报可以由没有加入多播组的主机发出
    4.8  虚拟专用网 VPN和网络地址转换 NAT
        4.8.1  虚拟专用网 VPN (Virtual Private Network)
            本地(私网)地址
            全球(公网)地址
            专用地址只能用作本地地址
                在互联网中的所有路由器，对目的地址是专用地址的数据报不转发
            RFC 1918 指明的专用 IP 地址三个专用 IP 地址块：
                (1) 10.0.0.0 到 10.255.255.255
                    A类，或记为10.0.0.0&#x2F;8，它又称为 24 位块
                (2) 172.16.0.0 到 172.31.255.255
                    B类，或记为172.16.0.0&#x2F;12，它又称为 20 位块
                (3) 192.168.0.0 到 192.168.255.255
                    C类，或记为192.168.0.0&#x2F;16，它又称为 16 位块
            利用公网作为本机构各专用网(私网)之间的通信载体，这样的专用网又称为虚拟专用网VPN
                专用网
                    是为本机构的主机用于机构内部的通信，而不是用于和网络外非本机构的主机通信
        4.8.2   网络地址转换 NAT
            使用本地地址的主机在和外界通信时，将其本地地址转换成全球 IP 地址 
            两次地址转换：
                离开专用网时：替换源地址，将内部地址替换为全球地址；
                进入专用网时：替换目的地址，将全球地址替换为内部地址；
            当 NAT 路由器具有 n 个全球 IP 地址时，专用网内最多可以同时有 n 台主机接入到互联网
            通过 NAT 路由器的通信必须由专用网内的主机发起，专用网内部的主机不能充当服务器用
            网络地址与端口号转换 NAPT
                运输层的端口号也利用上，共用一个 NAT 路由器上的全球 IP 地址
                网络地址与端口号转换NAPT (Network Address and Port Translation)，不使用端口号的 NAT 就叫做传统的 NAT
    4.9  多协议标记交换 MPLS
        MPLS 并没有取代 IP，而是一种 IP 增强技术
        为了提高传统路由器IP 分组的转发效率，在 MPLS 域的入口处，给每一个 IP 数据报打上固定长度“标记”，然后对打上标记的 IP 数据报用硬件进行转发

    5.1  运输层协议概述
        5.1.1  进程之间的通信
            网络层：主机之间提供逻辑通信
            运输层：应用进程之间提供端到端的逻辑通信（ IP+端口），复用和分用。
            运输层还要对收到的报文进行差错检测。
            运输层有两种不同的运输协议，即面向连接的 TCP 和无连接的 UDP。   
        5.1.2  运输层的两个主要协议
            (1) 用户数据报协议 UDP (User Datagram Protocol)
            (2) 传输控制协议 TCP (Transmission Control  Protocol)
            UDP：无连接、不可靠、不拆包。单播、多播和广播
            TCP：面向连接、可靠、全双工。只能单播，不能广播或多播。可靠的，开销大。  
        5.1.3  运输层的端口
            UDP和TCP都使用16 位端口号
            网络层的协议类型字段类似于传输层端口号字段
            两类端口 
                (1) 服务器端使用的端口号
                    熟知端口，数值一般为 0~1023。
                    登记端口号，数值为 1024~49151，为没有熟知端口号的应用程序使用的。使用这个范围的端口号必须在 IANA 登记，以防止重复
                (2) 客户端使用的端口号
                    又称为短暂端口号，数值为 49152~65535，留给客户进程选择暂时使用。
            常用的熟知端口
                UDP
                    RPC 111
                    DNS 53
                    TFTP 69
                    SNMP 161
                    SNMP(trap) 162
                TCP
                    SMTP 25
                    FTP 21|20
                    Telent 23
                    HTTP 80
                    HTTPS 443
    5.2  用户数据报协议 UDP
        5.2.1 UDP 的主要特点 
            (1) UDP 是无连接的
            (2) UDP 使用尽最大努力交付
            (3) UDP 是面向报文的
            (4) UDP 没有拥塞控制
            (5) UDP 支持一对一、一对多、多对一和多对多的交互通信。
            (6) UDP 的首部开销小，只有 8 个字节，比 TCP 的 20 个字节的首部要短。
    5.3  传输控制协议 TCP 概述
        5.3.1  TCP 最主要的特点 
            (1) TCP 是面向连接
            (2) TCP 连接只能有两个端点，只能点对点（1对1）
            (3) TCP 是可靠交付
            (4) TCP 全双工通信
            (5) TPC 面向字节流(报文长度进程不可控)
        5.3.2  TCP 的连接 
            把连接作为最基本的抽象
            每一条 TCP 连接有两个端点
            TCP 连接的端点叫做套接字 (socket) 或插口
                端口号拼接到 (contatenated with) IP 地址即构成了套接字
            每一条 TCP 连接唯一地被通信两端的两个端点（即两个套接字）所确定
            TCP 可靠通信的具体实现 
                一个发送窗口和一个接收窗口
                用字节的序号进行控制
                两端的四个窗口经常处于动态变化之中
                使用特定的算法估算较为合理的重传时间
    5.4  可靠传输的工作原理
        5.4.1  停止等待协议
            全双工通信的双方既是发送方也是接收方。
            在发送完一个分组后，必须暂时保留已发送的分组的副本，以备重发
            分组和确认分组都必须进行编号。
            超时计时器的重传时间应当比数据在分组传输的平均往返时间更长一些
            停止等待协议的优点是简单，缺点是信道利用率太低。
        5.4.2  连续ARQ协议
            累积确认
            对按序到达的最后一个分组发送确认
            优点：容易实现，即使确认丢失也不必重传。
            缺点：不能向发送方反映出接收方已经正确收到的所有分组的信息。
            Go-back-N（回退 N） 
                表示需要再退回来重传已发送过的 N 个分组
            当通信线路质量不好时，连续 ARQ 协议会带来负面的影响
    5.5  TCP 报文段的首部格式
        TCP 报文段首部的前 20 个字节是固定的，TCP 首部的最小长度是 20 字节
        若选择较小的 MSS 长度，网络的利用率就降低
        为什么要规定 MSS ？
            只含有 1 字节的数据时
                在 IP 层传输的数据报的开销至少有 40 字节(包括 TCP 报文段的首部和 IP 数据报的首部)。这样，对网络的利用率就不会超过 1&#x2F;41
            TCP 报文段非常长
                IP 层传输时就有可能要分解成多个短数据报片。在终点要把收到的各个短数据报片装配成原来的 TCP 报文段。当传输出错时还要进行重传也都会使开销增大
            MSS 应尽可能大些，只要在 IP 层传输时不需要再分片就行，最佳的 MSS 是很难确定的
    5.6  TCP 可靠传输的实现
        5.6.1  以字节为单位的滑动窗口
            发送缓存与接收缓存的作用
                发送缓存用来暂时存放：
                    发送应用程序传送给发送方 TCP 准备发送的数据；
                    TCP 已发送出但尚未收到确认的数据。
                接收缓存用来暂时存放：
                    按序到达的、但尚未被接收应用程序读取的数据；
                    不按序到达的数据。 
            1. A 的发送窗口并不总是和 B 的接收窗口一样大（因为有一定的时间滞后）
            2. 第二，TCP 标准没有规定对不按序到达的数据应如何处理。
            3. TCP 要求接收方必须有累积确认的功能
            接收方可以在合适的时候发送确认，也可以在自己有数据要发送时把确认信息顺便捎带上
        5.6.2  超时重传时间的选择
            加权平均往返时间
                保留了 RTT 的一个加权平均往返时间 RTTS（这又称为平滑的往返时间）
                RFC 2988 推荐的 a 值为 1&#x2F;8，即 0.125
            超时重传时间 RTO
                RTO (Retransmission Time-Out) 应略大于上面得出的加权平均往返时间 RTTS。
                RTTD：是 RTT 的偏差的加权平均值
            Karn 算法
                新的问题：超时重传时间就无法更新
                修正的 Karn 算法
                    报文段每重传一次，就把 RTO 增大一些
                        新的 RTO &#x3D; y X (旧的 RTO)
                        系数 y 的典型值是 2
        5.6.3  选择确认 SACK
            解决的问题：若收到的报文段无差错，只是未按序号，中间还缺少一些序号的数据，那么能否设法只传送缺少的数据而不重传已经正确到达接收方的数据
                答案是可以的。选择确认 SACK  (Selective ACK) 就是一种可行的处理方法
            每一个字节块都有两个边界：左边界和右边界
    5.7  TCP 的流量控制
        5.7.1  利用滑动窗口实现流量控制
            方法：利用滑动窗口机制
            报文段在传送过程中丢失，发送方和接收方在相互等待，可能会造成互相等待的死锁，因此TCP 为每一个连接设有一个持续计时器 (persistence timer)
                持续计时器：
                    只要 TCP 连接的一方收到对方的零窗口通知，就启动该持续计时器
        5.7.2  必须考虑传输效率
            用不同的机制来控制 TCP 报文段的发送时机
                第一种机制是 TCP 维持一个变量，它等于最大报文段长度 MSS。只要缓存中存放的数据达到 MSS 字节时，就组装成一个 TCP 报文段发送出去
                第二种机制是由发送方的应用进程指明要求发送报文段，即 TCP 支持的推送 (push)操作
                第三种机制是发送方的一个计时器期限到了，这时就把当前已有的缓存数据装入报文段（但长度不能超过 MSS）发送出去    
    5.8  TCP 的拥塞控制
        5.8.1  拥塞控制的一般原理
            出现拥塞的原因：资源需求&gt;可用资源
                拥塞控制是动态的、
                分组的丢失是征兆，不是原因
            开环控制和闭环控制
                开环控制：在设计网络时事先考虑周到
                闭环控制：基于反馈环路：
                    检测何时何地发生
                    传送到可采取行动的地方
                    调整网络系统的运行
        5.8.2  TCP 的拥塞控制方法
            采用基于窗口的方法，TCP发送方维持一个拥塞窗口 CWND (Congestion Window)
            拥塞的判断
                重传定时器超时
                收到三个相同（重复）的 ACK
            TCP拥塞控制算法
                慢开始 (slow-start)
                    思路：由小到大逐渐增大拥塞窗口数值
                    拥塞窗口 cwnd  控制方法：在每收到一个对新的报文段的确认后，可以把拥塞窗口增加最多一个 SMSS 的数值
                    传输轮次 
                        拥塞窗口 cwnd 就加倍
                        所经历的时间就是往返时间 RTT
                    设置慢开始门限状态变量 ssthresh
                        当 cwnd &lt; ssthresh 时，使用慢开始算法。
                        当 cwnd &gt; ssthresh 时，停止使用慢开始算法而改用拥塞避免算法。
                        当 cwnd &#x3D; ssthresh 时，既可使用慢开始算法，也可使用拥塞避免算法。
                拥塞避免 (congestion avoidance)
                    思路：让拥塞窗口 cwnd 缓慢地增大，使拥塞窗口 cwnd 按线性规律缓慢增长
                        因此在拥塞避免阶段就有“加法增大”
                    当网络出现拥塞时（重传定时器超时）
                        发送方判断网络出现拥塞（重传定时器超时）：
                            ssthresh &#x3D; max(cwnd&#x2F;2，2)
                            cwnd &#x3D; 1
                            执行慢开始算法
                    非指完全能够避免了拥塞，而是使网络比较不容易出现拥塞
                    
                快重传 (fast retransmit)
                    尽早知道发生了个别报文段的丢失
                    发送方只要一连收到三个重复确认，就知道接收方确实没有收到报文段，因而应当立即进行重传（即“快重传”）
                快恢复 (fast recovery)
                    (1) 慢开始门限ssthresh&#x3D;当前拥塞窗口cwnd&#x2F;2 ；
                    (2) 新拥塞窗口 cwnd &#x3D; 慢开始门限 ssthresh ；
                    (3) 开始执行拥塞避免算法，使拥塞窗口缓慢地线性增大。 
                加法增大,乘法减小(AIMD)
        5.8.3  主动队列管理 AQM
            网络层对TCP拥塞控制影响最大的是路由器的分组丢弃策略
            路由器的队列
                “先进先出”FIFO 
                当队列已满时，尾部丢弃策略
                全局同步 (global syncronization)
                    很多TCP连接中的报文段服用在网络层IP数据报中，这时发生尾部丢弃，使这许多 TCP 连接在同一时间突然都进入到慢开始状态
                主动队列管理AQM
                    应当在队列长度达到某个值得警惕的数值时（即当网络拥塞有了某些拥塞征兆时），就主动丢弃到达的分组
                    随机早期检测 RED (Random Early Detection)
                        若平均队列长度小于最小门限 THmin，则将新到达的分组放入队列进行排队
                        若平均队列长度超过最大门限 THmax，则将新到达的分组丢弃
                        若平均队列长度在最小门限 THmin 和最大门限THmax 之间，则按照某一概率 p 将新到达的分组丢弃
                        RED 的使用效果并不太理想
                        AQM 实际上就是对路由器中的分组排队进行智能管理，而不是简单地把队列的尾部丢弃
    5.9  TCP 的运输连接管理
        TCP运输的三个阶段
            连接建立
            数据传送
            连接释放
        运输连接的管理
            使运输连接的建立和释放都能正常地进行
        TCP连接的建立采用客户服务器方式
            客户：主动发起连接建立的应用进程
            服务器：被动等待连接建立的应用进程
        5.9.1  TCP 的连接建立
            握手:TCP建立连接的过程
                三报文握手：客户和服务器之间交换三个 TCP 报文段
                    主要是为了防止已失效的连接请求报文段突然又传送到了，因而产生错误
        5.9.2  TCP 的连接释放
            四报文握手：TCP 连接释放过程
            TCP 连接处于半关闭状态
            必须等待 2MSL 的时间
                第一，为了保证 A 发送的最后一个 ACK 报文段能够到达 B
                第二，防止 “已失效的连接请求报文段”出现在本连接中。
        5.9.3  TCP 的有限状态机
            粗实线箭头表示对客户进程的正常变迁。
            粗虚线箭头表示对服务器进程的正常变迁。
            细线箭头表示异常变迁。

1.浏览器输入一个网址，每层用到哪些协议，其作用是什么
    应用层：HTTP:WWW访问协议，DNS:域名解析服务
    传输层：TCP:为HTTP提供可靠的数据传输，UDP：DNS使用UDP传输
    网络层：IP:IP包传输和路由选择，ICMP：提供网络传输中的差错检测，ARP：将本机的默认网关IP地址映射城物理MAC地址
</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">4.</span> <span class="nav-text">
    4.1  网络层提供的两种服务 
        面向连接 无连接 
        争论的实质是：可靠交付是网络负责，还是端系统负责。
        结论： “无连接”赢了
        让网络负责可靠交付：
            使用面向连接的通信方式
            先建立虚电路 (Virtual Circuit)
                虚电路是逻辑连接
                分组按照存储转发方式传送
                电路交换的电话通信是先建立了一条真正的连接
        网络提供数据报服务：
            网络层向上只提供简单灵活的、无连接的、尽最大努力交付的数据报服务
            网络层不提供服务质量的承诺
            尽最大努力交付：
                传输网络不提供端到端的可靠传输服务
                主机中的运输层负责可靠交付（包括差错处理、流量控制等）
    4.2 网际协议 IP
        地址解析协议 ARP(Address Resolution Protocol)
        网际控制报文协议 ICMP(Internet Control Message Protocol)
        网际组管理协议 IGMP(Internet Group Management Protocol)
        4.2.1 虚拟网络互联
            中间设备 &#x2F; 中间系统 &#x2F; 中继系统
                物理层中继系统：集线器 (repeater)。
                数据链路层中继系统：网桥 或 交换机。
                网络层中继系统：路由器 (router)。
                网桥和路由器的混合物：桥路器 (brouter)，二三层。
                网络层以上的中继系统：网关 (gateway)。  
            网络互联：
                中继系统是转发器或者网桥时，不称为网络互联，仍然是一个网络
                网络互连都是指用路由器进行网络互连和路由选择
                路由器称为网关
            虚拟网络互联
                虚拟互连网络也就是逻辑互连网络，
                利用 IP 协议就可以使这些性能各异的网络从用户看起来好像是一个统一的网络
                IP网：使用 IP 协议的虚拟互连网络
                好处：当互联网上的主机进行通信时，就好像在一个网络上通信一样，而看不见互连的各具体的网络异构细节。
                如果在这种覆盖全球的 IP 网的上层使用 TCP 协议，那么就是现在的互联网 (Internet)。
        4.2.2 分类的IP地址
            唯一的 32 位的标识符
            IP 地址现在由互联网名字和数字分配机构ICANN 进行分配
            IP地址的编址方法：
                1.分类的IP地址
                    公网 IP 地址在整个互联网范围内是唯一的。
                    私网 IP 地址在整个私网范围内是唯一的。
                    2进制开头 地址的网络号字段 主机号字段 每个网络最大主机数
                        A 0 8 24 2^24-2
                        B 10 16 16 2^16-2
                        C 110 24 8 2^8-2
                        D 1110 多播地址
                        E 1111 保留为今后使用
                    特殊的 IP 地址 全0 &#x2F; 1
                    重要特点：
                        (1) IP 地址是一种分等级的地址结构
                        (2) 实际上 IP 地址是标志一个主机（或路由器）和一条链路的接口
                            多归属主机:具有两个IP地址，和不通的网络号
                        (3) 用转发器或网桥连接起来的若干个局域网仍为一个网络，因此这些局域网都（？一般）具有同样的网络号 net-id。网络号不同必须使用路由器连接
                        (4) 所有分配到网络号 net-id 的网络，都是平等的


            2.子网的划分
            3.构成超网
    4.2.3 IP 地址与硬件地址
        硬件地址（或物理地址）是数据链路层和物理层使用的地址
        IP 地址是网络层和以上各层使用的地址，是一种逻辑地址
            称 IP 地址是逻辑地址是因为 IP 地址是用软件实现的
        两个路由器的 IP 地址并不出现在 IP 数据报的首部中
    4.2.4 地址解析协议 ARP
        通信时使用了两个地址：IP 地址（网络层地址） MAC 地址（数据链路层地址）
        作用：已知IP地址，求硬件地址
        实际网络传送数据必须使用硬件地址
        每一个主机都设有一个ARP高速缓存，有IP地址到硬件地址的映射表
        当主机 A 欲向本局域网上的某个主机 B 发送 IP 数据报时：
            如有，就可查出其对应的硬件地址，再将此硬件地址写入 MAC 帧，并发送
            如没有， 本局域网广播一个 ARP 请求分组。收到 ARP 响应分组后，将得到的 IP 地址到硬件地址的映射写入 ARP 高速缓存。组MAC帧发送
        要点：
            ARP请求分组：包含发送方硬件地址 &#x2F; 发送方 IP 地址 &#x2F; 0 &#x2F; 目标方 IP 地址。
            本地广播 ARP 请求（路由器不转发ARP请求）。
            ARP 响应分组：发送方硬件地址 &#x2F; 发送方 IP地址 &#x2F; 目标方硬件地址 &#x2F; 目标方 IP 地址。
            ARP 分组封装在物理网络的帧中传输。
            抓包
        ARP 高速缓存的作用
            存放最近获得的 IP 地址到 MAC 地址的绑定，以减少 ARP 广播的数量。
            减少网络上的通信量
            主机 B (所有主机)收到 A 的 ARP 请求分组时，就将主机 A 的这一地址映射写入主机 B 自己的 ARP 高速缓存中。这对主机 B 以后向 A 发送数据报时就更方便了
    4.2.5 IP 数据报的格式
        由首部和数据两部分组成
            首部的前一部分是固定长度，共 20 字节
        IP首部长度占4位，可表示的最大数值是 15 个单位(一个单位为 4 字节)IP 的首部长度的最大值是 60 字节
        区分服务：占8位，实际上一直未被使用，一般情况下都不使用这个字段
        总长度：占16位，数据报最大长度为2^16-1字节
        原始数据报首部被复制为各数据报片的首部，但必须修改有关字段的值
        IP 数据报首部的可变部分
            从 1 个字节到 40 个字节不等
    4.2.6 IP 层转发分组的流程
        路由器分组转发算法 
            (1) 从数据报的首部提取目的主机的 IP 地址 D, 得出目的网络地址为 N。
            (2) 若网络 N 与此路由器直接相连，则把数据报直接交付目的主机 D；否则是间接交付，执行 (3)。
            (3) 若路由表中有目的地址为 D 的特定主机路由，则把数据报传送给路由表中所指明的下一跳路由器；否则，执行 (4)。
            (4) 若路由表中有到达网络 N 的路由，则把数据报传送给路由表指明的下一跳路由器；否则，执行 (5)。
            (5) 若路由表中有一个默认路由，则把数据报传送给路由表中所指明的默认路由器；否则，执行 (6)。
            (6)  报告转发分组出错。 
4.3 划分子网和构造超网
    4.3.1   划分子网
        基本思路
            划分子网纯属一个单位内部的事情
            从主机号借用若干个位作为子网号 subnet-id
        子网的掩码
            从一个 IP 数据报的首部并无法判断是否进行了子网划分
            使用子网掩码 (subnet mask) 可以找出 IP 地址中的子网部分
            规则
                子网掩码长度 ＝ 32 位
                某位 ＝ 1：IP地址中的对应位为网络号和子网号
                某位 ＝ 0：IP地址中的对应位为主机号  
        子网划分方法
            文档规定不能为全 1 或全 0，现在全 1 和全 0 的子网号也可以使用了
            划分子网增加了灵活性，但却减少了能够连接在网络上的主机总数。


                子网数：192&#x3D;128+64(n&#x3D;2)
                       2^n-2:子网数
                子网主机数：2^(16-n)-2
        4.3.2  在划分子网情况下路由器转发分组的算法 
            (1) 从收到的分组的首部提取目的 IP 地址 D。
            (2) 先用各网络的子网掩码和 D 逐位相“与”，看是否和相应的网
                络地址匹配。若匹配，则将分组直接交付。否则就是间接交付，
                执行 (3)。
            (3) 若路由表中有目的地址为 D 的特定主机路由，则将分组传送给
                指明的下一跳路由器；否则，执行 (4)。
            (4) 对路由表中的每一行，将子网掩码和 D 逐位相“与”。若结果与该行的目的网络地址匹配，则将分组传送给该行指明的下一跳路由器；否则，执行 (5)。
            (5) 若路由表中有一个默认路由，则将分组传送给路由表中所指明
                的默认路由器；否则，执行 (6)。
            (6) 报告转发分组出错。
            【例4-4】已知互联网和路由器 R1 中的路由表。主机 H1 向 H2 发送分组。试讨论 R1 收到 H1 向 H2 发送的分组后查找路由表的过程。
            ppt 475
        4.3.3  无分类编址 CIDR
            变长子网掩码 VLSM (Variable Length Subnet Mask) &#x2F; 无分类域间路由选择 CIDR (Classless Inter-Domain Routing)
            特点：
                消除了传统的 A 类、B 类和 C 类地址以及划分子网的概念
                使用各种长度的“网络前缀”(network-prefix)
                斜线记法”(slash notation) &#x2F; CIDR 记法
            CIDR地址块：
                128.14.32.0&#x2F;20 表示的地址块共有 2^12（4*8-20） 个地址（因为斜线后面的 20 是网络前缀的位数，所以这个地址的主机号是 12 位）。
                    这个地址块的起始地址是 128.14.32.0。
                    在不需要指出地址块的起始地址时，也可将这样的地址块简称为“&#x2F;20 地址块”。
                    128.14.32.0&#x2F;20 地址块的最小地址：128.14.32.0
                    128.14.32.0&#x2F;20 地址块的最大地址：128.14.47.255
                    全 0 和全 1 的主机号地址一般不使用。
                路由聚合：
                    一个 CIDR 地址块可以表示很多地址
                    有利于减少路由器之间的路由选择信息的交换，从而提高了整个互联网的性能有利于减少路由器之间的路由选择信息的交换，从而提高了整个互联网的性能
                    路由聚合也称为构成超网 (supernetting)
                    仍然使用“掩码”
                    对于 &#x2F;20  地址块，它的掩码是 20 个连续的 1。 斜线记法中的数字就是掩码中1的个数
                    10.0.0.0&#x2F;10 可简写为 10&#x2F;10
                    10.0.0.0 的掩码是 255.192.0.0
                    星号 * ：
                        在星号 * 之前是网络前缀，而星号 * 表示 IP 地址中的主机号，可以是任意值
                    最长前缀匹配 (longest-prefix matching) &#x2F;最长匹配或最佳匹配
                        选择两个匹配的地址中更具体的一个，即选择最长前缀的地址
    4.4  网际控制报文协议 ICMP
            有效地转发 IP 数据报和提高交付成功
            ICMP 询问报文有两种 
                回送请求和回答报文
                时间戳请求和回答报文
            4.4.2  ICMP 的应用举例
                PING 用来测试两个主机之间的连通性,使用了 ICMP 回送请求与回送回答报文
                Tracerout 用来跟踪一个分组从源点到终点的路径
    4.5  互联网的路由选择协议
        4.5.1  有关路由选择协议的几个基本概念
                内部网关协议 IGP (Interior Gateway Protocol)
                    自治系统内部使用
                外部网关协议 EGP (External Gateway Protocol)    
                    不同的自治系统之间传路由选择信息
        4.5.2  内部网关协议 RIP
            分布式的、基于距离向量的路由选择协议
            要求网络中的每一个路由器都要维护从它自己到其他每一个目的网络的距离记录
            距离 &#x2F; 跳数 &#x2F; 最短距离：
                从一个路由器到直接连接的网络的距离定义为 1
                每经过一个路由器，跳数就加 1
                一个好的路由，距离短
                一条路径最多只能包含 15 个路由器，“距离”的最大值为 16 时即相当于不可达
                RIP 不能在两个网络之间同时使用多条路由
            三个特点：
                仅和相邻路由器交换信息
                交换的信息是当前本路由器所知道的全部信息，即自己的路由表
                按固定的时间间隔交换路由信息
            路由表的建立
                刚刚开始工作，路由表是空的
                收敛 (convergence) 过程较快    
                距离向量算法
                    路由器收到相邻路由器（其地址为 X）的一个 RIP 报文：
                    (1) 先修改此 RIP 报文中的所有项目：把“下一跳”字段中的地址都改为 X，并把所有的“距离”字段的值加 1。
                    (2) 对修改后的 RIP 报文中的每一个项目，重复以下步骤：
                        若项目中的目的网络不在路由表中，则把该项目加到路由表中。
                        否则若下一跳字段给出的路由器地址是同样的，则把收到的项目替换原路由表中的项目。
                        否则若收到项目中的距离小于路由表中的距离，则进行更新，否则，什么也不做。
                    (3) 若 3 分钟还没有收到相邻路由器的更新路由表，则把此相邻路由器记为不可达路由器，即将距离置为 16（表示不可达）。
                    (4) 返回。
                    
            协议特点：好消息传播得快，坏消息传播得慢。
            RIP 存在的一个问题：当网络出现故障时，要经过比较长的时间 (例如数分钟) 才能将此信息传送到所有的路由器。
            优点：实现简单，开销较小。
            缺点：RIP 限制了网络的规模，它能使用的最大距离为 15（16 表示不可达）。
            路由器之间交换的是完整路由表，因而网络规模越大，开销就越大。 
            “坏消息传播得慢”，使更新过程的收敛时间过长。
        4.5.3  内部网关协议 OSPF 开放最短路径优先 OSPF (Open Shortest Path First)
            “开放”表明 OSPF 不受某一厂商控制，而是公开的
            “最短路径优先”是因为使用了 Dijkstra 提出的最短路径算法 SPF
            要点：只有链路状态发生变化，才用IP 数据报和洪泛法发送链路状态（度量） 
            三个要点
                向本自治系统中所有路由器发送信息，洪泛法
                发送的信息就是与本路由器相邻的所有路由器的链路状态，但这只是路由器所知道的部分信息。
                只有当链路状态变化时，路由器才用洪泛法向所有路由器发送此信息
            链路状态数据库 (link-state database) 
                由所有的路由器最终建立
                全网的拓扑结构图，它在全网范围内是一致的
                OSPF 的链路状态数据库能较快地进行更新
            其他特点：
                OSPF 对于不同类型的业务可计算出不同的路由
                多路径间的负载平衡：到同一个目的网络有多条相同代价的路径，那么可以将通信量分配给这几条路径
                所有在 OSPF 路由器之间交换的分组都具有鉴别的功能
                支持可变长度的子网划分和无分类编址 CIDR
        4.5.4  外部网关协议 BGP
            不同自治系统的路由器之间交换路由信息的协议
            只是力求寻找一条能够到达目的网络且比较好的路由（不能兜圈子），而并非要寻找一条最佳路由
            先建立 TCP 连接
            特点：
                自治系统数的量级
                BGP 支持 CIDR
                更新有变化的部分。这样做对节省网络带宽和减少路由器的处理开销都有好处。 
        4.5.5  路由器的构成
            “转发”和“路由选择”的区别 
                转发：路由器根据转发表将用户的 IP 数据报从合适的端口转发出去
                路由选择：按照分布式算法，根据从各相邻路由器得到的关于网络拓扑的变化情况，动态地改变所选择的路由
            分组丢弃：
                路由器中的输入或输出队列产生溢出是造成分组丢失的重要原因
    4.6  IPv6
        4.6.1  IPv6 的基本首部
            主要变化：
                更大的地址空间。从 IPv4 的 32 位 增大到128 位。 
                扩展的地址层次结构。 
                灵活的首部格式。 定义了许多可选的扩展首部。
                改进的选项。 允许数据报包含有选项的控制信息
                允许协议继续扩充。 
                支持即插即用（即自动配置）。不需要 DHCP。
                支持资源的预分配。  支持特定带宽和时延的应用。
                IPv6 首部 8 字节对齐。 IPv4 首部是 4 字节对齐。          
            数据报：
                由基本首部（40个字节）有效载荷（不超过65535）两大部分组成
                对首部的更改：
                    取消了首部长度字段，因为首部长度是固定的 40 字节；
                    取消了服务类型字段；
                    取消了总长度字段，改用有效载荷长度字段；
                    把 TTL 字段改称为跳数限制字段；
                    取消了协议字段，改用下一个首部字段；
                    取消了检验和字段；
                    取消了选项字段，而用扩展首部来实现选项功能。
            拓展首部
                IPv6 把原来 IPv4 首部中选项的功能都放在扩展首部中，大大提高了路由器的处理效率
                六种扩展首部：  
                    (1) 逐跳选项
                    (2) 路由选择
                    (3) 分片
                    (4) 鉴别
                    (5) 封装安全有效载荷
                    (6) 目的站选项 
        4.6.2  IPv6 的地址
            (1) 单播 (unicast)：传统的点对点通信。
            (2) 多播 (multicast)：一点对多点的通信。
            (3) 任播 (anycast)：这是 IPv6 增加的一种类型。任播的目的站是一组计算机，但数据报在交付时只交付其中的一个，通常是距离最近的一个。 
            冒号十六进制记法
                零压缩
                    即一连串连续的零可以为一对冒号所取代
                    注意：在任一地址中只能使用一次零压缩。
                    CIDR 的斜线表示法仍然可用。
                    例如：60 位的前缀 12AB00000000CD3 可记为：
                    12AB:0000:0000:CD30:0000:0000:0000:0000&#x2F;60
                    或 12AB::CD30:0:0:0:0&#x2F;60 （零压缩）
                    或 12AB:0:0:CD30::&#x2F;60 （零压缩）
        4.6.3  从 IPv4 向 IPv6 过渡
                只能采用逐步演进的办法，使新安装的 IPv6 系统能够向后兼容
                两种向 IPv6 过渡的策略：
                    使用双协议栈
                    使用隧道技术
                双协议栈
                    使一部分主机（或路由器）装有两个协议栈，一个 IPv4 和一个 IPv6
                    同时具有两种 IP 地址：一个 IPv6 地址和一个 IPv4 地址
                隧道技术
                    在 IPv6 数据报要进入 IPv4 网络时，把 IPv6 数据报封装成为 IPv4 数据报
        4.6.4  ICMPv6
            IPv6 也不保证数据报的可靠交付（IPv4也不可靠交付）
            地址解析协议 ARP 和网际组管理协议 IGMP 协议的功能都已被合并到 ICMPv6 中           
    4.7  IP 多播
        4.7.1  IP 多播的基本概念
            IP 多播 (multicast，以前曾译为组播)，一对多通信
                在互联网上进行多播就叫做 IP 多播。
                互联网范围的多播要靠路由器来实现。
                多播数据报的目的地址是多播 IP 地址。
                多播IP 地址是 D 类地址。
                多播地址只能用于目的地址，不能用于源地址
            多播数据报
                使用网际组管理协议 IGMP
                多播数据报也是“尽最大努力交付”。
                对多播数据报不产生 ICMP 差错报文。
        4.7.2  在局域网上进行硬件多播 
            IANA 拥有的以太网地址块的高 24 位为 00-00-5E
            TCP&#x2F;IP 协议使用的以太网多播地址块的范围
                    从   01-00-5E-00-00-00 
                    到   01-00-5E-7F-FF-FF 
            D 类 IP 地址可供分配的有 28 位，前 5 位不能用来构成以太网硬件地址
            由于多播 IP 地址与以太网硬件地址的映射关系不是唯一的，因此收到多播数据报的主机，还要在 IP 层利用软件进行过滤，把不是本主机要接收的数据报丢弃。
        4.7.3  网际组管理协议 IGMP和多播路由选择协议
            IP 多播需要两种协议
                网际组管理协议 IGMP (Internet Group Management Protocol)
                多播路由选择协议
            多播路由选择协议更为复杂
                动态地适应多播组成员的变化
                不能仅仅根据多播数据报中的目的地址，而是还要考虑这个多播数据报从什么地方来和要到什么地方去
                多播数据报可以由没有加入多播组的主机发出
    4.8  虚拟专用网 VPN和网络地址转换 NAT
        4.8.1  虚拟专用网 VPN (Virtual Private Network)
            本地(私网)地址
            全球(公网)地址
            专用地址只能用作本地地址
                在互联网中的所有路由器，对目的地址是专用地址的数据报不转发
            RFC 1918 指明的专用 IP 地址三个专用 IP 地址块：
                (1) 10.0.0.0 到 10.255.255.255
                    A类，或记为10.0.0.0&#x2F;8，它又称为 24 位块
                (2) 172.16.0.0 到 172.31.255.255
                    B类，或记为172.16.0.0&#x2F;12，它又称为 20 位块
                (3) 192.168.0.0 到 192.168.255.255
                    C类，或记为192.168.0.0&#x2F;16，它又称为 16 位块
            利用公网作为本机构各专用网(私网)之间的通信载体，这样的专用网又称为虚拟专用网VPN
                专用网
                    是为本机构的主机用于机构内部的通信，而不是用于和网络外非本机构的主机通信
        4.8.2   网络地址转换 NAT
            使用本地地址的主机在和外界通信时，将其本地地址转换成全球 IP 地址 
            两次地址转换：
                离开专用网时：替换源地址，将内部地址替换为全球地址；
                进入专用网时：替换目的地址，将全球地址替换为内部地址；
            当 NAT 路由器具有 n 个全球 IP 地址时，专用网内最多可以同时有 n 台主机接入到互联网
            通过 NAT 路由器的通信必须由专用网内的主机发起，专用网内部的主机不能充当服务器用
            网络地址与端口号转换 NAPT
                运输层的端口号也利用上，共用一个 NAT 路由器上的全球 IP 地址
                网络地址与端口号转换NAPT (Network Address and Port Translation)，不使用端口号的 NAT 就叫做传统的 NAT
    4.9  多协议标记交换 MPLS
        MPLS 并没有取代 IP，而是一种 IP 增强技术
        为了提高传统路由器IP 分组的转发效率，在 MPLS 域的入口处，给每一个 IP 数据报打上固定长度“标记”，然后对打上标记的 IP 数据报用硬件进行转发

    5.1  运输层协议概述
        5.1.1  进程之间的通信
            网络层：主机之间提供逻辑通信
            运输层：应用进程之间提供端到端的逻辑通信（ IP+端口），复用和分用。
            运输层还要对收到的报文进行差错检测。
            运输层有两种不同的运输协议，即面向连接的 TCP 和无连接的 UDP。   
        5.1.2  运输层的两个主要协议
            (1) 用户数据报协议 UDP (User Datagram Protocol)
            (2) 传输控制协议 TCP (Transmission Control  Protocol)
            UDP：无连接、不可靠、不拆包。单播、多播和广播
            TCP：面向连接、可靠、全双工。只能单播，不能广播或多播。可靠的，开销大。  
        5.1.3  运输层的端口
            UDP和TCP都使用16 位端口号
            网络层的协议类型字段类似于传输层端口号字段
            两类端口 
                (1) 服务器端使用的端口号
                    熟知端口，数值一般为 0~1023。
                    登记端口号，数值为 1024~49151，为没有熟知端口号的应用程序使用的。使用这个范围的端口号必须在 IANA 登记，以防止重复
                (2) 客户端使用的端口号
                    又称为短暂端口号，数值为 49152~65535，留给客户进程选择暂时使用。
            常用的熟知端口
                UDP
                    RPC 111
                    DNS 53
                    TFTP 69
                    SNMP 161
                    SNMP(trap) 162
                TCP
                    SMTP 25
                    FTP 21|20
                    Telent 23
                    HTTP 80
                    HTTPS 443
    5.2  用户数据报协议 UDP
        5.2.1 UDP 的主要特点 
            (1) UDP 是无连接的
            (2) UDP 使用尽最大努力交付
            (3) UDP 是面向报文的
            (4) UDP 没有拥塞控制
            (5) UDP 支持一对一、一对多、多对一和多对多的交互通信。
            (6) UDP 的首部开销小，只有 8 个字节，比 TCP 的 20 个字节的首部要短。
    5.3  传输控制协议 TCP 概述
        5.3.1  TCP 最主要的特点 
            (1) TCP 是面向连接
            (2) TCP 连接只能有两个端点，只能点对点（1对1）
            (3) TCP 是可靠交付
            (4) TCP 全双工通信
            (5) TPC 面向字节流(报文长度进程不可控)
        5.3.2  TCP 的连接 
            把连接作为最基本的抽象
            每一条 TCP 连接有两个端点
            TCP 连接的端点叫做套接字 (socket) 或插口
                端口号拼接到 (contatenated with) IP 地址即构成了套接字
            每一条 TCP 连接唯一地被通信两端的两个端点（即两个套接字）所确定
            TCP 可靠通信的具体实现 
                一个发送窗口和一个接收窗口
                用字节的序号进行控制
                两端的四个窗口经常处于动态变化之中
                使用特定的算法估算较为合理的重传时间
    5.4  可靠传输的工作原理
        5.4.1  停止等待协议
            全双工通信的双方既是发送方也是接收方。
            在发送完一个分组后，必须暂时保留已发送的分组的副本，以备重发
            分组和确认分组都必须进行编号。
            超时计时器的重传时间应当比数据在分组传输的平均往返时间更长一些
            停止等待协议的优点是简单，缺点是信道利用率太低。
        5.4.2  连续ARQ协议
            累积确认
            对按序到达的最后一个分组发送确认
            优点：容易实现，即使确认丢失也不必重传。
            缺点：不能向发送方反映出接收方已经正确收到的所有分组的信息。
            Go-back-N（回退 N） 
                表示需要再退回来重传已发送过的 N 个分组
            当通信线路质量不好时，连续 ARQ 协议会带来负面的影响
    5.5  TCP 报文段的首部格式
        TCP 报文段首部的前 20 个字节是固定的，TCP 首部的最小长度是 20 字节
        若选择较小的 MSS 长度，网络的利用率就降低
        为什么要规定 MSS ？
            只含有 1 字节的数据时
                在 IP 层传输的数据报的开销至少有 40 字节(包括 TCP 报文段的首部和 IP 数据报的首部)。这样，对网络的利用率就不会超过 1&#x2F;41
            TCP 报文段非常长
                IP 层传输时就有可能要分解成多个短数据报片。在终点要把收到的各个短数据报片装配成原来的 TCP 报文段。当传输出错时还要进行重传也都会使开销增大
            MSS 应尽可能大些，只要在 IP 层传输时不需要再分片就行，最佳的 MSS 是很难确定的
    5.6  TCP 可靠传输的实现
        5.6.1  以字节为单位的滑动窗口
            发送缓存与接收缓存的作用
                发送缓存用来暂时存放：
                    发送应用程序传送给发送方 TCP 准备发送的数据；
                    TCP 已发送出但尚未收到确认的数据。
                接收缓存用来暂时存放：
                    按序到达的、但尚未被接收应用程序读取的数据；
                    不按序到达的数据。 
            1. A 的发送窗口并不总是和 B 的接收窗口一样大（因为有一定的时间滞后）
            2. 第二，TCP 标准没有规定对不按序到达的数据应如何处理。
            3. TCP 要求接收方必须有累积确认的功能
            接收方可以在合适的时候发送确认，也可以在自己有数据要发送时把确认信息顺便捎带上
        5.6.2  超时重传时间的选择
            加权平均往返时间
                保留了 RTT 的一个加权平均往返时间 RTTS（这又称为平滑的往返时间）
                RFC 2988 推荐的 a 值为 1&#x2F;8，即 0.125
            超时重传时间 RTO
                RTO (Retransmission Time-Out) 应略大于上面得出的加权平均往返时间 RTTS。
                RTTD：是 RTT 的偏差的加权平均值
            Karn 算法
                新的问题：超时重传时间就无法更新
                修正的 Karn 算法
                    报文段每重传一次，就把 RTO 增大一些
                        新的 RTO &#x3D; y X (旧的 RTO)
                        系数 y 的典型值是 2
        5.6.3  选择确认 SACK
            解决的问题：若收到的报文段无差错，只是未按序号，中间还缺少一些序号的数据，那么能否设法只传送缺少的数据而不重传已经正确到达接收方的数据
                答案是可以的。选择确认 SACK  (Selective ACK) 就是一种可行的处理方法
            每一个字节块都有两个边界：左边界和右边界
    5.7  TCP 的流量控制
        5.7.1  利用滑动窗口实现流量控制
            方法：利用滑动窗口机制
            报文段在传送过程中丢失，发送方和接收方在相互等待，可能会造成互相等待的死锁，因此TCP 为每一个连接设有一个持续计时器 (persistence timer)
                持续计时器：
                    只要 TCP 连接的一方收到对方的零窗口通知，就启动该持续计时器
        5.7.2  必须考虑传输效率
            用不同的机制来控制 TCP 报文段的发送时机
                第一种机制是 TCP 维持一个变量，它等于最大报文段长度 MSS。只要缓存中存放的数据达到 MSS 字节时，就组装成一个 TCP 报文段发送出去
                第二种机制是由发送方的应用进程指明要求发送报文段，即 TCP 支持的推送 (push)操作
                第三种机制是发送方的一个计时器期限到了，这时就把当前已有的缓存数据装入报文段（但长度不能超过 MSS）发送出去    
    5.8  TCP 的拥塞控制
        5.8.1  拥塞控制的一般原理
            出现拥塞的原因：资源需求&gt;可用资源
                拥塞控制是动态的、
                分组的丢失是征兆，不是原因
            开环控制和闭环控制
                开环控制：在设计网络时事先考虑周到
                闭环控制：基于反馈环路：
                    检测何时何地发生
                    传送到可采取行动的地方
                    调整网络系统的运行
        5.8.2  TCP 的拥塞控制方法
            采用基于窗口的方法，TCP发送方维持一个拥塞窗口 CWND (Congestion Window)
            拥塞的判断
                重传定时器超时
                收到三个相同（重复）的 ACK
            TCP拥塞控制算法
                慢开始 (slow-start)
                    思路：由小到大逐渐增大拥塞窗口数值
                    拥塞窗口 cwnd  控制方法：在每收到一个对新的报文段的确认后，可以把拥塞窗口增加最多一个 SMSS 的数值
                    传输轮次 
                        拥塞窗口 cwnd 就加倍
                        所经历的时间就是往返时间 RTT
                    设置慢开始门限状态变量 ssthresh
                        当 cwnd &lt; ssthresh 时，使用慢开始算法。
                        当 cwnd &gt; ssthresh 时，停止使用慢开始算法而改用拥塞避免算法。
                        当 cwnd &#x3D; ssthresh 时，既可使用慢开始算法，也可使用拥塞避免算法。
                拥塞避免 (congestion avoidance)
                    思路：让拥塞窗口 cwnd 缓慢地增大，使拥塞窗口 cwnd 按线性规律缓慢增长
                        因此在拥塞避免阶段就有“加法增大”
                    当网络出现拥塞时（重传定时器超时）
                        发送方判断网络出现拥塞（重传定时器超时）：
                            ssthresh &#x3D; max(cwnd&#x2F;2，2)
                            cwnd &#x3D; 1
                            执行慢开始算法
                    非指完全能够避免了拥塞，而是使网络比较不容易出现拥塞
                    
                快重传 (fast retransmit)
                    尽早知道发生了个别报文段的丢失
                    发送方只要一连收到三个重复确认，就知道接收方确实没有收到报文段，因而应当立即进行重传（即“快重传”）
                快恢复 (fast recovery)
                    (1) 慢开始门限ssthresh&#x3D;当前拥塞窗口cwnd&#x2F;2 ；
                    (2) 新拥塞窗口 cwnd &#x3D; 慢开始门限 ssthresh ；
                    (3) 开始执行拥塞避免算法，使拥塞窗口缓慢地线性增大。 
                加法增大,乘法减小(AIMD)
        5.8.3  主动队列管理 AQM
            网络层对TCP拥塞控制影响最大的是路由器的分组丢弃策略
            路由器的队列
                “先进先出”FIFO 
                当队列已满时，尾部丢弃策略
                全局同步 (global syncronization)
                    很多TCP连接中的报文段服用在网络层IP数据报中，这时发生尾部丢弃，使这许多 TCP 连接在同一时间突然都进入到慢开始状态
                主动队列管理AQM
                    应当在队列长度达到某个值得警惕的数值时（即当网络拥塞有了某些拥塞征兆时），就主动丢弃到达的分组
                    随机早期检测 RED (Random Early Detection)
                        若平均队列长度小于最小门限 THmin，则将新到达的分组放入队列进行排队
                        若平均队列长度超过最大门限 THmax，则将新到达的分组丢弃
                        若平均队列长度在最小门限 THmin 和最大门限THmax 之间，则按照某一概率 p 将新到达的分组丢弃
                        RED 的使用效果并不太理想
                        AQM 实际上就是对路由器中的分组排队进行智能管理，而不是简单地把队列的尾部丢弃
    5.9  TCP 的运输连接管理
        TCP运输的三个阶段
            连接建立
            数据传送
            连接释放
        运输连接的管理
            使运输连接的建立和释放都能正常地进行
        TCP连接的建立采用客户服务器方式
            客户：主动发起连接建立的应用进程
            服务器：被动等待连接建立的应用进程
        5.9.1  TCP 的连接建立
            握手:TCP建立连接的过程
                三报文握手：客户和服务器之间交换三个 TCP 报文段
                    主要是为了防止已失效的连接请求报文段突然又传送到了，因而产生错误
        5.9.2  TCP 的连接释放
            四报文握手：TCP 连接释放过程
            TCP 连接处于半关闭状态
            必须等待 2MSL 的时间
                第一，为了保证 A 发送的最后一个 ACK 报文段能够到达 B
                第二，防止 “已失效的连接请求报文段”出现在本连接中。
        5.9.3  TCP 的有限状态机
            粗实线箭头表示对客户进程的正常变迁。
            粗虚线箭头表示对服务器进程的正常变迁。
            细线箭头表示异常变迁。

1.浏览器输入一个网址，每层用到哪些协议，其作用是什么
    应用层：HTTP:WWW访问协议，DNS:域名解析服务
    传输层：TCP:为HTTP提供可靠的数据传输，UDP：DNS使用UDP传输
    网络层：IP:IP包传输和路由选择，ICMP：提供网络传输中的差错检测，ARP：将本机的默认网关IP地址映射城物理MAC地址
</span></a></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">5.</span> <span class="nav-text">
    5.1  运输层协议概述
        5.1.1  进程之间的通信
            网络层：主机之间提供逻辑通信
            运输层：应用进程之间提供端到端的逻辑通信（ IP+端口），复用和分用。
            运输层还要对收到的报文进行差错检测。
            运输层有两种不同的运输协议，即面向连接的 TCP 和无连接的 UDP。   
        5.1.2  运输层的两个主要协议
            (1) 用户数据报协议 UDP (User Datagram Protocol)
            (2) 传输控制协议 TCP (Transmission Control  Protocol)
            UDP：无连接、不可靠、不拆包。单播、多播和广播
            TCP：面向连接、可靠、全双工。只能单播，不能广播或多播。可靠的，开销大。  
        5.1.3  运输层的端口
            UDP和TCP都使用16 位端口号
            网络层的协议类型字段类似于传输层端口号字段
            两类端口 
                (1) 服务器端使用的端口号
                    熟知端口，数值一般为 0~1023。
                    登记端口号，数值为 1024~49151，为没有熟知端口号的应用程序使用的。使用这个范围的端口号必须在 IANA 登记，以防止重复
                (2) 客户端使用的端口号
                    又称为短暂端口号，数值为 49152~65535，留给客户进程选择暂时使用。
            常用的熟知端口
                UDP
                    RPC 111
                    DNS 53
                    TFTP 69
                    SNMP 161
                    SNMP(trap) 162
                TCP
                    SMTP 25
                    FTP 21|20
                    Telent 23
                    HTTP 80
                    HTTPS 443
    5.2  用户数据报协议 UDP
        5.2.1 UDP 的主要特点 
            (1) UDP 是无连接的
            (2) UDP 使用尽最大努力交付
            (3) UDP 是面向报文的
            (4) UDP 没有拥塞控制
            (5) UDP 支持一对一、一对多、多对一和多对多的交互通信。
            (6) UDP 的首部开销小，只有 8 个字节，比 TCP 的 20 个字节的首部要短。
    5.3  传输控制协议 TCP 概述
        5.3.1  TCP 最主要的特点 
            (1) TCP 是面向连接
            (2) TCP 连接只能有两个端点，只能点对点（1对1）
            (3) TCP 是可靠交付
            (4) TCP 全双工通信
            (5) TPC 面向字节流(报文长度进程不可控)
        5.3.2  TCP 的连接 
            把连接作为最基本的抽象
            每一条 TCP 连接有两个端点
            TCP 连接的端点叫做套接字 (socket) 或插口
                端口号拼接到 (contatenated with) IP 地址即构成了套接字
            每一条 TCP 连接唯一地被通信两端的两个端点（即两个套接字）所确定
            TCP 可靠通信的具体实现 
                一个发送窗口和一个接收窗口
                用字节的序号进行控制
                两端的四个窗口经常处于动态变化之中
                使用特定的算法估算较为合理的重传时间
    5.4  可靠传输的工作原理
        5.4.1  停止等待协议
            全双工通信的双方既是发送方也是接收方。
            在发送完一个分组后，必须暂时保留已发送的分组的副本，以备重发
            分组和确认分组都必须进行编号。
            超时计时器的重传时间应当比数据在分组传输的平均往返时间更长一些
            停止等待协议的优点是简单，缺点是信道利用率太低。
        5.4.2  连续ARQ协议
            累积确认
            对按序到达的最后一个分组发送确认
            优点：容易实现，即使确认丢失也不必重传。
            缺点：不能向发送方反映出接收方已经正确收到的所有分组的信息。
            Go-back-N（回退 N） 
                表示需要再退回来重传已发送过的 N 个分组
            当通信线路质量不好时，连续 ARQ 协议会带来负面的影响
    5.5  TCP 报文段的首部格式
        TCP 报文段首部的前 20 个字节是固定的，TCP 首部的最小长度是 20 字节
        若选择较小的 MSS 长度，网络的利用率就降低
        为什么要规定 MSS ？
            只含有 1 字节的数据时
                在 IP 层传输的数据报的开销至少有 40 字节(包括 TCP 报文段的首部和 IP 数据报的首部)。这样，对网络的利用率就不会超过 1&#x2F;41
            TCP 报文段非常长
                IP 层传输时就有可能要分解成多个短数据报片。在终点要把收到的各个短数据报片装配成原来的 TCP 报文段。当传输出错时还要进行重传也都会使开销增大
            MSS 应尽可能大些，只要在 IP 层传输时不需要再分片就行，最佳的 MSS 是很难确定的
    5.6  TCP 可靠传输的实现
        5.6.1  以字节为单位的滑动窗口
            发送缓存与接收缓存的作用
                发送缓存用来暂时存放：
                    发送应用程序传送给发送方 TCP 准备发送的数据；
                    TCP 已发送出但尚未收到确认的数据。
                接收缓存用来暂时存放：
                    按序到达的、但尚未被接收应用程序读取的数据；
                    不按序到达的数据。 
            1. A 的发送窗口并不总是和 B 的接收窗口一样大（因为有一定的时间滞后）
            2. 第二，TCP 标准没有规定对不按序到达的数据应如何处理。
            3. TCP 要求接收方必须有累积确认的功能
            接收方可以在合适的时候发送确认，也可以在自己有数据要发送时把确认信息顺便捎带上
        5.6.2  超时重传时间的选择
            加权平均往返时间
                保留了 RTT 的一个加权平均往返时间 RTTS（这又称为平滑的往返时间）
                RFC 2988 推荐的 a 值为 1&#x2F;8，即 0.125
            超时重传时间 RTO
                RTO (Retransmission Time-Out) 应略大于上面得出的加权平均往返时间 RTTS。
                RTTD：是 RTT 的偏差的加权平均值
            Karn 算法
                新的问题：超时重传时间就无法更新
                修正的 Karn 算法
                    报文段每重传一次，就把 RTO 增大一些
                        新的 RTO &#x3D; y X (旧的 RTO)
                        系数 y 的典型值是 2
        5.6.3  选择确认 SACK
            解决的问题：若收到的报文段无差错，只是未按序号，中间还缺少一些序号的数据，那么能否设法只传送缺少的数据而不重传已经正确到达接收方的数据
                答案是可以的。选择确认 SACK  (Selective ACK) 就是一种可行的处理方法
            每一个字节块都有两个边界：左边界和右边界
    5.7  TCP 的流量控制
        5.7.1  利用滑动窗口实现流量控制
            方法：利用滑动窗口机制
            报文段在传送过程中丢失，发送方和接收方在相互等待，可能会造成互相等待的死锁，因此TCP 为每一个连接设有一个持续计时器 (persistence timer)
                持续计时器：
                    只要 TCP 连接的一方收到对方的零窗口通知，就启动该持续计时器
        5.7.2  必须考虑传输效率
            用不同的机制来控制 TCP 报文段的发送时机
                第一种机制是 TCP 维持一个变量，它等于最大报文段长度 MSS。只要缓存中存放的数据达到 MSS 字节时，就组装成一个 TCP 报文段发送出去
                第二种机制是由发送方的应用进程指明要求发送报文段，即 TCP 支持的推送 (push)操作
                第三种机制是发送方的一个计时器期限到了，这时就把当前已有的缓存数据装入报文段（但长度不能超过 MSS）发送出去    
    5.8  TCP 的拥塞控制
        5.8.1  拥塞控制的一般原理
            出现拥塞的原因：资源需求&gt;可用资源
                拥塞控制是动态的、
                分组的丢失是征兆，不是原因
            开环控制和闭环控制
                开环控制：在设计网络时事先考虑周到
                闭环控制：基于反馈环路：
                    检测何时何地发生
                    传送到可采取行动的地方
                    调整网络系统的运行
        5.8.2  TCP 的拥塞控制方法
            采用基于窗口的方法，TCP发送方维持一个拥塞窗口 CWND (Congestion Window)
            拥塞的判断
                重传定时器超时
                收到三个相同（重复）的 ACK
            TCP拥塞控制算法
                慢开始 (slow-start)
                    思路：由小到大逐渐增大拥塞窗口数值
                    拥塞窗口 cwnd  控制方法：在每收到一个对新的报文段的确认后，可以把拥塞窗口增加最多一个 SMSS 的数值
                    传输轮次 
                        拥塞窗口 cwnd 就加倍
                        所经历的时间就是往返时间 RTT
                    设置慢开始门限状态变量 ssthresh
                        当 cwnd &lt; ssthresh 时，使用慢开始算法。
                        当 cwnd &gt; ssthresh 时，停止使用慢开始算法而改用拥塞避免算法。
                        当 cwnd &#x3D; ssthresh 时，既可使用慢开始算法，也可使用拥塞避免算法。
                拥塞避免 (congestion avoidance)
                    思路：让拥塞窗口 cwnd 缓慢地增大，使拥塞窗口 cwnd 按线性规律缓慢增长
                        因此在拥塞避免阶段就有“加法增大”
                    当网络出现拥塞时（重传定时器超时）
                        发送方判断网络出现拥塞（重传定时器超时）：
                            ssthresh &#x3D; max(cwnd&#x2F;2，2)
                            cwnd &#x3D; 1
                            执行慢开始算法
                    非指完全能够避免了拥塞，而是使网络比较不容易出现拥塞
                    
                快重传 (fast retransmit)
                    尽早知道发生了个别报文段的丢失
                    发送方只要一连收到三个重复确认，就知道接收方确实没有收到报文段，因而应当立即进行重传（即“快重传”）
                快恢复 (fast recovery)
                    (1) 慢开始门限ssthresh&#x3D;当前拥塞窗口cwnd&#x2F;2 ；
                    (2) 新拥塞窗口 cwnd &#x3D; 慢开始门限 ssthresh ；
                    (3) 开始执行拥塞避免算法，使拥塞窗口缓慢地线性增大。 
                加法增大,乘法减小(AIMD)
        5.8.3  主动队列管理 AQM
            网络层对TCP拥塞控制影响最大的是路由器的分组丢弃策略
            路由器的队列
                “先进先出”FIFO 
                当队列已满时，尾部丢弃策略
                全局同步 (global syncronization)
                    很多TCP连接中的报文段服用在网络层IP数据报中，这时发生尾部丢弃，使这许多 TCP 连接在同一时间突然都进入到慢开始状态
                主动队列管理AQM
                    应当在队列长度达到某个值得警惕的数值时（即当网络拥塞有了某些拥塞征兆时），就主动丢弃到达的分组
                    随机早期检测 RED (Random Early Detection)
                        若平均队列长度小于最小门限 THmin，则将新到达的分组放入队列进行排队
                        若平均队列长度超过最大门限 THmax，则将新到达的分组丢弃
                        若平均队列长度在最小门限 THmin 和最大门限THmax 之间，则按照某一概率 p 将新到达的分组丢弃
                        RED 的使用效果并不太理想
                        AQM 实际上就是对路由器中的分组排队进行智能管理，而不是简单地把队列的尾部丢弃
    5.9  TCP 的运输连接管理
        TCP运输的三个阶段
            连接建立
            数据传送
            连接释放
        运输连接的管理
            使运输连接的建立和释放都能正常地进行
        TCP连接的建立采用客户服务器方式
            客户：主动发起连接建立的应用进程
            服务器：被动等待连接建立的应用进程
        5.9.1  TCP 的连接建立
            握手:TCP建立连接的过程
                三报文握手：客户和服务器之间交换三个 TCP 报文段
                    主要是为了防止已失效的连接请求报文段突然又传送到了，因而产生错误
        5.9.2  TCP 的连接释放
            四报文握手：TCP 连接释放过程
            TCP 连接处于半关闭状态
            必须等待 2MSL 的时间
                第一，为了保证 A 发送的最后一个 ACK 报文段能够到达 B
                第二，防止 “已失效的连接请求报文段”出现在本连接中。
        5.9.3  TCP 的有限状态机
            粗实线箭头表示对客户进程的正常变迁。
            粗虚线箭头表示对服务器进程的正常变迁。
            细线箭头表示异常变迁。

1.浏览器输入一个网址，每层用到哪些协议，其作用是什么
    应用层：HTTP:WWW访问协议，DNS:域名解析服务
    传输层：TCP:为HTTP提供可靠的数据传输，UDP：DNS使用UDP传输
    网络层：IP:IP包传输和路由选择，ICMP：提供网络传输中的差错检测，ARP：将本机的默认网关IP地址映射城物理MAC地址
</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">森森</p>
  <div class="site-description" itemprop="description">笔记</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">2</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">森森</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
